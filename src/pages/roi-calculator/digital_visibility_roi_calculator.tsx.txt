import React, { useState } from 'react';
import { Calculator, TrendingUp, Users, Building, Brain, Search, Award, ChevronRight, ChevronLeft, BarChart3, Target, Clock, DollarSign, LineChart, Zap, AlertTriangle } from 'lucide-react';

const DigitalVisibilityROICalculator = () => {
  const [currentStep, setCurrentStep] = useState(0);
  const [formData, setFormData] = useState({
    companySize: '',
    revenue: '',
    industry: '',
    location: '',
    websiteTraffic: '',
    currentSEORanking: '',
    aiPresence: '',
    marketingSpend: '',
    primaryGoal: '',
    currentROI: '',
    manualTime: '',
    competitivePressure: '',
    aiToolsUsage: '',
    servicesInterested: [],
    timeline: '',
    budget: '',
    name: '',
    email: '',
    company: '',
    phone: ''
  });
  const [results, setResults] = useState(null);
  const [showResults, setShowResults] = useState(false);
  const [showOptimalChart, setShowOptimalChart] = useState(false);

  const steps = [
    { title: "Business Profile", icon: Building },
    { title: "Digital Maturity", icon: Search },
    { title: "Growth Goals", icon: Target },
    { title: "AI Readiness", icon: Brain }
  ];

  const industries = [
    "E-commerce/Retail", "SaaS/Technology", "Professional Services", "Consulting",
    "Healthcare", "Financial Services", "Real Estate", "Education", "Marketing/Agency",
    "Legal Services", "Automotive", "Construction", "Manufacturing", "Hospitality",
    "Non-profit", "Other"
  ];

  const services = [
    { id: 'search_optimization', name: 'SEO+AEO+GEO+SBO+Geographic Optimization', desc: 'Complete search engine & AI platform visibility' },
    { id: 'agentic_marketing', name: 'Agentic Marketing Automations', desc: 'AI agents for lead gen, content, social media' },
    { id: 'agentic_business', name: 'Agentic Business Operations', desc: 'AI agents for admin, customer service, workflows' },
    { id: 'full_stack_automation', name: 'Full-Stack AI Automation Service', desc: 'Complete business transformation with AI' }
  ];

  // Digital Visibility pricing vs industry standards (based on 2025 research)
  const pricingComparison = {
    seo: {
      industryAverage: 125, // £125/hour average for quality SEO
      digitalVisibilityStandard: 80, // Your new standard rate
      digitalVisibilityFounder: 40, // 50% founder discount
      industryMonthly: 2000, // £2000/month average retainer
      digitalVisibilityMonthly: 1200, // Your standard monthly rate
      founderMonthly: 600 // 50% off monthly rate
    },
    automation: {
      industryAverage: 100, // £100/hour average for AI automation
      digitalVisibilityStandard: 80, // Your new standard rate
      digitalVisibilityFounder: 40, // 50% founder discount
      industrySetup: 5000, // £5000 average setup cost
      digitalVisibilitySetup: 2400, // Your standard setup cost
      founderSetup: 1200 // 50% off setup
    },
    marketing: {
      industryAverage: 90, // £90/hour average for marketing automation
      digitalVisibilityStandard: 80, // Your new standard rate
      digitalVisibilityFounder: 40, // 50% founder discount
      industryMonthly: 800, // £800/month average ongoing
      digitalVisibilityMonthly: 480, // Your standard ongoing rate
      founderMonthly: 240 // 50% off ongoing rate
    }
  };

  const calculateOptimalSpending = (revenue) => {
    // Based on 2025 research: Optimal marketing spend ranges and sweet spots
    const optimalRanges = {
      // Low spend = minimal impact, High spend = diminishing returns
      'E-commerce/Retail': { min: 0.06, optimal: 0.08, max: 0.12, diminishing: 0.15 },
      'SaaS/Technology': { min: 0.08, optimal: 0.12, max: 0.18, diminishing: 0.25 },
      'Professional Services': { min: 0.04, optimal: 0.07, max: 0.10, diminishing: 0.15 },
      'Marketing/Agency': { min: 0.10, optimal: 0.15, max: 0.20, diminishing: 0.30 },
      'Real Estate': { min: 0.06, optimal: 0.10, max: 0.15, diminishing: 0.20 },
      'Legal Services': { min: 0.03, optimal: 0.05, max: 0.08, diminishing: 0.12 },
      'Financial Services': { min: 0.04, optimal: 0.06, max: 0.09, diminishing: 0.15 },
      'Consulting': { min: 0.05, optimal: 0.08, max: 0.12, diminishing: 0.18 },
      'Healthcare': { min: 0.02, optimal: 0.03, max: 0.05, diminishing: 0.08 },
      'Education': { min: 0.02, optimal: 0.04, max: 0.06, diminishing: 0.10 },
      'Construction': { min: 0.02, optimal: 0.03, max: 0.05, diminishing: 0.08 },
      'Manufacturing': { min: 0.02, optimal: 0.04, max: 0.06, diminishing: 0.10 },
      'Automotive': { min: 0.04, optimal: 0.06, max: 0.09, diminishing: 0.15 },
      'Hospitality': { min: 0.06, optimal: 0.09, max: 0.12, diminishing: 0.18 },
      'Non-profit': { min: 0.01, optimal: 0.02, max: 0.04, diminishing: 0.07 },
      'Other': { min: 0.04, optimal: 0.07, max: 0.10, diminishing: 0.15 }
    };

    const range = optimalRanges[formData.industry] || optimalRanges['Other'];
    
    // Generate data points for the chart
    const dataPoints = [];
    const maxSpendPercent = 0.25; // 25% maximum for chart
    const step = 0.01; // 1% increments
    
    for (let spendPercent = 0; spendPercent <= maxSpendPercent; spendPercent += step) {
      const annualSpend = revenue * spendPercent;
      let roi;
      
      if (spendPercent < range.min) {
        // Below minimum: very low ROI (not enough investment)
        roi = spendPercent * 100; // Linear, poor return
      } else if (spendPercent <= range.optimal) {
        // Sweet spot zone: exponential growth
        const normalizedPosition = (spendPercent - range.min) / (range.optimal - range.min);
        roi = 150 + (normalizedPosition * 300); // 150% to 450% ROI
      } else if (spendPercent <= range.max) {
        // Good zone but declining efficiency
        const normalizedPosition = (spendPercent - range.optimal) / (range.max - range.optimal);
        roi = 450 - (normalizedPosition * 150); // 450% down to 300% ROI
      } else if (spendPercent <= range.diminishing) {
        // Diminishing returns zone
        const normalizedPosition = (spendPercent - range.max) / (range.diminishing - range.max);
        roi = 300 - (normalizedPosition * 200); // 300% down to 100% ROI
      } else {
        // Waste zone: negative returns possible
        const normalizedPosition = (spendPercent - range.diminishing) / (maxSpendPercent - range.diminishing);
        roi = 100 - (normalizedPosition * 50); // 100% down to 50% ROI
      }
      
      dataPoints.push({
        spendPercent: Math.round(spendPercent * 100),
        annualSpend: Math.round(annualSpend),
        roi: Math.round(roi),
        zone: spendPercent < range.min ? 'minimal' : 
              spendPercent <= range.optimal ? 'sweet' :
              spendPercent <= range.max ? 'good' :
              spendPercent <= range.diminishing ? 'diminishing' : 'waste'
      });
    }
    
    return {
      dataPoints,
      optimalPercent: Math.round(range.optimal * 100),
      optimalAnnualSpend: Math.round(revenue * range.optimal),
      minPercent: Math.round(range.min * 100),
      maxPercent: Math.round(range.max * 100),
      diminishingPercent: Math.round(range.diminishing * 100)
    };
  };

  const calculateROI = () => {
    const { companySize, revenue, industry, servicesInterested } = formData;
    
    // Based on 2025 research: Realistic operational expense percentages
    // Small businesses typically spend 80-95% of revenue on total expenses
    const operationalExpensePercent = {
      'solo': 0.75,      // 75% for solo traders (lower overhead)
      '1-3': 0.80,       // 80% for small teams
      '4-10': 0.82,      // 82% for growing businesses  
      '11-50': 0.85,     // 85% for established businesses
      '50+': 0.87        // 87% for larger businesses
    };

    // Marketing spend percentages based on 2025 industry research
    const marketingSpendPercent = {
      'E-commerce/Retail': 0.08,     // 8% (industry standard)
      'SaaS/Technology': 0.12,       // 12% (high growth focus)
      'Professional Services': 0.07, // 7% (relationship-based)
      'Marketing/Agency': 0.15,      // 15% (higher for agencies)
      'Real Estate': 0.10,           // 10% (competitive market)
      'Legal Services': 0.05,        // 5% (referral-based)
      'Financial Services': 0.06,    // 6% (regulated industry)
      'Consulting': 0.08,            // 8% (knowledge-based)
      'Healthcare': 0.03,            // 3% (referral-heavy)
      'Education': 0.04,             // 4% (limited budgets)
      'Construction': 0.03,          // 3% (project-based)
      'Manufacturing': 0.04,         // 4% (B2B focus)
      'Automotive': 0.06,            // 6% (competitive)
      'Hospitality': 0.09,           // 9% (experience-driven)
      'Non-profit': 0.02,            // 2% (budget constraints)
      'Other': 0.07                  // 7% (average)
    };

    const currentRevenueNum = revenue === '£0-£50k' ? 35000 : 
                             revenue === '£50k-£100k' ? 75000 :
                             revenue === '£100k-£250k' ? 175000 :
                             revenue === '£250k-£500k' ? 375000 : 750000;

    // Calculate realistic operational and marketing budgets
    const totalOperationalBudget = currentRevenueNum * (operationalExpensePercent[companySize] || operationalExpensePercent['solo']);
    const totalMarketingBudget = currentRevenueNum * (marketingSpendPercent[industry] || marketingSpendPercent['Other']);
    
    // Based on McKinsey 2025: Only specific percentages can be automated
    const automatableAdminBudget = totalOperationalBudget * 0.25; // 25% of operational tasks can be automated
    const automatableMarketingBudget = totalMarketingBudget * 0.65; // 65% of marketing activities can be automated

    // Updated ROI multipliers based on 2025 research data
    const baseROIMultipliers = {
      'search_optimization': 4.5,    // SEO average ROI 400-748% = 4.5x average
      'agentic_marketing': 5.44,     // Marketing automation $5.44 per $1 spent
      'agentic_business': 2.4,       // Business process automation 240% ROI
      'full_stack_automation': 3.8   // Combined approach (weighted average)
    };

    // More realistic service investment calculations
    const serviceInvestments = {
      'search_optimization': Math.round(automatableMarketingBudget * 0.6),  // 60% of automatable marketing
      'agentic_marketing': Math.round(automatableMarketingBudget * 0.7),    // 70% of automatable marketing
      'agentic_business': Math.round(automatableAdminBudget * 0.5),         // 50% of automatable admin
      'full_stack_automation': Math.round((automatableMarketingBudget + automatableAdminBudget) * 0.5) // 50% combined
    };

    const serviceReturns = {
      'search_optimization': Math.round(serviceInvestments.search_optimization * baseROIMultipliers.search_optimization),
      'agentic_marketing': Math.round(serviceInvestments.agentic_marketing * baseROIMultipliers.agentic_marketing),
      'agentic_business': Math.round(serviceInvestments.agentic_business * baseROIMultipliers.agentic_business),
      'full_stack_automation': Math.round(serviceInvestments.full_stack_automation * baseROIMultipliers.full_stack_automation)
    };

    // Updated time savings: Based on Vena Solutions 2025 research
    const dailyTimeSaved = 2.25; // AI saves 2 hours 15 minutes daily per professional
    const workingDaysPerWeek = 5;
    const weeklyTimeSaved = Math.round(dailyTimeSaved * workingDaysPerWeek);
    const annualTimeSaved = weeklyTimeSaved * 48; // 48 working weeks per year
    
    const hourlyValues = {
      'solo': 30,      // Updated for UK market 2025
      '1-3': 40,       // Small team rates
      '4-10': 50,      // Growing business rates
      '11-50': 60,     // Established business rates
      '50+': 75        // Large business rates
    };
    
    const hourlyValue = hourlyValues[companySize] || hourlyValues['solo'];
    const timeSavingsValue = annualTimeSaved * hourlyValue;

    // Updated search improvements based on 2025 research
    const searchImprovements = {
      trafficIncrease: 120,      // More realistic 120% increase (based on 2025 SEO studies)
      leadIncrease: 180,         // 180% lead increase (conversion-focused)
      featuredSnippetCTR: 43,    // 42.9% CTR for featured snippets (First Page Sage 2025)
      aiOverviewTrigger: 13,     // 13.14% AI overview trigger rate
      voiceSearchUsage: 21       // 20.5% voice search usage globally
    };

    const serviceROI = {
      search_optimization: {
        investment: serviceInvestments.search_optimization,
        returns: serviceReturns.search_optimization,
        timeframe: '4-8 months',
        description: 'Complete search visibility (SEO+AEO+GEO+SBO+Geographic)',
        roiPercent: Math.round(((serviceReturns.search_optimization - serviceInvestments.search_optimization) / serviceInvestments.search_optimization) * 100),
        citations: [
          'SEO delivers average ROI of 400-748% (SeoProfy, 2025)',
          'Featured snippets achieve 42.9% CTR (First Page Sage, 2025)',
          'AI Overviews triggered in 13.14% of searches (Search Engine Land, 2025)',
          'Organic search generates 53% of website traffic (Intergrowth, 2025)'
        ]
      },
      agentic_marketing: {
        investment: serviceInvestments.agentic_marketing,
        returns: serviceReturns.agentic_marketing,
        timeframe: '2-4 months',
        description: 'Automated lead generation, content creation & social media',
        roiPercent: Math.round(((serviceReturns.agentic_marketing - serviceInvestments.agentic_marketing) / serviceInvestments.agentic_marketing) * 100),
        citations: [
          'Marketing automation delivers $5.44 per $1 invested (Digital Silk, 2025)',
          '77% of businesses see increased conversion rates (WebFX, 2025)',
          '65% of marketing activities can be automated (EmailMonday, 2025)',
          '80% of marketers experience increased leads from automation (WebFX, 2025)'
        ]
      },
      agentic_business: {
        investment: serviceInvestments.agentic_business,
        returns: serviceReturns.agentic_business,
        timeframe: '3-6 months',
        description: 'Automate admin, customer service, workflows & operations',
        roiPercent: Math.round(((serviceReturns.agentic_business - serviceInvestments.agentic_business) / serviceInvestments.agentic_business) * 100),
        citations: [
          'Business process automation achieves 240% ROI (ARDEM, 2025)',
          '25% of operational workload can be automated (McKinsey, 2025)',
          'AI saves 2 hours 15 minutes daily per professional (Vena Solutions, 2025)',
          '14.5% increase in sales productivity from automation (Nucleus Research, 2025)'
        ]
      },
      full_stack_automation: {
        investment: serviceInvestments.full_stack_automation,
        returns: serviceReturns.full_stack_automation,
        timeframe: '4-10 months',
        description: 'Complete business transformation with full AI integration',
        roiPercent: Math.round(((serviceReturns.full_stack_automation - serviceInvestments.full_stack_automation) / serviceInvestments.full_stack_automation) * 100),
        citations: [
          'Combined automation approach maximizes efficiency gains',
          'Average automation ROI of 300-500% achievable (Industry Research, 2025)',
          'Full automation delivers measurable business impacts within 12 months',
          'Comprehensive automation reduces operational overhead by 12.2% (Nucleus Research, 2025)'
        ]
      }
    };

    const totalInvestment = servicesInterested.reduce((sum, service) => sum + (serviceROI[service]?.investment || 0), 0);
    const totalReturns = servicesInterested.reduce((sum, service) => sum + (serviceROI[service]?.returns || 0), 0);
    const overallROI = totalInvestment > 0 ? Math.round(((totalReturns - totalInvestment) / totalInvestment) * 100) : 0;

    const monthlyTimeSaved = Math.round(weeklyTimeSaved * 4.33);
    const monthlyValueSaved = Math.round(monthlyTimeSaved * hourlyValue);

    // Calculate optimal spending data for chart
    const optimalSpendingData = calculateOptimalSpending(currentRevenueNum);

    const researchCitations = [
      'Operational automation: 25% of business tasks can be automated (McKinsey, 2025)',
      'Marketing automation: 65% of marketing activities can be automated (Industry Research, 2025)',
      'SEO ROI: 400-748% average return on investment (SeoProfy, 2025)',
      'Marketing automation: $5.44 return per $1 invested (Digital Silk, 2025)',
      'Business process automation: 240% ROI achievable (ARDEM, 2025)',
      'AI saves 2 hours 15 minutes daily per professional (Vena Solutions, 2025)',
      'Featured snippets: 42.9% CTR (First Page Sage, 2025)',
      'Voice search: 20.5% global usage (Demand Sage, 2025)',
      'Small business operational expenses: 75-87% of revenue (Connect2Capital, 2025)',
      'Industry marketing spend: 3-15% of revenue varies by sector (Industry Research, 2025)'
    ];

    return {
      trafficIncrease: searchImprovements.trafficIncrease,
      leadIncrease: searchImprovements.leadIncrease,
      weeklyTimeSaved,
      monthlyTimeSaved,
      monthlyValueSaved,
      annualTimeSaved,
      timeSavingsValue,
      currentRevenueNum,
      totalOperationalBudget,
      totalMarketingBudget,
      automatableAdminBudget,
      automatableMarketingBudget,
      totalInvestment,
      totalReturns,
      overallROI,
      voiceSearchCapture: searchImprovements.voiceSearchUsage,
      aiOverviewAppearances: searchImprovements.aiOverviewTrigger,
      featuredSnippetIncrease: searchImprovements.featuredSnippetCTR,
      serviceROI,
      researchCitations,
      optimalSpendingData,
      calculationBasis: {
        operationalExpensePercent: (operationalExpensePercent[companySize] || operationalExpensePercent['solo']) * 100,
        marketingSpendPercent: (marketingSpendPercent[industry] || marketingSpendPercent['Other']) * 100,
        automatableAdminPercent: 25, // 25% can be automated (updated based on research)
        automatableMarketingPercent: 65, // 65% can be automated (updated based on research)
        totalOperationalBudget,
        totalMarketingBudget,
        automatableAdminBudget,
        automatableMarketingBudget
      }
    };
  };

  const handleInputChange = (field, value) => {
    setFormData(prev => ({
      ...prev,
      [field]: value
    }));
  };

  const handleServiceToggle = (serviceId) => {
    setFormData(prev => ({
      ...prev,
      servicesInterested: prev.servicesInterested.includes(serviceId)
        ? prev.servicesInterested.filter(id => id !== serviceId)
        : [...prev.servicesInterested, serviceId]
    }));
  };

  const nextStep = () => {
    if (currentStep < steps.length - 1) {
      setCurrentStep(currentStep + 1);
    } else {
      const calculatedResults = calculateROI();
      setResults(calculatedResults);
      setShowResults(true);
    }
  };

  const prevStep = () => {
    if (currentStep > 0) {
      setCurrentStep(currentStep - 1);
    }
  };

  const isStepComplete = () => {
    switch (currentStep) {
      case 0:
        return formData.companySize && formData.revenue && formData.industry && formData.location;
      case 1:
        return formData.websiteTraffic && formData.currentSEORanking && formData.aiPresence && formData.marketingSpend;
      case 2:
        return formData.primaryGoal && formData.currentROI && formData.manualTime && formData.competitivePressure;
      case 3:
        return formData.aiToolsUsage && formData.servicesInterested.length > 0 && formData.timeline && formData.budget;
      default:
        return false;
    }
  };

  if (showResults && results) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-4">
        <div className="max-w-6xl mx-auto">
          <div className="text-center mb-8">
            <div className="flex items-center justify-center mb-4">
              <Award className="h-8 w-8 text-blue-600 mr-2" />
              <h1 className="text-3xl font-bold text-gray-900">Your Digital Transformation ROI Report</h1>
            </div>
            <p className="text-xl text-gray-600">Human Powered, AI Accelerated Results</p>
            <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-lg inline-block mt-4">
              <span className="text-2xl font-bold">{results.overallROI}% ROI</span>
              <span className="ml-2">projected within 12 months</span>
            </div>
          </div>

          <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div className="bg-white rounded-xl p-6 shadow-lg border border-gray-100">
              <div className="flex items-center justify-between mb-4">
                <TrendingUp className="h-8 w-8 text-green-600" />
                <span className="text-3xl font-bold text-green-600">+{results.trafficIncrease}%</span>
              </div>
              <h3 className="font-semibold text-gray-900 mb-2">Organic Traffic Growth</h3>
              <p className="text-sm text-gray-600">SEO+AEO+GEO+SBO optimization impact</p>
            </div>

            <div className="bg-white rounded-xl p-6 shadow-lg border border-gray-100">
              <div className="flex items-center justify-between mb-4">
                <Users className="h-8 w-8 text-blue-600" />
                <span className="text-3xl font-bold text-blue-600">+{results.leadIncrease}%</span>
              </div>
              <h3 className="font-semibold text-gray-900 mb-2">Lead Generation</h3>
              <p className="text-sm text-gray-600">Qualified prospects increase</p>
            </div>

            <div className="bg-white rounded-xl p-6 shadow-lg border border-gray-100">
              <div className="flex items-center justify-between mb-4">
                <Clock className="h-8 w-8 text-orange-600" />
                <span className="text-3xl font-bold text-orange-600">{results.weeklyTimeSaved}h</span>
              </div>
              <h3 className="font-semibold text-gray-900 mb-2">Hours Saved/Week</h3>
              <p className="text-sm text-gray-600">More time for high-value work</p>
            </div>

            <div className="bg-white rounded-xl p-6 shadow-lg border border-gray-100">
              <div className="flex items-center justify-between mb-4">
                <DollarSign className="h-8 w-8 text-purple-600" />
                <span className="text-3xl font-bold text-purple-600">£{results.monthlyValueSaved.toLocaleString()}</span>
              </div>
              <h3 className="font-semibold text-gray-900 mb-2">Monthly Value Saved</h3>
              <p className="text-sm text-gray-600">Time = money for solo traders</p>
            </div>
          </div>

          <div className="bg-white rounded-xl p-8 shadow-lg border border-gray-100 mb-8">
            <h2 className="text-2xl font-bold text-gray-900 mb-6 flex items-center">
              <Target className="h-6 w-6 mr-2 text-blue-600" />
              Simple Explanation: Your Money In vs Money Out
            </h2>
            
            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
              <h3 className="text-lg font-semibold text-blue-900 mb-2">Think of it like this:</h3>
              <p className="text-blue-800">
                Imagine you put money into a magic machine. For every £1 you put in, the machine gives you back more money. 
                Our calculations show how much money you'll get back from investing in automation and marketing.
              </p>
            </div>
            
            <div className="grid md:grid-cols-2 gap-8 mb-6">
              <div className="bg-red-50 border border-red-200 rounded-lg p-6">
                <h3 className="text-lg font-semibold text-red-800 mb-4">💰 Money You Need to Put In</h3>
                <div className="text-3xl font-bold text-red-600 mb-2">£{results.totalInvestment.toLocaleString()}</div>
                <p className="text-sm text-red-700 mb-4">This is what you'll spend per year to automate your business</p>
                <div className="text-sm text-red-600 space-y-1">
                  <div>✓ No long contracts (you can stop anytime)</div>
                  <div>✓ You can make it bigger or smaller as needed</div>
                  <div>✓ Just 30 days notice to cancel</div>
                </div>
              </div>
              
              <div className="bg-green-50 border border-green-200 rounded-lg p-6">
                <h3 className="text-lg font-semibold text-green-800 mb-4">💎 Money You'll Get Back</h3>
                <div className="text-3xl font-bold text-green-600 mb-2">£{results.totalReturns.toLocaleString()}</div>
                <p className="text-sm text-green-700 mb-4">This is the extra money you'll make each year</p>
                <div className="text-sm text-green-600 space-y-1">
                  <div>⏱️ Save {results.weeklyTimeSaved} hours every week</div>
                  <div>📈 Get {results.leadIncrease}% more customers</div>
                  <div>🚀 Get {results.trafficIncrease}% more website visitors</div>
                </div>
              </div>
            </div>
            
            <div className="text-center bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6">
              <div className="text-4xl font-bold text-blue-600 mb-2">
                You Get Back £{((results.totalReturns / results.totalInvestment) || 0).toFixed(2)} For Every £1 You Spend
              </div>
              <p className="text-gray-700 mb-4 text-lg">
                That's like putting £1 in a magic machine and getting back £{((results.totalReturns / results.totalInvestment) || 0).toFixed(2)}!
              </p>
              <div className="grid grid-cols-3 gap-4 text-center">
                <div>
                  <div className="text-2xl font-bold text-purple-600">£{Math.round(results.totalReturns/12).toLocaleString()}</div>
                  <div className="text-sm text-gray-600">Extra money each month</div>
                </div>
                <div>
                  <div className="text-2xl font-bold text-blue-600">{Math.round(results.totalReturns/results.totalInvestment)}x</div>
                  <div className="text-sm text-gray-600">Times your money grows</div>
                </div>
                <div>
                  <div className="text-2xl font-bold text-green-600">{Math.round(results.totalInvestment/(results.totalReturns/12))} months</div>
                  <div className="text-sm text-gray-600">Time to pay for itself</div>
                </div>
              </div>
            </div>
          </div>

          <div className="bg-white rounded-xl p-8 shadow-lg border border-gray-100 mb-8">
            <h2 className="text-2xl font-bold text-gray-900 mb-6 flex items-center">
              <Award className="h-6 w-6 mr-2 text-blue-600" />
              Digital Visibility Pricing: Premium Service, Smart Investment
            </h2>
            
            <div className="bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-6 mb-6">
              <h3 className="text-xl font-semibold text-green-900 mb-3 flex items-center">
                <Zap className="h-5 w-5 mr-2" />
                🚀 Limited Time: Founder's Discount Available!
              </h3>
              <div className="grid md:grid-cols-2 gap-4">
                <div>
                  <p className="text-green-800 mb-2">
                    <strong>Standard Rate:</strong> £80/hour (already 36% below industry average!)
                  </p>
                  <p className="text-green-800">
                    <strong>Founder's Rate:</strong> £40/hour (68% below industry average!)
                  </p>
                </div>
                <div className="bg-white rounded-lg p-3 border border-green-300">
                  <p className="text-sm text-green-700 font-semibold">Perfect timing to get started:</p>
                  <p className="text-xs text-green-600">
                    Set up your automations at founder rates, then enjoy the massive ROI 
                    when you only pay standard rates for maintenance and additions.
                  </p>
                </div>
              </div>
            </div>

            <div className="grid md:grid-cols-3 gap-6 mb-6">
              <div className="bg-red-50 border border-red-200 rounded-lg p-6">
                <h3 className="text-lg font-semibold text-red-900 mb-4">Industry Average</h3>
                <div className="space-y-3">
                  <div className="flex justify-between">
                    <span className="text-red-700">SEO Services:</span>
                    <span className="font-bold text-red-900">£{pricingComparison.seo.industryAverage}/hour</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-red-700">AI Automation:</span>
                    <span className="font-bold text-red-900">£{pricingComparison.automation.industryAverage}/hour</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-red-700">Marketing Auto:</span>
                    <span className="font-bold text-red-900">£{pricingComparison.marketing.industryAverage}/hour</span>
                  </div>
                  <div className="bg-red-100 border border-red-300 rounded-lg p-2 text-center mt-4">
                    <span className="text-red-800 font-bold">What Most Pay</span>
                  </div>
                </div>
              </div>

              <div className="bg-blue-50 border border-blue-200 rounded-lg p-6">
                <h3 className="text-lg font-semibold text-blue-900 mb-4">Digital Visibility Standard</h3>
                <div className="space-y-3">
                  <div className="flex justify-between">
                    <span className="text-blue-700">All Services:</span>
                    <span className="font-bold text-blue-900">£{pricingComparison.seo.digitalVisibilityStandard}/hour</span>
                  </div>
                  <div className="text-center py-4">
                    <div className="text-2xl font-bold text-blue-600">Already</div>
                    <div className="text-lg text-blue-700">36% Below</div>
                    <div className="text-sm text-blue-600">Industry Average</div>
                  </div>
                  <div className="bg-blue-100 border border-blue-300 rounded-lg p-2 text-center">
                    <span className="text-blue-800 font-bold">Premium Value</span>
                  </div>
                </div>
              </div>

              <div className="bg-green-50 border border-green-200 rounded-lg p-6 relative">
                <div className="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">
                  LIMITED TIME
                </div>
                <h3 className="text-lg font-semibold text-green-900 mb-4">Founder's Discount</h3>
                <div className="space-y-3">
                  <div className="flex justify-between">
                    <span className="text-green-700">All Services:</span>
                    <span className="font-bold text-green-900">£{pricingComparison.seo.digitalVisibilityFounder}/hour</span>
                  </div>
                  <div className="text-center py-4">
                    <div className="text-2xl font-bold text-green-600">Massive</div>
                    <div className="text-lg text-green-700">68% Below</div>
                    <div className="text-sm text-green-600">Industry Average</div>
                  </div>
                  <div className="bg-green-100 border border-green-300 rounded-lg p-2 text-center">
                    <span className="text-green-800 font-bold">Incredible Value!</span>
                  </div>
                </div>
              </div>
            </div>

            <div className="bg-gradient-to-r from-yellow-50 to-orange-50 border border-orange-200 rounded-lg p-6">
              <h3 className="text-lg font-semibold text-orange-900 mb-4">Your ROI Advantage:</h3>
              <div className="grid md:grid-cols-3 gap-6 text-sm">
                <div>
                  <h4 className="font-semibold text-red-800 mb-2">Industry Rates:</h4>
                  <div className="space-y-1 text-red-700">
                    <div>• Setup: £{pricingComparison.automation.industrySetup.toLocaleString()}</div>
                    <div>• Monthly: £{(pricingComparison.seo.industryMonthly + pricingComparison.marketing.industryMonthly).toLocaleString()}</div>
                    <div className="font-bold pt-2 border-t border-red-300">
                      Year 1: £{(pricingComparison.automation.industrySetup + (pricingComparison.seo.industryMonthly + pricingComparison.marketing.industryMonthly) * 12).toLocaleString()}
                    </div>
                  </div>
                </div>
                <div>
                  <h4 className="font-semibold text-blue-800 mb-2">Our Standard Rates:</h4>
                  <div className="space-y-1 text-blue-700">
                    <div>• Setup: £{pricingComparison.automation.digitalVisibilitySetup.toLocaleString()}</div>
                    <div>• Monthly: £{(pricingComparison.seo.digitalVisibilityMonthly + pricingComparison.marketing.digitalVisibilityMonthly).toLocaleString()}</div>
                    <div className="font-bold pt-2 border-t border-blue-300">
                      Year 1: £{(pricingComparison.automation.digitalVisibilitySetup + (pricingComparison.seo.digitalVisibilityMonthly + pricingComparison.marketing.digitalVisibilityMonthly) * 12).toLocaleString()}
                    </div>
                    <div className="text-xs text-blue-600 mt-1">
                      Save £{(pricingComparison.automation.industrySetup + (pricingComparison.seo.industryMonthly + pricingComparison.marketing.industryMonthly) * 12) - 
                             (pricingComparison.automation.digitalVisibilitySetup + (pricingComparison.seo.digitalVisibilityMonthly + pricingComparison.marketing.digitalVisibilityMonthly) * 12)} per year
                    </div>
                  </div>
                </div>
                <div>
                  <h4 className="font-semibold text-green-800 mb-2">Founder's Discount:</h4>
                  <div className="space-y-1 text-green-700">
                    <div>• Setup: £{pricingComparison.automation.founderSetup.toLocaleString()}</div>
                    <div>• Monthly: £{(pricingComparison.seo.founderMonthly + pricingComparison.marketing.founderMonthly).toLocaleString()}</div>
                    <div className="font-bold pt-2 border-t border-green-300">
                      Year 1: £{(pricingComparison.automation.founderSetup + (pricingComparison.seo.founderMonthly + pricingComparison.marketing.founderMonthly) * 12).toLocaleString()}
                    </div>
                    <div className="text-xs text-green-600 mt-1">
                      Save £{(pricingComparison.automation.industrySetup + (pricingComparison.seo.industryMonthly + pricingComparison.marketing.industryMonthly) * 12) - 
                             (pricingComparison.automation.founderSetup + (pricingComparison.seo.founderMonthly + pricingComparison.marketing.founderMonthly) * 12)} per year!
                    </div>
                  </div>
                </div>
              </div>
              
              <div className="mt-6 grid md:grid-cols-2 gap-4">
                <div className="bg-white rounded-lg p-4 border border-blue-300">
                  <h4 className="font-semibold text-blue-800 mb-2">Standard Rate ROI Advantage:</h4>
                  <p className="text-sm text-blue-700">
                    Even at £80/hour, you get <strong>36% better ROI</strong> than industry studies predict 
                    because our rates are below average. The ROI calculations show what people paying 
                    £125/hour achieve - you get the same results for much less!
                  </p>
                </div>
                <div className="bg-white rounded-lg p-4 border border-green-300">
                  <h4 className="font-semibold text-green-800 mb-2">Founder Rate ROI Advantage:</h4>
                  <p className="text-sm text-green-700">
                    At £40/hour founder rates, you get <strong>68% better ROI</strong> than industry studies predict! 
                    Perfect for initial setup, then switch to standard rates for ongoing work when 
                    you're already making significantly more money.
                  </p>
                </div>
              </div>
            </div>

            <div className="mt-6 bg-blue-600 text-white rounded-lg p-6 text-center">
              <h3 className="text-xl font-bold mb-2">🎯 Smart Strategy: Start with Founder Rates</h3>
              <p className="text-blue-100 mb-4">
                Get your automations built at 50% off, then enjoy massive ROI when you only pay standard rates 
                for maintenance and additions. By then, you'll be making so much more money that £80/hour 
                will feel like nothing!
              </p>
              <div className="inline-flex items-center bg-white text-blue-600 px-4 py-2 rounded-lg font-semibold">
                Limited Time Offer - Claim Your Founder's Discount Today!
              </div>
            </div>
          </div>

          <div className="bg-white rounded-xl p-8 shadow-lg border border-gray-100 mb-8">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-2xl font-bold text-gray-900 flex items-center">
                <LineChart className="h-6 w-6 mr-2 text-blue-600" />
                Your Optimal Marketing Spend Sweet Spot
              </h2>
              <button
                onClick={() => setShowOptimalChart(!showOptimalChart)}
                className="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition duration-200"
              >
                {showOptimalChart ? 'Hide Chart' : 'Show Sweet Spot Chart'}
              </button>
            </div>
            
            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
              <h3 className="text-lg font-semibold text-blue-900 mb-2 flex items-center">
                <Zap className="h-5 w-5 mr-2" />
                What This Means (Simple Explanation):
              </h3>
              <div className="text-blue-800 space-y-2">
                <p><strong>Think of marketing spend like fertilizer for a garden:</strong></p>
                <p>• <strong>Too little:</strong> Your business grows slowly (like a plant without enough fertilizer)</p>
                <p>• <strong>Just right:</strong> Your business grows fast and healthy (sweet spot!)</p>
                <p>• <strong>Too much:</strong> You waste money and might even hurt your business (like burning plants with too much fertilizer)</p>
              </div>
            </div>

            <div className="grid md:grid-cols-3 gap-4 mb-6">
              <div className="bg-red-50 border border-red-200 rounded-lg p-4 text-center">
                <AlertTriangle className="h-8 w-8 text-red-600 mx-auto mb-2" />
                <div className="text-sm font-medium text-red-800">Too Little Spend</div>
                <div className="text-lg font-bold text-red-600">{results.optimalSpendingData.minPercent}% or less</div>
                <div className="text-xs text-red-700">Minimal results, slow growth</div>
              </div>
              
              <div className="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                <Zap className="h-8 w-8 text-green-600 mx-auto mb-2" />
                <div className="text-sm font-medium text-green-800">Sweet Spot!</div>
                <div className="text-lg font-bold text-green-600">{results.optimalSpendingData.optimalPercent}%</div>
                <div className="text-xs text-green-700">£{results.optimalSpendingData.optimalAnnualSpend.toLocaleString()}/year</div>
              </div>
              
              <div className="bg-orange-50 border border-orange-200 rounded-lg p-4 text-center">
                <TrendingUp className="h-8 w-8 text-orange-600 mx-auto mb-2" />
                <div className="text-sm font-medium text-orange-800">Diminishing Returns</div>
                <div className="text-lg font-bold text-orange-600">{results.optimalSpendingData.diminishingPercent}%+</div>
                <div className="text-xs text-orange-700">Wasting money, poor ROI</div>
              </div>
            </div>

            {showOptimalChart && (
              <div className="bg-gray-50 rounded-lg p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">Interactive Spending vs ROI Chart</h3>
                <div className="relative h-96 bg-white rounded-lg border border-gray-200 p-4">
                  <svg width="100%" height="100%" viewBox="0 0 800 300" className="overflow-visible">
                    {/* Grid lines */}
                    {[0, 1, 2, 3, 4, 5, 6].map(i => (
                      <line key={i} x1={i * 120 + 80} y1="20" x2={i * 120 + 80} y2="280" stroke="#e5e7eb" strokeWidth="1" />
                    ))}
                    {[0, 1, 2, 3, 4, 5].map(i => (
                      <line key={i} x1="80" y1={i * 50 + 30} x2="760" y2={i * 50 + 30} stroke="#e5e7eb" strokeWidth="1" />
                    ))}
                    
                    {/* Axes */}
                    <line x1="80" y1="280" x2="760" y2="280" stroke="#374151" strokeWidth="2" />
                    <line x1="80" y1="20" x2="80" y2="280" stroke="#374151" strokeWidth="2" />
                    
                    {/* Data line */}
                    <path
                      d={`M 80,${280 - (results.optimalSpendingData.dataPoints[0].roi * 260 / 500)} ` + 
                         results.optimalSpendingData.dataPoints
                           .slice(0, 25) // Show first 25% spend levels
                           .map((point, i) => `L ${80 + (i * 26)},${280 - (point.roi * 260 / 500)}`)
                           .join(' ')}
                      fill="none"
                      stroke="#2563eb"
                      strokeWidth="3"
                    />
                    
                    {/* Sweet spot highlight */}
                    <rect
                      x={80 + (results.optimalSpendingData.optimalPercent * 26) - 15}
                      y="20"
                      width="30"
                      height="260"
                      fill="rgba(34, 197, 94, 0.1)"
                      stroke="rgba(34, 197, 94, 0.3)"
                      strokeWidth="2"
                    />
                    
                    {/* Labels */}
                    <text x="420" y="300" textAnchor="middle" className="text-sm fill-gray-600">
                      Marketing Spend (% of Revenue)
                    </text>
                    <text x="40" y="160" textAnchor="middle" className="text-sm fill-gray-600" transform="rotate(-90 40 160)">
                      ROI %
                    </text>
                    
                    {/* X-axis labels */}
                    {[0, 5, 10, 15, 20, 25].map(percent => (
                      <text key={percent} x={80 + (percent * 26)} y="295" textAnchor="middle" className="text-xs fill-gray-500">
                        {percent}%
                      </text>
                    ))}
                    
                    {/* Y-axis labels */}
                    {[0, 100, 200, 300, 400, 500].map((roi, i) => (
                      <text key={roi} x="75" y={285 - (i * 50)} textAnchor="end" className="text-xs fill-gray-500">
                        {roi}%
                      </text>
                    ))}
                    
                    {/* Sweet spot marker */}
                    <circle
                      cx={80 + (results.optimalSpendingData.optimalPercent * 26)}
                      cy={280 - (450 * 260 / 500)}
                      r="6"
                      fill="#22c55e"
                      stroke="#ffffff"
                      strokeWidth="2"
                    />
                    
                    {/* Sweet spot label */}
                    <text
                      x={80 + (results.optimalSpendingData.optimalPercent * 26)}
                      y={280 - (450 * 260 / 500) - 15}
                      textAnchor="middle"
                      className="text-sm font-bold fill-green-600"
                    >
                      Sweet Spot!
                    </text>
                  </svg>
                </div>
                
                <div className="mt-4 grid grid-cols-4 gap-4 text-center">
                  <div className="bg-red-50 rounded-lg p-3">
                    <div className="text-sm font-medium text-red-800">Minimal Impact Zone</div>
                    <div className="text-xs text-red-600">0-{results.optimalSpendingData.minPercent}%</div>
                    <div className="text-xs text-red-500">ROI: 50-150%</div>
                  </div>
                  <div className="bg-green-50 rounded-lg p-3">
                    <div className="text-sm font-medium text-green-800">Sweet Spot Zone</div>
                    <div className="text-xs text-green-600">{results.optimalSpendingData.minPercent}-{results.optimalSpendingData.optimalPercent}%</div>
                    <div className="text-xs text-green-500">ROI: 150-450%</div>
                  </div>
                  <div className="bg-blue-50 rounded-lg p-3">
                    <div className="text-sm font-medium text-blue-800">Good Zone</div>
                    <div className="text-xs text-blue-600">{results.optimalSpendingData.optimalPercent}-{results.optimalSpendingData.maxPercent}%</div>
                    <div className="text-xs text-blue-500">ROI: 300-450%</div>
                  </div>
                  <div className="bg-orange-50 rounded-lg p-3">
                    <div className="text-sm font-medium text-orange-800">Waste Zone</div>
                    <div className="text-xs text-orange-600">{results.optimalSpendingData.diminishingPercent}%+</div>
                    <div className="text-xs text-orange-500">ROI: 50-100%</div>
                  </div>
                </div>
                
                <div className="mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                  <h4 className="font-semibold text-yellow-800 mb-2">Key Takeaways for Your Business:</h4>
                  <div className="text-sm text-yellow-700 space-y-1">
                    <p>• Your sweet spot is around <strong>{results.optimalSpendingData.optimalPercent}% of revenue</strong> (£{results.optimalSpendingData.optimalAnnualSpend.toLocaleString()}/year)</p>
                    <p>• Spending less than {results.optimalSpendingData.minPercent}% means slow growth and missed opportunities</p>
                    <p>• Spending more than {results.optimalSpendingData.diminishingPercent}% means you're wasting money</p>
                    <p>• This is based on 2025 industry research for {formData.industry} businesses</p>
                  </div>
                </div>
              </div>
            )}
          </div>

          <div className="bg-blue-50 rounded-xl p-6 mb-8">
            <h3 className="text-lg font-semibold text-blue-900 mb-4">🏢 How We Calculated These Numbers (Simple Version)</h3>
            <div className="grid md:grid-cols-2 gap-6 text-sm text-blue-800">
              <div>
                <h4 className="font-semibold mb-2">🏢 We Looked at Your Business:</h4>
                <div>• How much you spend running your business: {results.calculationBasis.operationalExpensePercent}%</div>
                <div>• How much you spend on marketing: {results.calculationBasis.marketingSpendPercent}%</div>
                <div>• How much work can be automated: {results.calculationBasis.automatableAdminPercent}%</div>
                <div>• How much marketing can be automated: {results.calculationBasis.automatableMarketingPercent}%</div>
              </div>
              <div>
                <h4 className="font-semibold mb-2">💡 Our Safe Approach:</h4>
                <div>• We only count money you can actually automate: £{results.calculationBasis.automatableAdminBudget.toLocaleString()}</div>
                <div>• We only count marketing you can actually automate: £{results.calculationBasis.automatableMarketingBudget.toLocaleString()}</div>
                <div>• We use real research from 2025 studies</div>
                <div>• We're conservative so you won't be disappointed</div>
              </div>
            </div>
            <div className="mt-4 text-center text-blue-700">
              <strong>Bottom line:</strong> We only calculated ROI on money that can actually be automated, not your total budget. This keeps our predictions honest and achievable.
            </div>
          </div>

          <div className="bg-white rounded-xl p-8 shadow-lg border border-gray-100 mb-8">
            <h2 className="text-2xl font-bold text-gray-900 mb-6 flex items-center">
              <BarChart3 className="h-6 w-6 mr-2 text-blue-600" />
              Service Investment & Returns
            </h2>
            <div className="space-y-6">
              {formData.servicesInterested.map(serviceId => {
                const service = services.find(s => s.id === serviceId);
                const roi = results.serviceROI[serviceId];
                if (!roi) return null;
                
                return (
                  <div key={serviceId} className="border border-gray-200 rounded-lg p-6">
                    <div className="flex justify-between items-start mb-4">
                      <div>
                        <h3 className="text-lg font-semibold text-gray-900">{service.name}</h3>
                        <p className="text-gray-600">{service.desc}</p>
                        <p className="text-sm text-blue-600 mt-1">{roi.description}</p>
                        {roi.citations && (
                          <div className="text-xs text-blue-600 mt-2 bg-blue-50 p-2 rounded">
                            <div className="font-semibold mb-1">Research Foundation:</div>
                            {roi.citations.map((citation, idx) => (
                              <div key={idx} className="mb-1">• {citation}</div>
                            ))}
                          </div>
                        )}
                      </div>
                      <div className="text-right">
                        <div className="text-2xl font-bold text-green-600">{roi.roiPercent}% ROI</div>
                        <div className="text-sm text-gray-600">{roi.timeframe}</div>
                      </div>
                    </div>
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <div className="text-sm text-gray-600">Investment</div>
                        <div className="text-xl font-semibold text-gray-900">£{roi.investment.toLocaleString()}</div>
                      </div>
                      <div>
                        <div className="text-sm text-gray-600">Annual Returns</div>
                        <div className="text-xl font-semibold text-green-600">£{Math.round(roi.returns).toLocaleString()}</div>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>

          <div className="bg-gray-50 rounded-xl p-6 mb-8">
            <h3 className="text-lg font-semibold text-gray-900 mb-4">📚 Where We Got These Numbers From</h3>
            <p className="text-sm text-gray-700 mb-4">
              We didn't make these numbers up! They come from real research studies done in 2025 by trusted companies and universities.
            </p>
            <div className="grid md:grid-cols-2 gap-4 text-sm text-gray-600">
              {results.researchCitations.map((citation, index) => (
                <div key={index} className="flex items-start">
                  <span className="text-blue-600 mr-2">✓</span>
                  <span>{citation}</span>
                </div>
              ))}
            </div>
            <div className="mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-3">
              