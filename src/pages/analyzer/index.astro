---
import MainLayout from "../../layouts/MainLayout.astro";
import Navigation from "../../components/Navigation.astro";
import Footer from "../../components/Footer.astro";

// Site is now statically rendered
export const prerender = true;

const meta = {
  title: "AI Search Engine Readiness Analyzer | Free Website Analysis",
  description: "Our expert-built analyzer evaluates your website's readiness for both traditional search engines AND AI platforms like ChatGPT, revealing hidden opportunities your competition is missing.",
  keywords: "AI visibility analyzer, search engine readiness, website analysis tool, SEO analyzer, AI SEO, AEO, GEO optimization, free SEO tool, website audit tool, AI search optimization checker, ChatGPT optimization analyzer, Perplexity SEO check, AI content analyzer, website performance tester, SEO readiness test, AEO analyzer tool, GEO analyzer tool, search visibility checker, AI ranking factors, website grader, SEO audit free, AI search audit, website health check, digital visibility analyzer, search engine compatibility, AI platform readiness, competitive analysis tool, website optimization checker, content optimization analyzer, technical SEO analyzer, AI SEO checker, free website analyzer, online SEO analyzer, website evaluation tool, search optimization test, AI optimization scanner, website diagnostic tool, SEO performance analyzer, AI visibility test, search readiness assessment, website improvement tool, SEO opportunity finder, AI search compatibility, website scoring tool, SEO assessment free, AI platform optimizer, digital presence analyzer, search engine test, website review tool, SEO health checker, AI readiness assessment, Swansea SEO analyzer, Wales website analyzer, UK SEO tool",
  image: "https://digitalvisibility.com/digital-visibility-logo-f.png"
};
---

<MainLayout title={meta.title}>
  <!-- Comprehensive Meta Tags -->
  <meta name="description" content={meta.description} slot="head">
  <meta name="keywords" content={meta.keywords} slot="head">
  <link rel="canonical" href="https://digitalvisibility.com/analyzer/" slot="head">
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" slot="head">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" slot="head">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" slot="head">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" slot="head">
  <meta http-equiv="X-Robots-Tag" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" slot="head">
  <meta name="author" content="Darran Goulding" slot="head">
  
  <!-- Geographic and Local SEO Tags -->
  <meta name="geo.region" content="GB-WLS" slot="head">
  <meta name="geo.placename" content="Swansea" slot="head">
  <meta name="geo.position" content="51.6429;-3.9372" slot="head">
  <meta name="ICBM" content="51.6429, -3.9372" slot="head">
  <meta name="location" content="Swansea, Wales, United Kingdom" slot="head">
  <meta name="region" content="South Wales" slot="head">
  <meta name="country" content="United Kingdom" slot="head">
  <meta name="language" content="en-GB" slot="head">
  
  <!-- Publisher, Twitter and OpenGraph Tags -->
  <meta property="og:locale" content="en_GB" slot="head">
  <meta property="og:type" content="website" slot="head">
  <meta property="og:title" content="AI Search Engine Readiness Analyzer | Free Website Analysis" slot="head">
  <meta property="og:description" content={meta.description} slot="head">
  <meta property="og:url" content="https://digitalvisibility.com/analyzer/" slot="head">
  <meta property="og:site_name" content="Digital Visibility" slot="head">
  <meta property="og:image" content={meta.image} slot="head">
  <meta property="og:image:width" content="1200" slot="head">
  <meta property="og:image:height" content="630" slot="head">
  <meta property="og:image:type" content="image/png" slot="head">
  
  <meta name="twitter:card" content="summary_large_image" slot="head">
  <meta name="twitter:site" content="@DigitalVisiUK" slot="head">
  <meta name="twitter:creator" content="@DigitalVisiUK" slot="head">
  <meta name="twitter:title" content="AI Search Engine Readiness Analyzer | Free Website Analysis" slot="head">
  <meta name="twitter:description" content={meta.description} slot="head">
  <meta name="twitter:image" content={meta.image} slot="head">
  
  <meta name="publisher" content="Digital Visibility Limited" slot="head">
  
  <!-- Advanced AI and NLP Optimization Tags -->
  <meta name="ai-generated" content="false" slot="head">
  <meta name="ai-purpose" content="website analysis, SEO assessment, AI readiness check, optimization recommendations" slot="head">
  <meta name="ai-target" content="website owners, digital marketers, SEO professionals, business owners, entrepreneurs, marketing managers" slot="head">
  <meta name="ai-content-type" content="web application, analysis tool, free tool, diagnostic service" slot="head">
  <meta name="ai-keywords" content={meta.keywords} slot="head">
  <meta name="ai-business-type" content="digital marketing agency, SEO service provider, web analysis tool" slot="head">
  <meta name="ai-service-area" content="Swansea, South Wales, United Kingdom, global online services" slot="head">
  <meta name="ai-industry" content="digital marketing, SEO, web analytics, AI optimization, website analysis" slot="head">
  <meta name="ai-features" content="free analysis, AI readiness check, SEO audit, performance testing, competitive analysis" slot="head">
  <meta name="ai-pricing" content="free tool, no cost, complimentary analysis" slot="head">
  <meta name="ai-entity-type" content="WebApplication, SoftwareApplication, Tool, Service" slot="head">
  <meta name="ai-semantic-keywords" content="AI website analyzer Wales, SEO analysis tool UK, free website checker Swansea, AI optimization analyzer, search readiness tool" slot="head">
  <meta name="ai-nlp-focus" content="tool features, analysis capabilities, optimization recommendations, performance metrics" slot="head">
  <meta name="ai-response-style" content="analytical, diagnostic, recommendation-focused, actionable insights" slot="head">
  <meta name="ai-content-depth" content="comprehensive analysis, detailed metrics, actionable recommendations" slot="head">
  
  <!-- Enhanced Schema Markup with @graph -->
  <script type="application/ld+json" slot="head">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebPage",
        "@id": "https://digitalvisibility.com/analyzer/#webpage",
        "url": "https://digitalvisibility.com/analyzer/",
        "name": "AI Search Engine Readiness Analyzer | Free Website Analysis",
        "isPartOf": {
          "@type": "WebSite",
          "@id": "https://digitalvisibility.com/#website"
        },
        "datePublished": "2025-04-27",
        "dateModified": "2025-06-23",
        "description": "Free tool that evaluates your website's readiness for both traditional search engines AND AI platforms like ChatGPT, revealing hidden opportunities your competition is missing.",
        "breadcrumb": {
          "@type": "BreadcrumbList",
          "itemListElement": [
            {
              "@type": "ListItem",
              "position": 1,
              "name": "Home",
              "item": "https://digitalvisibility.com"
            },
            {
              "@type": "ListItem",
              "position": 2,
              "name": "Analyzer",
              "item": "https://digitalvisibility.com/analyzer"
            }
          ]
        },
        "primaryImageOfPage": {
          "@type": "ImageObject",
          "contentUrl": "https://digitalvisibility.com/digital-visibility-logo-f.png"
        },
        "about": {
          "@type": "WebApplication",
          "@id": "https://digitalvisibility.com/analyzer/#webapplication"
        }
      },
      {
        "@type": "WebApplication",
        "@id": "https://digitalvisibility.com/analyzer/#webapplication",
        "name": "AI Search Engine Readiness Analyzer",
        "url": "https://digitalvisibility.com/analyzer/",
        "applicationCategory": "BusinessApplication",
        "operatingSystem": "Web browser",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "GBP",
          "availability": "https://schema.org/InStock"
        },
        "description": "Our expert-built analyzer evaluates your website's readiness for both traditional search engines AND AI platforms like ChatGPT, revealing hidden opportunities your competition is missing. Get a free comprehensive analysis with actionable recommendations.",
        "datePublished": "2025-04-27",
        "dateModified": "2025-06-23",
        "provider": {
          "@type": "Organization",
          "@id": "https://digitalvisibility.com/#organization"
        },
        "creator": {
          "@type": "Person",
          "@id": "https://digitalvisibility.com/about/darran-goulding/#person"
        },
        "audience": {
          "@type": "Audience",
          "audienceType": "Website owners, Digital marketers, SEO professionals, Business owners"
        },
        "potentialAction": {
          "@type": "UseAction",
          "target": {
            "@type": "EntryPoint",
            "urlTemplate": "https://digitalvisibility.com/analyzer/"
          },
          "name": "Analyze Your Website"
        },
        "featureList": [
          "Human-Led Analysis",
          "Actionable Strategy Roadmap",
          "Competitive Edge Insights",
          "AI Platform Readiness Check",
          "Performance Optimization Analysis",
          "Citation and Reference Analysis",
          "Authority and Trust Signal Assessment",
          "Free Comprehensive Report",
          "No Registration Required",
          "Instant Results"
        ]
      },
      {
        "@type": "SoftwareApplication",
        "@id": "https://digitalvisibility.com/analyzer/#software",
        "name": "AI Visibility Analyzer",
        "applicationCategory": "BusinessApplication",
        "operatingSystem": "Web browser",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "GBP"
        },
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "4.8",
          "ratingCount": "156",
          "bestRating": "5"
        },
        "applicationSubCategory": "SEO Tools",
        "screenshot": "https://digitalvisibility.com/analyzer-screenshot.webp",
        "softwareHelp": {
          "@type": "CreativeWork",
          "url": "https://digitalvisibility.com/contact/"
        },
        "isAccessibleForFree": true,
        "review": [
          {
            "@type": "Review",
            "author": {
              "@type": "Person",
              "name": "Sarah T."
            },
            "reviewBody": "Your analyzer found SEO issues our previous audit completely missed. We've implemented the suggestions and already seen a 27% traffic increase!",
            "reviewRating": {
              "@type": "Rating",
              "ratingValue": "5",
              "bestRating": "5"
            }
          },
          {
            "@type": "Review",
            "author": {
              "@type": "Person",
              "name": "Mark Johnson"
            },
            "reviewBody": "The AI readiness insights were eye-opening. We had no idea we were missing so many opportunities with AI search engines.",
            "reviewRating": {
              "@type": "Rating",
              "ratingValue": "5",
              "bestRating": "5"
            }
          }
        ]
      }
    ]
  }
  </script>
  
  <!-- Cloudflare Turnstile Script -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit" async defer slot="head"></script>
  
  <Navigation slot="nav" />
  
  <!-- Error Alert -->
  <div id="errorAlert" class="fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded max-w-md w-full hidden z-50" role="alert">
    <span id="errorMessage" class="block text-center"></span>
  </div>

  <!-- AI Visibility Analyzer Section -->
  <section id="ai-analyzer" class="bg-blue-50 py-16 border-b border-blue-100 relative overflow-hidden">
    <!-- Background decoration elements -->
    <div class="absolute top-0 right-0 w-96 h-96 bg-blue-100 rounded-full opacity-30 transform translate-x-1/3 -translate-y-1/3"></div>
    <div class="absolute bottom-0 left-0 w-64 h-64 bg-blue-100 rounded-full opacity-20 transform -translate-x-1/3 translate-y-1/3"></div>
    
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
      <div class="text-center mb-10">
        <div class="inline-block px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium mb-3">FREE TOOL</div>
        <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4 leading-tight">AI Visibility Analyzer</h2>
        <p class="text-xl text-gray-700 max-w-3xl mx-auto">Our expert-built analyzer evaluates your website's readiness for both traditional search engines AND AI platforms like ChatGPT, revealing hidden opportunities your competition is missing.</p>
      </div>
      
      <div class="grid md:grid-cols-2 gap-12 items-start">
        <div class="space-y-6 md:sticky md:top-24">
          <!-- Left side content: Benefits & Features -->
          <div class="bg-white rounded-xl shadow-lg p-8 md:block hidden">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
              <!-- Feature 1 -->
              <div class="flex items-start">
                <div class="bg-blue-100 p-3 rounded-full mr-4">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                  </svg>
                </div>
                <div>
                  <h3 class="font-bold text-gray-900 text-lg mb-1">Human-Led Analysis</h3>
                  <p class="text-gray-600 text-sm">Our experts personally review each analysis, combining AI power with human expertise.</p>
                </div>
              </div>
              
              <!-- Feature 2 -->
              <div class="flex items-start">
                <div class="bg-blue-100 p-3 rounded-full mr-4">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                  </svg>
                </div>
                <div>
                  <h3 class="font-bold text-gray-900 text-lg mb-1">Actionable Strategy</h3>
                  <p class="text-gray-600 text-sm">Receive a prioritized roadmap of improvements with clear, specific actions to boost visibility.</p>
                </div>
              </div>
              
              <!-- Feature 3 -->
              <div class="flex items-start">
                <div class="bg-blue-100 p-3 rounded-full mr-4">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                  </svg>
                </div>
                <div>
                  <h3 class="font-bold text-gray-900 text-lg mb-1">Competitive Edge</h3>
                  <p class="text-gray-600 text-sm">See exactly how you compare to top competitors and discover opportunities they're not.</p>
                </div>
              </div>
              
              <!-- Feature 4: Testimonial -->
              <div class="flex items-start col-span-full md:col-span-1">
                <div class="bg-yellow-100 p-3 rounded-full mr-4">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                  </svg>
                </div>
                <div>
                  <div class="font-medium text-yellow-600 text-sm mb-1">⭐⭐⭐⭐⭐</div>
                  <p class="text-gray-700 text-sm italic">"The analyzer provided critical areas we were missing. After implementing the recommendations, our traffic jumped 74% in just weeks!"</p>
                  <p class="text-gray-500 text-xs mt-1">— Sarah T, Marketing Director</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Mobile view features -->
          <div class="md:hidden space-y-4">
            <div class="flex items-center">
              <div class="bg-blue-100 p-2 rounded-full mr-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                </svg>
              </div>
              <p class="text-gray-700 font-medium">Human-Led AI Analysis</p>
            </div>
            <div class="flex items-center">
              <div class="bg-blue-100 p-2 rounded-full mr-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
              </div>
              <p class="text-gray-700 font-medium">Actionable Strategy Roadmap</p>
            </div>
            <div class="flex items-center">
              <div class="bg-blue-100 p-2 rounded-full mr-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                </svg>
              </div>
              <p class="text-gray-700 font-medium">Competitive Edge Insights</p>
            </div>
          </div>
          
          <!-- New Results Card under human-led analysis card -->
          <div id="secondResultsCard" class="bg-white rounded-xl shadow-lg p-8 mt-6 hidden">
            <h3 class="text-xl font-bold text-gray-900 mb-6">Additional Analysis Results</h3>
            <div class="space-y-8 max-w-full overflow-x-hidden">
            <!-- Performance Optimization -->
            <div class="mb-10 p-6 border border-amber-100 rounded-xl bg-amber-50">
              <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-4">
                <div>
                  <h3 class="text-2xl font-semibold text-gray-900">Performance Optimization</h3>
                  <p class="text-sm text-amber-700 font-medium">Critical for user experience and AI ranking signals</p>
                </div>
                <span id="performanceScore" class="text-2xl font-bold text-amber-600">0%</span>
              </div>
              <div class="w-full bg-white rounded-full h-5 mb-4">
                <div id="performanceScoreBar" class="bg-amber-500 h-5 rounded-full transition-all duration-1000" style="width: 0%"></div>
              </div>
              
              <div class="bg-white p-3 sm:p-4 rounded-lg mb-6 shadow-sm overflow-x-auto">
                <p class="text-gray-700"><span class="font-semibold text-amber-800">Why this matters:</span> Site performance directly impacts how AI systems evaluate user experience. AI platforms heavily weight Core Web Vitals metrics when determining content quality and ranking positions. Faster sites create better first impressions for both users and AI systems.</p>
                <div class="flex items-center gap-2 mt-3 text-sm text-amber-600">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                  </svg>
                  <span>Websites with excellent performance scores receive 32% more visibility in AI search results.</span>
                </div>
              </div>
              
              <div class="flex flex-col gap-4 mb-6 w-full overflow-x-hidden">
                <div id="preload" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                  <div class="w-12 h-12 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold mt-1"></div>
                  <div>
                    <span class="font-semibold text-gray-900">Resource Preloading</span>
                    <p class="text-sm text-gray-600 mt-1">Preloading critical resources speeds up page rendering for users</p>
                  </div>
                </div>
                <div id="preconnect" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                  <div class="w-12 h-12 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold mt-1"></div>
                  <div>
                    <span class="font-semibold text-gray-900">DNS Preconnect</span>
                    <p class="text-sm text-gray-600 mt-1">Preconnect to third-party domains reduces connection setup times</p>
                  </div>
                </div>
                <div id="defer" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                  <div class="w-12 h-12 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold mt-1"></div>
                  <div>
                    <span class="font-semibold text-gray-900">Script Loading</span>
                    <p class="text-sm text-gray-600 mt-1">Properly defer non-critical scripts for faster initial page rendering</p>
                  </div>
                </div>
                <div id="lazyLoad" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                  <div class="w-12 h-12 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold mt-1"></div>
                  <div>
                    <span class="font-semibold text-gray-900">Lazy Loading</span>
                    <p class="text-sm text-gray-600 mt-1">Load images and components only when they enter the viewport</p>
                  </div>
                </div>
              </div>
              
              <div class="mt-6 p-4 bg-gradient-to-r from-amber-600 to-amber-500 rounded-lg text-white">
                <p class="font-medium mb-4">Slow-loading websites lose 53% of mobile visitors and are downranked by AI platforms. Get a lightning-fast, fully optimized site that converts visitors into customers and ranks higher in all search systems.</p>
                <div class="flex justify-center">
                  <a href="/pricing/#free-website" class="bg-white text-amber-600 hover:bg-amber-50 px-6 py-2 rounded-md font-medium inline-flex items-center">
                    Get a FREE Lightning-Fast Website
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                  </a>
                </div>
              </div>
            </div>
            
            <!-- Citations & References -->
            <div class="mb-10 p-6 border border-teal-100 rounded-xl bg-teal-50">
              <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-4">
                <div>
                  <h3 class="text-2xl font-semibold text-gray-900">Citations & References</h3>
                  <p class="text-sm text-teal-700 font-medium">Critical for establishing content credibility with AI</p>
                </div>
                <span id="citations-score" class="text-2xl font-bold text-teal-600">0%</span>
              </div>
              <div class="w-full bg-white rounded-full h-5 mb-4">
                <div id="citations-bar" class="bg-teal-500 h-5 rounded-full transition-all duration-1000" style="width: 0%"></div>
              </div>
              
              <div class="bg-white p-3 sm:p-4 rounded-lg mb-6 shadow-sm overflow-x-auto">
                <p class="text-gray-700"><span class="font-semibold text-teal-800">Why this matters:</span> AI systems heavily reward content that cites reputable sources. Citations and references demonstrate expertise and trustworthiness, which are primary factors in whether AI systems like ChatGPT, Perplexity and Anthropic will recommend your content to users.</p>
                <div class="flex items-center gap-2 mt-3 text-sm text-teal-600">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                  </svg>
                  <span>Content with proper citations is 4.7x more likely to be referenced by AI assistants.</span>
                </div>
              </div>
              
              <div class="flex flex-col gap-4 mb-6 w-full overflow-x-hidden">
                <div id="citation-elements" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                  <div class="w-12 h-12 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold mt-1"></div>
                  <div>
                    <span class="font-semibold text-gray-900">Proper Citation Elements</span>
                    <p class="text-sm text-gray-600 mt-1">Using appropriate HTML elements to properly format citations</p>
                  </div>
                </div>
                <div id="reference-links" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                  <div class="w-12 h-12 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold mt-1"></div>
                  <div>
                    <span class="font-semibold text-gray-900">External References</span>
                    <p class="text-sm text-gray-600 mt-1">Links to authoritative sources that support your content claims</p>
                  </div>
                </div>
              </div>
              
              <div id="citation-debug-info" class="hidden bg-gray-100 p-3 rounded-lg text-xs mb-4"></div>
              
              <div class="mt-6 p-4 bg-gradient-to-r from-teal-600 to-teal-500 rounded-lg text-white">
                <p class="font-medium mb-4">Trust is the new currency in AI search. Our expert team has developed authoritative, properly-cited content for hundreds of businesses that ranks higher, builds credibility, and earns customer trust instantly. Learn more about our proven track record in creating content that both AI systems and customers love.</p>
                <div class="flex justify-center">
                  <a href="/about/" class="bg-white text-teal-600 hover:bg-teal-50 px-6 py-2 rounded-md font-medium inline-flex items-center">
                    Meet Our Expert Team
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                  </a>
                </div>
              </div>
            </div>
            
            <!-- Authority & Trust Signals -->
            <div class="mb-10 p-6 border border-indigo-100 rounded-xl bg-indigo-50">
              <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-4">
                <div>
                  <h3 class="text-2xl font-semibold text-gray-900">Authority & Trust Signals</h3>
                  <p class="text-sm text-indigo-700 font-medium">Critical for source credibility with AI systems</p>
                </div>
                <span id="authority-score" class="text-2xl font-bold text-indigo-600">0%</span>
              </div>
              <div class="w-full bg-white rounded-full h-5 mb-4">
                <div id="authority-bar" class="bg-indigo-500 h-5 rounded-full transition-all duration-1000" style="width: 0%"></div>
              </div>
              
              <div class="bg-white p-3 sm:p-4 rounded-lg mb-6 shadow-sm overflow-x-auto">
                <p class="text-gray-700"><span class="font-semibold text-indigo-800">Why this matters:</span> AI search engines prioritize content with clear authority and expertise signals. For businesses, this means prominently featuring who is behind your content, their credentials, and connecting to established industry platforms that verify your legitimacy.</p>
                <div class="flex items-center gap-2 mt-3 text-sm text-indigo-600">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                  </svg>
                  <span>Businesses with strong authority signals receive 3.6x more visibility in AI-generated responses.</span>
                </div>
              </div>
              
              <div class="flex flex-col gap-4 mb-6 w-full overflow-x-hidden">
                <div id="author-info" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                  <div class="w-12 h-12 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold mt-1"></div>
                  <div>
                    <span class="font-semibold text-gray-900">Author Information</span>
                    <p class="text-sm text-gray-600 mt-1">Clear author identification with credentials on content pages</p>
                  </div>
                </div>
                <div id="author-bio" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                  <div class="w-12 h-12 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold mt-1"></div>
                  <div>
                    <span class="font-semibold text-gray-900">Author Bio</span>
                    <p class="text-sm text-gray-600 mt-1">Detailed professional background establishing topical authority</p>
                  </div>
                </div>
                <div id="social-media-links" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                  <div class="w-12 h-12 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold mt-1"></div>
                  <div>
                    <span class="font-semibold text-gray-900">Social Media Links</span>
                    <p class="text-sm text-gray-600 mt-1">Connections to established social profiles verify identity</p>
                  </div>
                </div>
                <div id="business-profile-links" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                  <div class="w-12 h-12 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold mt-1"></div>
                  <div>
                    <span class="font-semibold text-gray-900">Business Profile Links</span>
                    <p class="text-sm text-gray-600 mt-1">Links to Google Business, industry directories, and platforms</p>
                  </div>
                </div>

                <!-- Personalized CTA Card (Hidden Initially) -->
                <div id="personalized-cta" class="hidden mt-6 p-6 bg-gradient-to-r from-blue-700 to-indigo-600 rounded-xl shadow-xl text-white">
                  <h3 class="text-2xl font-bold mb-3 text-center" id="personalized-heading">What <span id="website-domain">Your Website</span> Is Missing</h3>
                  <p class="mb-3 text-center" id="personalized-message">Based on your analysis, we've identified specific opportunities to dramatically increase your visibility and conversions.</p>
                  <div id="personalized-recommendations" class="mb-5 bg-white/10 p-4 rounded-lg">
                    <!-- This will be populated dynamically based on scores -->
                  </div>
                  <p class="text-center mb-5 font-medium">Our team specializes in transforming websites into powerful business growth engines that build trust, improve rankings, and drive sales. Start with a free consultation to see how we can help <span id="website-name-emphasis">your business</span> achieve measurable results across all digital channels.</p>
                  <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <a href="/pricing/#free-website" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg text-center transition-colors duration-200">
                      Get a FREE Website
                    </a>
                    <a href="/contact/" class="bg-white text-blue-700 hover:bg-blue-50 font-bold py-3 px-6 rounded-lg text-center transition-colors duration-200">
                      Book a Consultation
                    </a>
                  </div>
                </div>
              </div>
            </div>
            </div>
          </div>
        </div>
        
        <!-- Right side: Analyzer Form & Results -->
        <div>
          <div id="analyzerSection" class="bg-white rounded-xl shadow-lg overflow-hidden max-w-full">
            <div class="p-8">
              <h3 id="analyzerHeading" class="text-2xl font-bold text-gray-900 mb-6">Get Your Free Visibility Analysis</h3>
              <p class="text-gray-600 mb-6">Discover how to improve your position with both traditional search and AI platforms.</p>
              
              <!-- Multi-step Analyzer Form -->
          <div id="multiStepAnalyzerContainer">
            <!-- New Multi-step form -->
            <div id="leadGenSteps">
              <!-- Step 1: Initial URL Input -->
              <div id="leadStep1" class="lead-step">
                <form id="leadUrlForm" class="flex flex-col gap-4">
                  <div class="relative flex-grow">
                    <input 
                      type="text" 
                      id="leadInitialUrlInput" 
                      placeholder="Enter website URL (e.g., example.com)" 
                      class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      required
                    >
                  </div>
                  <button 
                    type="submit" 
                    id="leadUrlSubmitButton"
                    class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-6 rounded-lg transition-colors duration-200"
                  >
                    <span id="leadUrlButtonText">Continue</span>
                    <span id="leadUrlButtonSpinner" class="hidden">
                      <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg>
                    </span>
                  </button>
                </form>
              </div>
              
              <!-- Step 2: Contact Information -->
              <div id="leadStep2" class="lead-step hidden">
                <div class="mb-4 p-4 bg-blue-50 rounded-lg">
                  <p class="text-blue-800">Ready to analyze: <span id="leadUrlToAnalyze" class="font-semibold"></span></p>
                </div>
                
                <form id="leadContactForm" class="flex flex-col gap-4">
                  <!-- Web3Forms access key -->
                  <input type="hidden" name="access_key" value="04b98b5a-c1af-43bf-a223-9f711109ac82">
                  <input type="hidden" name="subject" value="New Website Analysis Lead">
                  <input type="hidden" name="from_name" value="Digital Visibility Analyzer">
                  <input type="hidden" name="to_email" value="support@digitalvisibility.com">
                  <input type="hidden" id="leadAnalyzedUrlField" name="analyzed_url" value="">
                  <input type="hidden" name="website_analysis" value="requested">
                  
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label for="leadNameInput" class="block text-sm font-medium text-gray-700 mb-1">Your Name *</label>
                      <input 
                        type="text" 
                        id="leadNameInput" 
                        name="name"
                        placeholder="Full Name" 
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        required
                      >
                    </div>
                    <div>
                      <label for="leadEmailInput" class="block text-sm font-medium text-gray-700 mb-1">Email Address *</label>
                      <input 
                        type="email" 
                        id="leadEmailInput" 
                        name="email"
                        placeholder="you@example.com" 
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        required
                      >
                    </div>
                  </div>
                  
                  <div>
                    <label for="leadBusinessNameInput" class="block text-sm font-medium text-gray-700 mb-1">Business Name (Optional)</label>
                    <input 
                      type="text" 
                      id="leadBusinessNameInput" 
                      name="business_name"
                      placeholder="Your Company Name" 
                      class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    >
                  </div>
                  
                  <div>
                    <label for="leadPhoneInput" class="block text-sm font-medium text-gray-700 mb-1">Contact Number (Optional)</label>
                    <input 
                      type="tel" 
                      id="leadPhoneInput" 
                      name="phone"
                      placeholder="+44 7700 900000" 
                      class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    >
                  </div>
                  
                  <!-- Cloudflare Turnstile widget -->
                  <div class="mt-3">
                    <div id="cf-turnstile-container" class="cf-turnstile"></div>
                    <input type="hidden" name="cf-turnstile-response" id="leadTurnstileResponse">
                  </div>
                  
                  <div class="mt-2">
                    <label class="inline-flex items-center">
                      <input type="checkbox" id="leadMarketingConsent" name="consent" class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" required>
                      <span class="ml-2 text-sm text-gray-600">I agree to receive marketing communications about Digital Visibility services and insights.*</span>
                    </label>
                  </div>
                  
                  <div class="flex space-x-4">
                    <button 
                      type="button" 
                      id="leadBackToStep1Button"
                      class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-3 px-6 rounded-lg transition-colors duration-200"
                    >
                      Back
                    </button>
                    <button 
                      type="submit" 
                      id="leadSubmitContactButton"
                      class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-6 rounded-lg transition-colors duration-200 flex-grow"
                    >
                      <span id="leadContactButtonText">Get Free Analysis</span>
                      <span id="leadContactButtonSpinner" class="hidden ml-2">
                        <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                      </span>
                    </button>
                  </div>
                </form>
              </div>
            </div>

            <!-- Original Analyzer Form (Hidden initially) -->
            <div id="originalAnalyzerContainer" class="hidden">
              <div id="analyzerSteps">
                <!-- Step 1: URL Input - THIS IS THE ORIGINAL FORM -->
                <div id="step1" class="analyzer-step">
                  <form id="analyzeForm" class="flex flex-col gap-4">
                    <div class="relative flex-grow">
                      <input 
                        type="url" 
                        id="urlInput" 
                        placeholder="Enter website URL (e.g., example.com)" 
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        required
                      >
                    </div>
                    <button 
                      type="submit" 
                      id="analyzeButton"
                      class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-6 rounded-lg transition-colors duration-200"
                    >
                      <span id="buttonText">Continue</span>
                      <span id="buttonSpinner" class="hidden">
                        <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                      </span>
                    </button>
                  </form>
                </div>
              </div>
          </div>
            
        <!-- Error Alert -->
        <div id="errorAlert" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded-md">
          <p id="errorMessage">Please enter a valid URL.</p>
        </div>
            
        <!-- Results Section (Hidden Initially) -->
        <div id="resultsSection" class="hidden max-w-full">
          <div class="bg-white p-4 sm:p-8 rounded-xl shadow-lg mb-8 border-t-4 border-blue-500 overflow-x-hidden">
            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 gap-3">
              <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 break-words">Analysis Results for <span id="analyzedUrl" class="text-blue-600 break-all"></span></h2>
              <div class="bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm font-semibold">FREE ANALYSIS</div>
            </div>
            
            <!-- Main Score -->
            <div class="mb-10">
              <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-4">
                <h2 class="text-2xl font-bold text-gray-900">Overall AI Readiness Score</h2>
                <span id="overallScore" class="text-3xl font-bold text-blue-600">0%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-7 mb-2">
                <div id="overallScoreBar" class="bg-blue-500 h-7 rounded-full transition-all duration-1000" style="width: 0%"></div>
              </div>
              <p class="text-gray-700 italic">This score represents how well your website is optimized for both traditional search engines and new AI platforms.</p>
            </div>
            
            <!-- AI Search Engine Optimization -->
            <div class="mb-10 p-4 sm:p-6 border border-blue-100 rounded-xl bg-blue-50 overflow-x-hidden">
              <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-4">
                <div>
                  <h3 class="text-2xl font-semibold text-gray-900">AI Search Engine Optimization</h3>
                  <p class="text-sm text-blue-700 font-medium max-w-full break-words">Critical for visibility in Google Snippets and AI Overviews, Microsoft Bing, ChatGPT, Claude, Perplexity, Alexa, Siri & Many More</p>
                </div>
                <span id="aiSeoScore" class="text-2xl font-bold text-blue-600">0%</span>
              </div>
              <div class="w-full bg-white rounded-full h-5 mb-4">
                <div id="aiSeoScoreBar" class="bg-blue-500 h-5 rounded-full transition-all duration-1000" style="width: 0%"></div>
              </div>
              
              <div class="bg-white p-3 sm:p-4 rounded-lg mb-6 shadow-sm overflow-x-auto">
                <p class="text-gray-700"><span class="font-semibold text-blue-800">Why this matters:</span> AI search engines evaluate your content differently than traditional crawlers. Without proper optimization, your business could be invisible to millions of potential customers using AI assistants.</p>
                <div class="flex items-center gap-2 mt-3 text-sm text-blue-600">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                  </svg>
                  <span>Websites optimized for AI see a 73% higher chance of appearing in AI responses.</span>
                </div>
              </div>
              
              <div class="flex flex-col gap-4 mb-6 w-full overflow-x-hidden">
                <div id="schemaMarkup" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                  <div class="w-10 h-10 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-xl font-bold mt-1"></div>
                  <div>
                    <span class="font-semibold text-gray-900">Schema Markup</span>
                    <p class="text-sm text-gray-600 mt-1">Structured data that helps AI understand your content's meaning and context</p>
                  </div>
                </div>
                <div id="schemaQuality" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                  <div class="w-10 h-10 flex-shrink-0 rounded-lg bg-gray-200 flex items-center justify-center text-xl font-bold mt-1"></div>
                  <div>
                    <span class="font-semibold text-gray-900">Schema Quality</span>
                    <p class="text-sm text-gray-600 mt-1">How comprehensive and accurate your structured data implementation is</p>
                  </div>
                </div>
                <div id="aiFiles" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                  <div class="w-10 h-10 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-xl font-bold mt-1"></div>
                  <div>
                    <span class="font-semibold text-gray-900">AI-Optimized Files</span>
                    <p class="text-sm text-gray-600 mt-1">Files specifically formatted for AI understanding and indexing</p>
                  </div>
                </div>
                <div id="ai-meta-tags" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                  <div class="w-10 h-10 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-xl font-bold mt-1"></div>
                  <div>
                    <span class="font-semibold text-gray-900">AI-Optimized Meta Tags</span>
                    <p class="text-sm text-gray-600 mt-1">Special metadata that provides context cues to AI systems</p>
                  </div>
                </div>
              </div>
              
              <!-- Schema Types and Recommendations Container -->
              
              <div class="mt-6 p-4 bg-gradient-to-r from-blue-600 to-blue-500 rounded-lg text-white overflow-hidden">
                <p class="font-medium mb-4">Missing Schema? You're Invisible to AI. Our experts can implement complete AI-optimized schema markup.</p>
                <div class="flex justify-center">
                  <a href="/pricing/#hour-packages" class="bg-white text-blue-600 hover:bg-blue-50 px-6 py-2 rounded-md font-medium inline-flex items-center">
                    Complete Visibility Packages from £40/mo
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                  </a>
                </div>
              </div>
            </div>
            
            <!-- Image Optimization -->
            <div class="mb-10 p-4 sm:p-6 border border-green-100 rounded-xl bg-green-50 overflow-x-auto">
              <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-4">
                <div>
                  <h3 class="text-2xl font-semibold text-gray-900">Image Optimization</h3>
                  <p class="text-sm text-green-700 font-medium">Critical for both SEO ranking and AI visual understanding</p>
                </div>
                <span id="image-optimization-score" class="text-2xl font-bold text-green-600">0%</span>
              </div>
              <div class="w-full bg-white rounded-full h-5 mb-4">
                <div id="image-optimization-bar" class="bg-green-500 h-5 rounded-full transition-all duration-1000" style="width: 0%"></div>
              </div>
              
              <div class="bg-white p-3 sm:p-4 rounded-lg mb-6 shadow-sm overflow-x-auto">
                <p class="text-gray-700"><span class="font-semibold text-green-800">Why this matters:</span> Images account for over 20% of an AI's ability to understand your website content. Properly optimized images improve your site's load speed, user experience, and dramatically boost your visibility in both traditional and AI search engines.</p>
                <div class="flex items-center gap-2 mt-3 text-sm text-green-600">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                  </svg>
                  <span>Sites with properly optimized images rank significantly higher in AI search results.</span>
                </div>
              </div>
              
              <div class="flex flex-col gap-4 mb-6 w-full overflow-x-hidden">
                <div id="modern-image-formats" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                  <div class="w-12 h-12 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold mt-1"></div>
                  <div>
                    <span class="font-semibold text-gray-900">Modern Image Formats</span>
                    <p class="text-sm text-gray-600 mt-1">Using WebP/AVIF formats reduces file size by up to 30% while maintaining quality</p>
                  </div>
                </div>
                <div id="descriptive-alt-text" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                  <div class="w-12 h-12 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold mt-1"></div>
                  <div>
                    <span class="font-semibold text-gray-900">Descriptive Alt Text</span>
                    <p class="text-sm text-gray-600 mt-1">Helps AI systems understand your image content and improves accessibility</p>
                  </div>
                </div>
              </div>
              
              <div class="mt-6 p-4 bg-gradient-to-r from-green-600 to-green-500 rounded-lg text-white">
                <p class="font-medium mb-4">Poor Image Optimization = Invisible to AI. Our team will optimize all your images with AI-descriptive formats and alt text.</p>
                <div class="flex justify-center">
                  <a href="/services/digital-marketing/" class="bg-white text-green-600 hover:bg-green-50 px-6 py-2 rounded-md font-medium inline-flex items-center">
                    See Our Services
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                  </a>
                </div>
              </div>
            </div>
            
            <!-- Content Freshness -->
            <div class="mb-10 p-4 sm:p-6 border border-purple-100 rounded-xl bg-purple-50 overflow-x-auto">
              <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-4">
                <div>
                  <h3 class="text-2xl font-semibold text-gray-900">Content Freshness</h3>
                  <p class="text-sm text-purple-700 font-medium">Critical for AI relevance ranking and source selection</p>
                </div>
                <span id="content-freshness-score" class="text-2xl font-bold text-purple-600">0%</span>
              </div>
              <div class="w-full bg-white rounded-full h-5 mb-4">
                <div id="content-freshness-bar" class="bg-purple-500 h-5 rounded-full transition-all duration-1000" style="width: 0%"></div>
              </div>
              
              <div class="bg-white p-3 sm:p-4 rounded-lg mb-6 shadow-sm overflow-x-auto">
                <p class="text-gray-700"><span class="font-semibold text-purple-800">Why this matters:</span> AI search engines prioritize fresh content with clear timestamps. When an AI assistant like ChatGPT or Claude chooses which websites to reference in its responses, recency is a major deciding factor that can determine if your content is used or ignored.</p>
                <div class="flex items-center gap-2 mt-3 text-sm text-purple-600">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                  </svg>
                  <span>Content updated within the last 60 days is 2.3x more likely to be cited by AI systems.</span>
                </div>
              </div>
              

                  <div id="published-date" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                    <div class="w-12 h-12 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold mt-1"></div>
                    <div>
                      <span class="font-semibold text-gray-900">Published Date Metadata</span>
                      <p class="text-sm text-gray-600 mt-1">Standard metadata tag showing when content was created (meta name="date" or "published_date")</p>
                    </div>
                  </div>
                  <div id="modified-date" class="flex items-start gap-3 bg-white p-4 rounded-lg shadow-sm">
                    <div class="w-12 h-12 flex-shrink-0 rounded-full bg-gray-200 flex items-center justify-center text-2xl font-bold mt-1"></div>
                    <div>
                      <span class="font-semibold text-gray-900">Modified Date Metadata</span>
                      <p class="text-sm text-gray-600 mt-1">Standard metadata tag showing when content was last updated (meta name="modified_date")</p>
                    </div>
                  </div>
                  
                  <h4 class="font-semibold text-purple-800 mt-6 mb-3">Alternative Date Sources</h4>
                  <div class="bg-purple-50 p-5 rounded-lg border border-purple-100 mb-4">
                    <p class="text-gray-700">Our AI-powered analysis goes beyond standard metadata tags to accurately determine content freshness. We use advanced techniques to detect date information from:</p>
                    <ul class="list-disc list-inside mt-3 space-y-2 text-gray-700">
                      <li><span class="font-medium">Visible date elements</span> - Text dates displayed on your pages (e.g., "Posted on April 10, 2025")</li>
                      <li><span class="font-medium">HTML timestamp analysis</span> - Dates embedded in your code through time elements or schema markup</li>
                      <li><span class="font-medium">Content context evaluation</span> - References to events, holidays, or seasons that indicate recency</li>
                      <li><span class="font-medium">Technical indicators</span> - File creation and modification timestamps</li>
                    </ul>
                    <p class="mt-3 text-gray-700">Even without explicit date metadata, our system can evaluate content freshness to provide an accurate content age assessment for AI visibility optimization.</p>
                  </div>
                </div>
                
                <div class="border border-purple-200 rounded-lg p-4 bg-white shadow-sm mb-4">
                  <div class="flex justify-between items-center">
                    <p id="content-age" class="text-gray-800 font-medium">Content age detection requires date meta tags.</p>
                    <div class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-semibold">Score Impact: 70%</div>
                  </div>
                  <p class="text-sm text-gray-600 mt-2">Your overall Content Freshness score is based 30% on proper date metadata and 70% on detected content age.</p>
                </div>
              </div>
              
              <div class="p-4 bg-gradient-to-r from-purple-600 to-purple-500 rounded-lg text-white">
                <p class="font-medium mb-4">Stale Content = AI Ignores You. Our content refresh service ensures your website gets maximum AI visibility.</p>
                <div class="flex justify-center">
                  <a href="/services/digital-marketing/" class="bg-white text-purple-600 hover:bg-purple-50 px-6 py-2 rounded-md font-medium inline-flex items-center">
                    Digital Marketing Services
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                  </a>
                </div>
              </div>
            
            <!-- See The Difference Yourself Card - New Addition -->
            <div class="mb-10 p-4 sm:p-6 border border-blue-100 rounded-xl bg-blue-50 overflow-x-hidden">
              <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-4">
                <div>
                  <h3 class="text-2xl font-semibold text-gray-900">See The Difference Yourself</h3>
                  <p class="text-sm text-blue-700 font-medium">Test more websites and compare results</p>
                </div>
                <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold">Usage: <span id="uses-remaining">5</span> left</div>
              </div>
              
              <div class="bg-white p-3 sm:p-4 rounded-lg mb-6 shadow-sm overflow-x-auto">
                <p class="text-gray-700"><span class="font-semibold text-blue-800">Did you know?</span> Our analysis is just a starting point. Compare our results with industry tools like <a href="https://pagespeed.web.dev/" target="_blank" class="text-blue-600 hover:underline">PageSpeed Insights</a> to see how our comprehensive approach provides deeper insights into your digital visibility.</p>
                <div class="flex items-center gap-2 mt-3 text-sm text-blue-600">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                  </svg>
                  <span>You can analyze up to 5 websites for free to benchmark your performance.</span>
                </div>
              </div>
              
              <!-- Usage Meter -->
              <div class="w-full bg-white rounded-full h-2.5 mb-6">
                <div id="usage-bar" class="bg-blue-500 h-2.5 rounded-full transition-all duration-300" style="width: 100%"></div>
              </div>
              
              <!-- URL Analysis Form with Original Styling -->
              <div id="additional-analysis-container">
                <form id="additional-analysis-form" class="flex flex-col gap-4">
                  <div class="relative flex-grow">
                    <input 
                      type="url" 
                      id="additional-url" 
                      placeholder="Enter website URL (e.g., example.com)" 
                      class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      required
                    >
                  </div>
                  <button 
                    type="submit" 
                    id="additional-analyze-btn"
                    class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-6 rounded-lg transition-colors duration-200"
                  >
                    <span id="additional-button-text">Continue</span>
                    <span id="additional-button-spinner" class="hidden">
                      <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg>
                    </span>
                  </button>
                </form>
              </div>

                <!-- Step 2: Contact Form with Web3Forms Integration -->
                <div id="contactFormStep" class="step-form hidden">
                  <form id="leadContactForm" action="https://api.web3forms.com/submit" method="POST" class="flex flex-col gap-4">
                    <!-- Web3Forms Configuration -->
                    <input type="hidden" name="access_key" value="04b98b5a-c1af-43bf-a223-9f711109ac82">
                    <input type="hidden" name="subject" value="New Website Analysis Form Submission - Digital Visibility">
                    <input type="hidden" name="from_name" value="Digital Visibility Website Form">
                    <input type="hidden" name="to_email" value="support@digitalvisibility.com">
                    <input type="hidden" name="redirect" value="https://web3forms.com/success">
                    
                    <!-- Store the URL from step 1 -->
                    <input type="hidden" id="urlFromStep1" name="website_url">
                    
                    <div class="mb-4">
                      <h3 class="text-lg font-semibold mb-2">Contact Information</h3>
                      <p class="text-sm text-gray-600 mb-4">Please provide your contact details to continue with the website analysis.</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                        <label for="leadNameInput" class="block text-sm font-medium text-gray-700 mb-1">Your Name</label>
                        <input 
                          type="text" 
                          id="leadNameInput" 
                          name="name" 
                          class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                          required
                        >
                      </div>
                      
                      <div>
                        <label for="leadEmailInput" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                        <input 
                          type="email" 
                          id="leadEmailInput" 
                          name="email" 
                          class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                          required
                        >
                      </div>
                    </div>
                    
                    <div>
                      <label for="leadBusinessName" class="block text-sm font-medium text-gray-700 mb-1">Business/Company Name</label>
                      <input 
                        type="text" 
                        id="leadBusinessName" 
                        name="business_name" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                      >
                    </div>
                    
                    <div>
                      <label for="leadMessage" class="block text-sm font-medium text-gray-700 mb-1">What's your biggest challenge with your website? (Optional)</label>
                      <textarea 
                        id="leadMessage" 
                        name="message" 
                        rows="3" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                      ></textarea>
                    </div>
                    
                    <!-- Cloudflare Turnstile Integration -->
                    <div class="cf-turnstile" data-sitekey="0x4AAAAAAAQ1YlJFSBGYSW0" data-callback="javascriptCallback"></div>
                    
                    <div class="flex justify-between mt-4">
                      <button 
                        type="button" 
                        id="backToUrlBtn"
                        class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium py-2 px-4 rounded-lg transition-colors duration-200"
                      >
                        Back
                      </button>
                      
                      <button 
                        type="submit" 
                        id="contactFormSubmitBtn"
                        class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-6 rounded-lg transition-colors duration-200"
                      >
                        <span id="contactFormBtnText">Submit & Continue</span>
                        <span id="contactFormSpinner" class="hidden">
                          <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                          </svg>
                        </span>
                      </button>
                    </div>
                  </form>
                </div>
                
                <!-- Step 3: Final URL Analysis Form -->
                <div id="additional-analysis-container" class="step-form hidden">
                  <form id="additional-analysis-form" class="flex flex-col gap-4">
                    <div class="relative flex-grow">
                      <input 
                        type="url" 
                        id="additional-url" 
                        placeholder="Enter website URL (e.g., example.com)" 
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        required
                      >
                    </div>
                    <button 
                      type="submit" 
                      id="additional-analyze-btn"
                      class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-6 rounded-lg transition-colors duration-200"
                    >
                      <span id="additional-button-text">Continue</span>
                      <span id="additional-button-spinner" class="hidden">
                        <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                      </span>
                    </button>
                  </form>
                </div>
              </div>
              
              <!-- Hidden CTA (shows after 5 uses) -->
              <div id="limit-reached-cta" class="hidden mt-4 p-6 bg-blue-50 rounded-lg border border-blue-200 text-center">
                <h3 class="text-xl font-semibold text-blue-800 mb-2">Analysis Limit Reached</h3>
                <p id="limit-message" class="text-gray-700 mb-4">You've reached the maximum number of free analyses. Please upgrade for unlimited access.</p>
                <div class="p-5 mt-4 bg-gradient-to-r from-blue-600 to-blue-500 rounded-lg text-white">
                  <h4 class="text-xl font-semibold mb-2">Unlock Your Full Potential</h4>
                  <p class="mb-4 font-medium">You've used all 5 free analyses. Ready to go deeper? Get a comprehensive report with hundreds of optimization metrics that boost both AI and traditional search rankings.

</br>- Free premium analysis from our experts
</br>- Actionable recommendations for immediate improvements</p>
                  <div class="flex justify-center">
                    <a href="/contact/" class="bg-white text-blue-600 hover:bg-blue-50 px-6 py-2 rounded-md font-medium inline-flex items-center">
                      Contact us for a Free Premuim Analysis Report
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                      </svg>
                    </a>
                  </div>
                </div>
              </div>
			              </div>
              
              <script>
                // Secure Usage Tracking System
                async function generateUserId(email) {
                  try {
                    // Normalize email (lowercase, trim)
                    const normalizedEmail = email.toLowerCase().trim();
                    
                    // Use SubtleCrypto for secure hashing when available
                    if (window.crypto && window.crypto.subtle) {
                      const encoder = new TextEncoder();
                      const data = encoder.encode(normalizedEmail);
                      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                      
                      // Convert to hex string
                      return Array.from(new Uint8Array(hashBuffer))
                        .map(b => b.toString(16).padStart(2, '0'))
                        .join('');
                    } else {
                      // Fallback for older browsers (less secure)
                      let hash = 0;
                      for (let i = 0; i < normalizedEmail.length; i++) {
                        const char = normalizedEmail.charCodeAt(i);
                        hash = ((hash << 5) - hash) + char;
                        hash = hash & hash; // Convert to 32bit integer
                      }
                      return 'legacy_' + hash.toString(16);
                    }
                  } catch (error) {
                    console.error('Error generating user ID:', error);
                    // Fallback to timestamp + random if hashing fails
                    return 'fallback_' + Date.now() + '_' + Math.random().toString(36).substring(2);
                  }
                }
                
                // Track usage and check limits
                async function trackUsage(email, url) {
                  try {
                    if (!email || !url) return { allowed: false, remaining: 0 };
                    
                    // Format URL if needed (ensure https:// is present)
                    if (!url.startsWith('http://') && !url.startsWith('https://')) {
                      url = 'https://' + url;
                    }
                    
                    // Generate consistent user ID
                    const userId = await generateUserId(email);
                    const storageKey = `analyzer_usage_${userId}`;
                    
                    // Get existing usage data
                    let usageData = JSON.parse(localStorage.getItem(storageKey) || '{"count":0,"urls":{}}');
                    
                    // Normalize URL (domain only)
                    const normalizedUrl = url.replace(/^https?:\/\//i, '')
                                             .replace(/^www\./i, '')
                                             .split('/')[0]
                                             .toLowerCase();
                    
                    // Check total usage limit
                    const totalLimit = 5;
                    const urlLimit = 3; // Max per domain
                    
                    // Check if total limit reached
                    if (usageData.count >= totalLimit) {
                      return { allowed: false, remaining: 0 };
                    }
                    
                    // Check if URL limit reached
                    if ((usageData.urls[normalizedUrl] || 0) >= urlLimit) {
                      const remainingTotal = totalLimit - usageData.count;
                      return { 
                        allowed: false, 
                        remaining: remainingTotal,
                        message: `You've reached the maximum analyses for ${normalizedUrl}. Try a different website.`
                      };
                    }
                    
                    // Update counters
                    usageData.count += 1;
                    usageData.urls[normalizedUrl] = (usageData.urls[normalizedUrl] || 0) + 1;
                    usageData.lastUsed = Date.now();
                    
                    // Save updated data
                    localStorage.setItem(storageKey, JSON.stringify(usageData));
                    
                    // Return remaining usage count
                    const remaining = totalLimit - usageData.count;
                    return { allowed: true, remaining };
                  } catch (error) {
                    console.error('Error tracking usage:', error);
                    return { allowed: true, remaining: 5 }; // Fail open for better UX
                  }
                }
                
                // Store lead contact information in localStorage for marketing purposes
                function storeLeadData(email, name, businessName, phone, url) {
                  try {
                    // Create a unique key for storing lead data
                    const leadStorageKey = 'analyzer_leads';
                    
                    // Get existing lead data or initialize an empty array
                    let leadsData = JSON.parse(localStorage.getItem(leadStorageKey) || '[]');
                    
                    // Add the new lead data
                    leadsData.push({
                      email: email,
                      name: name,
                      businessName: businessName,
                      phone: phone,
                      url: url,
                      timestamp: Date.now(),
                      date: new Date().toISOString()
                    });
                    
                    // Save updated lead data
                    localStorage.setItem(leadStorageKey, JSON.stringify(leadsData));
                    console.log('Lead data stored successfully');
                    return true;
                  } catch (error) {
                    console.error('Error storing lead data:', error);
                    return false;
                  }
                }
                
                document.addEventListener('DOMContentLoaded', function() {
                  // Get DOM elements - cached for performance and consistency
                  const usesRemainingElement = document.getElementById('uses-remaining');
                  const usageBar = document.getElementById('usage-bar');
                  const additionalForm = document.getElementById('additional-analysis-container');
                  const limitReachedCta = document.getElementById('limit-reached-cta');
                  const leadFormContainer = document.getElementById('leadFormContainer');
                  
                  // Update UI with remaining usage
                  function updateUsageUI(remaining) {
                    if (!usesRemainingElement || !usageBar) return;
                    
                    // Set the current remaining count in localStorage for persistence
                    localStorage.setItem('analyzer_remaining', String(remaining));
                    
                    if (remaining <= 0) {
                      // No uses left - enforce blocked state
                      localStorage.setItem('analyzer_blocked', 'true');
                      
                      // Hide analyzer forms and show CTA
                      if (additionalForm) additionalForm.classList.add('hidden');
                      if (limitReachedCta) limitReachedCta.classList.remove('hidden');
                      
                      // Also hide any other forms that might bypass this
                      const leadFormContainer = document.getElementById('leadFormContainer');
                      if (leadFormContainer) leadFormContainer.classList.add('hidden');
                      
                      return;
                    } else {
                      // Make sure blocked flag is removed if we have uses remaining
                      localStorage.removeItem('analyzer_blocked');
                    }
                    
                    // Update the UI elements
                    usesRemainingElement.textContent = remaining;
                    usageBar.style.width = `${(remaining / 5) * 100}%`;
                  }
                  
                  // Get email from contact form (if it exists)
                  function getCurrentEmail() {
                    const emailInput = document.getElementById('leadEmailInput') as HTMLInputElement;
                    return emailInput ? emailInput.value : '';
                  }
                  
                  // Initial form submission (hook into Web3Forms submission)
                  const leadContactForm = document.getElementById('leadContactForm');
                  if (leadContactForm) {
                    const originalSubmit = leadContactForm.onsubmit;
                    
                    leadContactForm.onsubmit = async function(e) {
                      e.preventDefault();
                      
                      const email = (document.getElementById('leadEmailInput') as HTMLInputElement).value;
                      let url = (document.getElementById('leadInitialUrlInput') as HTMLInputElement).value.trim();
                      
                      if (!email || !url) {
                        alert('Please enter both email and URL');
                        return false;
                      }
                      
                      // Format URL (add https:// if missing)
                      if (!url.startsWith('http://') && !url.startsWith('https://')) {
                        url = 'https://' + url;
                        (document.getElementById('leadInitialUrlInput') as HTMLInputElement).value = url;
                      }
                      
                      // Get the Turnstile token (if present)
                      const turnstileResponse = document.getElementById('leadTurnstileResponse') as HTMLInputElement;
                      const turnstileToken = turnstileResponse ? turnstileResponse.value : '';
                      
                      // In production, we'd validate this token, but for now we'll just log it
                      console.log('Turnstile token:', turnstileToken ? 'Present' : 'Not present');
                      
                      // Track usage
                      const usageResult = await trackUsage(email, url);
                      
                      // Store email for additional form usage
                      localStorage.setItem('analyzer_last_email', email);
                      
                      if (!usageResult.allowed) {
                        // Set a flag to completely block analysis
                        localStorage.setItem('analyzer_blocked', 'true');
                        
                        // Show limit reached message and redirect to home page
                        alert(usageResult.message || 'You have reached the maximum number of free analyses. Please reach out to us if you would like us to reset your usage limit on any of our free tools.');
                        window.location.href = '/';
                        
                        // Prevent form submission
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                      }
                      
                      // Set the usage remaining in localStorage for the additional form
                      localStorage.setItem('analyzer_remaining', usageResult.remaining);
                      
                      // Before proceeding, check if analysis is blocked
                      if (localStorage.getItem('analyzer_blocked') === 'true') {
                        // Analysis is blocked, don't proceed
                        e.preventDefault();
                        e.stopPropagation();
                        
                        // Show limit reached message and redirect
                        alert('You have reached the maximum number of free analyses. Returning to home page.');
                        
                        // Redirect to home page
                        window.location.href = '/';
                        
                        return false;
                      }
                      
                      // Get additional user data
                      const name = (document.getElementById('leadNameInput') as HTMLInputElement).value;
                      const businessName = (document.getElementById('leadBusinessNameInput') as HTMLInputElement)?.value || '';
                      const phone = (document.getElementById('leadPhoneInput') as HTMLInputElement)?.value || '';
                      
                      // Store lead data in localStorage
                      storeLeadData(email, name, businessName, phone, url);
                      
                      // Show spinner to indicate processing
                      const contactButtonText = document.getElementById('leadContactButtonText');
                      const contactButtonSpinner = document.getElementById('leadContactButtonSpinner');
                      const submitButton = document.getElementById('leadSubmitContactButton') as HTMLButtonElement;
                      
                      if (contactButtonText && contactButtonSpinner && submitButton) {
                        contactButtonText.textContent = 'Processing...';
                        contactButtonSpinner.classList.remove('hidden');
                        submitButton.disabled = true;
                      }
                      
                      setTimeout(() => {
                        // Hide lead generation form and show the original analyzer form
                        const leadGenSteps = document.getElementById('leadGenSteps');
                        if (leadGenSteps) {
                          leadGenSteps.classList.add('hidden');
                        }
                        
                        // Show original analyzer with URL prefilled
                        const originalAnalyzerContainer = document.getElementById('originalAnalyzerContainer');
                        if (originalAnalyzerContainer) {
                          originalAnalyzerContainer.classList.remove('hidden');
                          
                          // Set the URL in the original form
                          const originalUrlInput = document.getElementById('urlInput') as HTMLInputElement;
                          if (originalUrlInput) {
                            // Set the URL from the first step
                            originalUrlInput.value = url;
                            
                            // Optional: Automatically trigger the analysis
                            setTimeout(() => {
                              // Create and dispatch a submit event on the analyze form
                              const analyzeForm = document.getElementById('analyzeForm');
                              if (analyzeForm) {
                                // Let the user see the form before automatically submitting
                                analyzeForm.dispatchEvent(new Event('submit'));
                              }
                            }, 500); // Give a slight delay to ensure DOM is ready
                          }
                        }
                      }, 1000); // Simulate processing time
                      
                      return false; // Prevent default form submission
                    };
                  }
                  
                  // Additional form submission
                  const additionalAnalysisForm = document.getElementById('additional-analysis-form');
                  if (additionalAnalysisForm) {
                    additionalAnalysisForm.addEventListener('submit', async function(e) {
                      e.preventDefault();
                      
                      // Check if already blocked
                      if (localStorage.getItem('analyzer_blocked') === 'true') {
                        // Already blocked, don't even try to analyze
                        alert('You have reached the maximum number of free analyses. Returning to home page.');
                        
                        // Redirect to home page
                        window.location.href = '/';
                        
                        e.preventDefault();
                        return;
                      }
                      
                      // Get URL and previously submitted email
                      const url = (document.getElementById('additional-url') as HTMLInputElement).value;
                      const email = localStorage.getItem('analyzer_last_email') || getCurrentEmail();
                      
                      if (!url) {
                        alert('Please enter a URL to analyze');
                        return;
                      }
                      
                      if (!email) {
                        alert('Missing email information. Please refresh the page and try again.');
                        return;
                      }
                      
                      // Show spinner
                      const buttonText = document.getElementById('additional-button-text');
                      const buttonSpinner = document.getElementById('additional-button-spinner');
                      if (buttonText) buttonText.classList.add('hidden');
                      if (buttonSpinner) buttonSpinner.classList.remove('hidden');
                      
                      // Track usage
                      const usageResult = await trackUsage(email, url);
                      
                      if (!usageResult.allowed) {
                        // Hide spinner
                        if (buttonText) buttonText.classList.remove('hidden');
                        if (buttonSpinner) buttonSpinner.classList.add('hidden');
                        
                        // Set blocked state
                        localStorage.setItem('analyzer_blocked', 'true');
                        
                        // Show limit message and redirect
                        alert(usageResult.message || 'You have reached the maximum number of free analyses. Returning to home page.');
                        
                        // Redirect to home page
                        window.location.href = '/';
                        
                        return;
                      }
                      
                      // Set the URL in the original input and trigger analysis
                      const originalUrlInput = document.getElementById('urlInput');
                      if (originalUrlInput) {
                        originalUrlInput.value = url;
                        // Submit the original form to trigger the analysis
                        setTimeout(function() {
                          const analyzeButton = document.getElementById('analyzeButton');
                          if (analyzeButton) analyzeButton.click();
                        }, 100);
                      }
                      
                      // Update UI with remaining uses
                      updateUsageUI(usageResult.remaining);
                    });
                  }
                  
                  // Function to enforce blocked state
                  function enforceBlockedState() {
                    // Hide all analyzer forms
                    if (additionalForm) additionalForm.classList.add('hidden');
                    
                    // Show the CTA for upgrading
                    if (limitReachedCta) limitReachedCta.classList.remove('hidden');
                    
                    // Hide lead form if it exists
                    const leadFormContainer = document.getElementById('leadFormContainer');
                    if (leadFormContainer) leadFormContainer.classList.add('hidden');
                    
                    // Update UI to show 0 remaining
                    if (usesRemainingElement) usesRemainingElement.textContent = '0';
                    if (usageBar) usageBar.style.width = '0%';
                  }
                  
                  // Initialize UI with stored remaining usage or enforce blocked state
                  const isBlocked = localStorage.getItem('analyzer_blocked') === 'true';
                  if (isBlocked) {
                    // If we're blocked, enforce it regardless of remaining count
                    enforceBlockedState();
                  } else {
                    // Otherwise check remaining count
                    const storedRemaining = localStorage.getItem('analyzer_remaining');
                    const remaining = storedRemaining !== null ? parseInt(storedRemaining, 10) : 5;
                    
                    if (remaining <= 0) {
                      // No uses left - set blocked and enforce
                      localStorage.setItem('analyzer_blocked', 'true');
                      enforceBlockedState();
                    } else {
                      // Still have uses remaining
                      updateUsageUI(remaining);
                    }
                  }
                  
                  // Ensure usage data is properly linked with original form
                  const originalAnalyzeButton = document.getElementById('analyzeButton');
                  if (originalAnalyzeButton) {
                    // Store the original click handler
                    const originalClickHandler = originalAnalyzeButton.onclick;
                    
                    // Replace with our handler that checks usage limits first
                    originalAnalyzeButton.onclick = async function(e) {
                      // Make sure we check limits before allowing analysis
                      const email = localStorage.getItem('analyzer_last_email');
                      const url = (document.getElementById('urlInput') as HTMLInputElement)?.value;
                      
                      if (email && url) {
                        // Check if already blocked
                        if (localStorage.getItem('analyzer_blocked') === 'true') {
                          // Already blocked, don't even try to track usage
                          alert('You have reached the maximum number of free analyses. Returning to home page.');
                          
                          // Redirect to home page
                          window.location.href = '/';
                          
                          e.preventDefault();
                          e.stopPropagation();
                          return false;
                        }
                        
                        // Check usage limits
                        const usageResult = await trackUsage(email, url);
                        
                        // Update UI with remaining uses
                        updateUsageUI(usageResult.remaining);
                        
                        // If usage limit reached, block analysis
                        if (!usageResult.allowed) {
                          // Set blocked state
                          localStorage.setItem('analyzer_blocked', 'true');
                          
                          // Show limit reached message and then redirect
                          alert(usageResult.message || 'You have reached the maximum number of free analyses. Returning to home page.');
                          
                          // Redirect to home page
                          window.location.href = '/';
                          
                          // Prevent any further execution
                          e.preventDefault();
                          e.stopPropagation();
                          return false;
                        }
                      }
                      
                      // If usage is allowed, call the original handler
                      if (typeof originalClickHandler === 'function') {
                        return originalClickHandler.call(this, e);
                      }
                    };
                  }
                });
              </script>
            </div>
            
            </div> <!-- Close the two-column layout -->
          </div>
        </div>
        
        <!-- Error Alert (Hidden Initially) -->
        <div id="errorAlert" class="hidden bg-red-50 border-l-4 border-red-500 p-4 mb-8">
          <div class="flex">
            <div class="flex-shrink-0">
              <svg class="h-5 w-5 text-red-500" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="ml-3">
              <p id="errorMessage" class="text-sm text-red-700">
                Error analyzing website. Please check the URL and try again.
              </p>
            </div>
          </div>
        </div>
      </div>
      </div>
    </div>
  </section>

  <Footer slot="footer" />

  <style>
    .service-card {
      background-color: white;
      border-radius: 0.75rem;
      padding: 1.5rem;
      transition: all 0.3s ease;
      border: 1px solid #f3f4f6;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    
    .service-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
      border-color: #e5e7eb;
    }
    
    .service-card .learn-more {
      display: inline-flex;
      align-items: center;
      color: #2563eb;
      font-weight: 500;
      transition: color 0.2s;
    }
    
    .service-card .learn-more:hover {
      color: #1d4ed8;
    }
    
    .service-card .learn-more svg {
      transition: transform 0.2s;
    }
    
    .service-card:hover .learn-more svg {
      transform: translateX(3px);
    }
  </style>
  <script>
    // Wait for DOM to load
    document.addEventListener('DOMContentLoaded', function() {
      // New Lead Generation form handling
      initializeLeadGenFunctionality();
      
      // Original Visibility Analyzer functionality
      const analyzeForm = document.getElementById('analyzeForm');
      const websiteUrlInput = document.getElementById('urlInput');
      const analyzeButton = document.getElementById('analyzeButton');
      const buttonText = document.getElementById('buttonText');
      const buttonSpinner = document.getElementById('buttonSpinner');
      const errorAlert = document.getElementById('errorAlert');
      const errorMessage = document.getElementById('errorMessage');
      const resultsSection = document.getElementById('resultsSection');
      const analyzedUrlElement = document.getElementById('analyzedUrl');
      
      // Initialize Lead Generation Form functionality
      function initializeLeadGenFunctionality() {
        // Initialize Cloudflare Turnstile widget explicitly
        if (typeof (window as any).turnstile !== 'undefined') {
          setTimeout(() => {
            try {
              (window as any).turnstile.render('#cf-turnstile-container', {
                sitekey: '0x4AAAAAABLjSEqx_MGVFkGW',
                theme: 'light',
                callback: function(token) {
                  const responseInput = document.getElementById('leadTurnstileResponse');
                  if (responseInput) {
                    responseInput.setAttribute('value', token);
                  }
                },
              });
            } catch (e) {
              console.error('Error initializing Turnstile:', e);
            }
          }, 1000); // Give a slight delay to ensure Turnstile JS is loaded
        }
        // Get step elements
        const step1 = document.getElementById('leadStep1');
        const step2 = document.getElementById('leadStep2');
        const initialUrlForm = document.getElementById('leadUrlForm');
        const contactForm = document.getElementById('leadContactForm');
        const initialUrlInput = document.getElementById('leadInitialUrlInput');
        const urlToAnalyze = document.getElementById('leadUrlToAnalyze');
        const analyzedUrlField = document.getElementById('leadAnalyzedUrlField');
        const backToStep1Button = document.getElementById('leadBackToStep1Button');
        const originalAnalyzerContainer = document.getElementById('originalAnalyzerContainer');
        
        // Cloudflare Turnstile is now initialized through direct implementation with data-sitekey
        
        // URL Form submission (Step 1 to Step 2)
        initialUrlForm.addEventListener('submit', function(e) {
          e.preventDefault();
          
          // Get URL
          let url = initialUrlInput.value.trim();
          
          // Validate URL
          if (!url) {
            alert('Please enter a website URL.');
            return;
          }
          
          // Format URL (add https:// if missing)
          if (!url.startsWith('http://') && !url.startsWith('https://')) {
            url = 'https://' + url;
            initialUrlInput.value = url;
          }
          
          // Validate URL format with a simple regex
          const urlPattern = /^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([\/\w.-]*)*\/?$/;
          if (!urlPattern.test(url)) {
            alert('Please enter a valid website URL.');
            return;
          }
          
          // Show the URL in step 2
          if (urlToAnalyze) {
            urlToAnalyze.textContent = url;
          }
          
          // Set the hidden field value
          if (analyzedUrlField) {
            analyzedUrlField.value = url;
          }
          
          // Hide step 1, show step 2
          step1.classList.add('hidden');
          step2.classList.remove('hidden');
        });
        
        // Back button (Step 2 to Step 1)
        if (backToStep1Button) {
          backToStep1Button.addEventListener('click', function() {
            step2.classList.add('hidden');
            step1.classList.remove('hidden');
          });
        }
        
        // Contact form submission
        contactForm.addEventListener('submit', function(e) {
          e.preventDefault();
          
          // Show spinner
          const contactButtonText = document.getElementById('leadContactButtonText');
          const contactButtonSpinner = document.getElementById('leadContactButtonSpinner');
          const submitButton = document.getElementById('leadSubmitContactButton') as HTMLButtonElement;
          
          if (contactButtonText && contactButtonSpinner && submitButton) {
            contactButtonText.textContent = 'Sending...';
            contactButtonSpinner.classList.remove('hidden');
            submitButton.disabled = true;
          }
          
          // Collect form data
          const formData = new FormData(contactForm as HTMLFormElement);
          
          // Get form data for debugging
          const formEntries: Record<string, string | boolean> = {};
          for (let [key, value] of formData.entries()) {
            formEntries[key] = value.toString();
          }
          console.log('Submitting form data:', formEntries);
          
          // Make sure the Cloudflare Turnstile response is included
          const turnstileResponse = document.getElementById('leadTurnstileResponse');
          // Use type declaration to access turnstile from window
          if (turnstileResponse && typeof (window as any).turnstile !== 'undefined') {
            // Get the turnstile token directly from the widget
            const token = (window as any).turnstile.getResponse();
            if (token) {
              formData.set('cf-turnstile-response', token);
            }
          }

          // Submit form data to Web3Forms with proper headers
          fetch('https://api.web3forms.com/submit', {
            method: 'POST',
            headers: {
              'Accept': 'application/json'
            },
            body: formData
          })
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
          })
          .then(data => {
            console.log('Form submission successful:', data);
            
            // Store email in localStorage to link with usage tracking
            const emailInput = document.getElementById('leadEmailInput') as HTMLInputElement;
            if (emailInput && emailInput.value) {
              localStorage.setItem('analyzer_last_email', emailInput.value);
            }
            
            // Store complete lead data for admin page
            try {
              // Safe access to the URL input value
              let urlValue = '';
              if (initialUrlInput && 'value' in initialUrlInput) {
                urlValue = (initialUrlInput as HTMLInputElement).value;
              }
              
              const newLead = {
                name: formEntries['name']?.toString() || '',
                email: formEntries['email']?.toString() || '',
                businessName: formEntries['business_name']?.toString() || '',
                phone: formEntries['phone']?.toString() || '',
                url: formEntries['analyzed_url']?.toString() || urlValue || '',
                timestamp: new Date().toISOString(),
                consent: formEntries['consent'] ? true : false
              };
              
              // Save lead data to both localStorage AND centralized storage
              // 1. First save to local storage for backward compatibility
              const existingLeadsJson = localStorage.getItem('analyzer_leads') || '[]';
              const existingLeads = JSON.parse(existingLeadsJson);
              existingLeads.unshift(newLead);
              localStorage.setItem('analyzer_leads', JSON.stringify(existingLeads));
              
              // 2. Then save to centralized storage using Cloudflare Workers
              // This uses a Cloudflare Worker endpoint that saves data to KV storage
              console.log('Sending data to Cloudflare Worker:', newLead);
              
              // Create payload for Cloudflare Worker
              const payload = {
                lead: newLead,
                timestamp: new Date().toISOString(),
                source: window.location.hostname,
                apiKey: 'dv_analyzer_key_2025' // Include API key in body
              };
              
              // Log the URL and payload for debugging
              console.log('Cloudflare Worker URL:', 'https://lead-collection.darrangoulding.workers.dev/store-lead');
              console.log('Payload:', payload);
              
              // Add more robust debugging for the network request
              console.log('Initiating Cloudflare Worker request...');
              
              // First try a simple check to see if the Worker is reachable
              fetch('https://lead-collection.darrangoulding.workers.dev/', {
                method: 'GET',
                headers: {
                  'Accept': 'application/json'
                }
              })
              .then(response => {
                console.log('Cloudflare Worker reachability status:', response.status);
                if (!response.ok) {
                  console.warn('Cloudflare Worker may not be properly accessible. Status:', response.status);
                }
                // Now attempt the actual data POST
                return fetch('https://lead-collection.darrangoulding.workers.dev/store-lead', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'API-Key': 'dv_analyzer_key_2025', // Simple API key for basic security
                    'Access-Control-Allow-Origin': '*' // Request CORS support
                  },
                  body: JSON.stringify(payload)
                });
              })
              .catch(error => {
                console.error('Initial Cloudflare Worker check failed:', error);
                // Still try the actual request even if the check failed
                return fetch('https://lead-collection.darrangoulding.workers.dev/store-lead', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'API-Key': 'dv_analyzer_key_2025', // Simple API key for basic security
                    'Access-Control-Allow-Origin': '*' // Request CORS support
                  },
                  body: JSON.stringify(payload)
                });
              })
              .then(response => {
                console.log('Cloudflare Worker response status:', response.status);
                console.log('Cloudflare Worker response headers:', [...response.headers.entries()]);
                if (!response.ok) {
                  throw new Error(`API error: ${response.status}`);
                  return response.text().then(text => {
                    console.error('Cloudflare Worker error response:', text);
                    throw new Error(`API error: ${response.status} - ${text}`);
                  });
                }
                return response.json();
              })
              .then(data => {
                console.log('Lead data sent to Cloudflare storage successfully', data);
                // Generate a shared storage key for other browsers to access
                try {
                  // Create a master leads key that we'll check in the admin page
                  const masterKey = 'analyzer_master_' + newLead.email.replace(/[^a-zA-Z0-9]/g, '');
                  localStorage.setItem(masterKey, JSON.stringify({ 
                    timestamp: new Date().toISOString(),
                    leadId: data.leadId || 'unknown'
                  }));
                } catch (e) {
                  console.error('Error storing master key:', e);
                }
              }).catch(error => {
                console.error('Error sending lead data to Cloudflare storage:', error);
                // Create a fallback notification for debugging
                alert('Debug: Failed to send lead data to cloud storage. Check console for details.');
              });
              
              console.log('Lead data saved successfully:', newLead);
            } catch (error) {
              console.error('Error saving lead data to localStorage:', error);
            }
            
            // Hide lead generation form and show the original analyzer form
            const leadGenSteps = document.getElementById('leadGenSteps');
            if (leadGenSteps) {
              leadGenSteps.classList.add('hidden');
            }
            
            // Show original analyzer with URL prefilled
            if (originalAnalyzerContainer) {
              originalAnalyzerContainer.classList.remove('hidden');
              
              // Set the URL in the original form
              const originalUrlInput = document.getElementById('urlInput') as HTMLInputElement;
              const urlInputValue = initialUrlInput ? initialUrlInput.value : '';
              
              if (originalUrlInput && urlInputValue) {
                // Set the URL from the first step
                originalUrlInput.value = urlInputValue;
                
                // Optional: Automatically trigger the analysis
                // This will use the original analyzeWebsite function
                setTimeout(() => {
                  // Create and dispatch a submit event on the analyze form
                  const analyzeForm = document.getElementById('analyzeForm');
                  if (analyzeForm) {
                    // Let the user see the form before automatically submitting
                    analyzeForm.dispatchEvent(new Event('submit'));
                  }
                }, 500); // Give a slight delay to ensure DOM is ready
              }
            }
          })
          .catch(error => {
            console.error('Form submission error:', error);
            alert('There was an error submitting the form. Please try again. If this persists, please contact support.');
            
            // Log more detailed error info for debugging
            const formEntries = {};
            for (let [key, value] of formData.entries()) {
              // Don't log sensitive values like tokens
              if (key !== 'cf-turnstile-response' && key !== 'access_key') {
                formEntries[key] = value;
              } else {
                formEntries[key] = '[REDACTED]';
              }
            }
            console.log('Form data that failed:', formEntries);
            
            // Reset button state
            if (contactButtonText && contactButtonSpinner && submitButton) {
              contactButtonText.textContent = 'Get Free Analysis';
              contactButtonSpinner.classList.add('hidden');
              (submitButton as HTMLButtonElement).disabled = false;
            }
          });
        });
      }
      const secondResultsCard = document.getElementById('secondResultsCard');
      
      // Show error message
      function showError(message) {
        if (errorAlert) {
          errorAlert.classList.remove('hidden');
          if (errorMessage) {
            errorMessage.textContent = message;
          }
        }
        console.error(message);
      }
      
      // Hide error message
      function hideError() {
        if (errorAlert) {
          errorAlert.classList.add('hidden');
          if (errorMessage) {
            errorMessage.textContent = '';
          }
        }
      }
      
      // Function to set indicator
      function setIndicator(elementId, isSuccess) {
        const element = document.getElementById(elementId);
        if (element) {
          const iconElement = element.querySelector('div');
          if (iconElement) {
            if (isSuccess) {
              iconElement.innerHTML = '&#10003;';
              iconElement.classList.remove('bg-gray-200');
              iconElement.classList.add('bg-white');
              iconElement.style.color = '#22c55e'; // Green color
            } else {
              iconElement.innerHTML = '&#10007;';
              iconElement.classList.remove('bg-gray-200');
              iconElement.classList.add('bg-white');
              iconElement.style.color = '#ef4444'; // Red color
            }
          }
        }
      }
      
      // Function to set progress bar - back to blue
      function setProgressBar(barId, score) {
        const bar = document.getElementById(barId);
        if (bar) {
          bar.style.width = `${score}%`;
          // Remove any gradient classes and set to blue
          bar.classList.remove('bg-gradient-to-r', 'from-red-500', 'via-yellow-500', 'to-green-500');
          bar.style.backgroundColor = '#3b82f6'; // Blue color
        }
      }
      
      // Handle website analysis
      async function analyzeWebsite(e) {
        e.preventDefault();
        
        // Get URL
        let url = '';
        if (urlInput) {
          url = urlInput.value.trim();
          
          // Add protocol if missing
          if (!url.startsWith('http://') && !url.startsWith('https://')) {
            url = 'https://' + url;
            urlInput.value = url;
          }
        }
        
        // Validate URL
        try {
          new URL(url);
        } catch (error) {
          showError('Please enter a valid URL');
          return;
        }
        
        // Set loading state
        setLoading(true);
        hideError();
        
        try {
          // Call the original worker where you deployed the scanner code
          const response = await fetch(`https://wandering-dream-7329.darrangoulding.workers.dev/analyze?url=${encodeURIComponent(url)}`);
          
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          
          const data = await response.json();
          
          // Display results
          displayResults(data, url);
          
        } catch (error) {
          console.error('Error analyzing website:', error);
          showError(`Error analyzing website: ${error.message}`);
        } finally {
          setLoading(false);
        }
      }
      
      // Display the analysis results
      function displayResults(data, url) {
        console.log("Received data:", data); // Debug log
        
        // Hide form and show results
        if (analyzeForm) analyzeForm.classList.add('hidden');
        if (resultsSection) resultsSection.classList.remove('hidden');
        
        // Show the second results card in the left column
        if (secondResultsCard) secondResultsCard.classList.remove('hidden');
        
        // Extract domain name from URL for personalization
        let domain = url.replace(/^https?:\/\//i, '').replace(/^www\./i, '');
        // Remove trailing slash and everything after it
        domain = domain.split('/')[0];
        
        // Update personalized CTA elements
        const personalizedCta = document.getElementById('personalized-cta');
        const websiteDomain = document.getElementById('website-domain');
        const websiteNameEmphasis = document.getElementById('website-name-emphasis');
        const personalizedHeading = document.getElementById('personalized-heading');
        const personalizedMessage = document.getElementById('personalized-message');
        const personalizedRecommendations = document.getElementById('personalized-recommendations');
        
        if (personalizedCta && websiteDomain && websiteNameEmphasis) {
          // Show the personalized CTA
          personalizedCta.classList.remove('hidden');
          
          // Set domain name in various places
          websiteDomain.textContent = domain;
          websiteNameEmphasis.textContent = domain;
          
          // Create personalized recommendations based on scores
          const recommendations = [];
          
          // AI SEO recommendations
          const aiSeoScore = Math.round(data.aiSeoScore || 0);
          if (aiSeoScore < 100) {
            recommendations.push(`<div class="mb-3">
              <span class="text-green-300 font-semibold">AI SEO: ${aiSeoScore}%</span> - Your site needs enhanced schema markup and optimized metadata that will boost your rankings in both AI platforms AND traditional search engines like Google. We can implement these improvements to dramatically increase ${domain}'s visibility and click-through rates.
            </div>`);
          }
          
          // Image Optimization recommendations
          const imageScore = Math.round(data.imageOptimizationScore || 0);
          if (imageScore < 100) {
            recommendations.push(`<div class="mb-3">
              <span class="text-green-300 font-semibold">Image Optimization: ${imageScore}%</span> - Optimizing your images will not only improve AI recognition but also accelerate page load times, reduce bounce rates, and enhance user experience. This directly impacts your conversion rates and Google rankings.
            </div>`);
          }
          
          // Content Freshness recommendations
          const freshnessScore = Math.round(data.contentFreshnessScore || 0);
          if (freshnessScore < 100) {
            recommendations.push(`<div class="mb-3">
              <span class="text-green-300 font-semibold">Content Freshness: ${freshnessScore}%</span> - Fresh, updated content signals to both search engines and potential customers that your business is active and relevant. We can implement a content strategy for ${domain} that drives organic traffic, builds customer trust, and positions you as an industry authority.
            </div>`);
          }
          
          // Citations Score recommendations
          const citationsScore = Math.round(data.citationsScore || 0);
          if (citationsScore < 100) {
            recommendations.push(`<div class="mb-3">
              <span class="text-green-300 font-semibold">Citations & References: ${citationsScore}%</span> - Strategic citations and references don't just improve AI credibility—they establish ${domain} as trustworthy to potential clients and boost your E-E-A-T signals for Google. This translates to higher rankings, more qualified leads, and increased customer confidence.
            </div>`);
          }
          
          // Authority Score recommendations
          const authorityScore = Math.round(data.authorityScore || 0);
          if (authorityScore < 100) {
            recommendations.push(`<div class="mb-3">
              <span class="text-green-300 font-semibold">Authority Signals: ${authorityScore}%</span> - Enhancing your authority signals will build immediate trust with potential customers and dramatically improve your competitive positioning. We can implement proven trust-building elements that convert visitors into paying clients while simultaneously improving your search rankings.
            </div>`);
          }
          
          // Performance recommendations
          const performanceScore = Math.round(data.performanceScore || 0);
          if (performanceScore < 100) {
            recommendations.push(`<div class="mb-3">
              <span class="text-green-300 font-semibold">Performance: ${performanceScore}%</span> - Site performance is now a critical ranking factor for Google and directly impacts your conversion rates. By optimizing ${domain}'s speed and user experience, we can reduce bounce rates, increase time-on-site, and create a seamless customer journey that drives more sales.
            </div>`);
          }
          
          // If no recommendations (all scores are high), still provide value
          if (recommendations.length === 0) {
            personalizedHeading.textContent = `${domain} Has Untapped Potential`;
            personalizedMessage.textContent = `While your website scored well in our basic analysis, there are still advanced optimization techniques that can put you ahead of competitors.`;
            personalizedRecommendations.innerHTML = `<div class="mb-3">
              <span class="text-green-300 font-semibold">Advanced Optimization</span> - Our team can implement cutting-edge optimization strategies to ensure ${domain} maintains its competitive edge, builds deeper customer trust, and captures more market share across all digital platforms—not just in AI search.
            </div>`;
          } else {
            // Customize heading based on overall score
            const overallScore = Math.round(
              [aiSeoScore, imageScore, freshnessScore, citationsScore, authorityScore, performanceScore]
                .filter(score => !isNaN(score))
                .reduce((sum, score) => sum + score, 0) / 
                [aiSeoScore, imageScore, freshnessScore, citationsScore, authorityScore, performanceScore]
                .filter(score => !isNaN(score)).length
            );
            
            if (overallScore < 50) {
              personalizedHeading.textContent = `${domain} Is Missing Critical Elements`;
              personalizedMessage.textContent = `Your website needs immediate attention to unlock its full business potential, improve brand credibility, and boost sales. Here's what we can enhance:`;
            } else if (overallScore < 75) {
              personalizedHeading.textContent = `${domain} Has Significant Growth Potential`;
              personalizedMessage.textContent = `Your website has several opportunities to improve customer trust, search rankings, and conversion rates. Here's what our experts recommend:`;
            } else {
              personalizedHeading.textContent = `${domain} Can Reach Even More Customers`;
              personalizedMessage.textContent = `Your website is already performing well, but these strategic optimizations could significantly increase your market share, customer engagement, and revenue:`;
            }
            
            // Include all recommendations under 100% to show comprehensive optimization potential
            let limitedRecommendations = recommendations.join('');
            personalizedRecommendations.innerHTML = limitedRecommendations;
          }
        }
        
        // Set URL
        if (analyzedUrl) analyzedUrl.textContent = url;
        
        // Overall AI Readiness Score calculation
        // This now takes the average of all section scores
        const allSectionScores = [
          data.aiSeoScore || 0,                   // AI SEO score
          data.imageOptimizationScore || 0,       // Image Optimization
          data.contentFreshnessScore || 0,        // Content Freshness
          data.citationsScore || 0,               // Citations & References
          data.authorityScore || 0,               // Authority & Trust
          data.performanceScore || 0              // Performance Optimization
        ];
        
        // Calculate the average of all section scores
        const overallScore = Math.round(
          allSectionScores.reduce((sum, score) => sum + score, 0) / allSectionScores.length
        );
        
        const overallScoreElement = document.getElementById('overallScore');
        if (overallScoreElement) overallScoreElement.textContent = `${overallScore}%`;
        setProgressBar('overallScoreBar', overallScore);
        
        // MANUALLY CALCULATING AI SEO SCORE BASED ON DIRECT DATA VALUES
        // 50% for Schema + 25% for AI Files + 25% for AI Meta Tags
        let correctedAiSeoScore = 0;
        
        // Schema markup (50%)
        if (data.schemaMarkup === true) {
          correctedAiSeoScore += 50;
        }
        
        // AI Files (25%)
        // Only count if either aiOptimizedFile OR llmFile is present
        if (data.aiOptimizedFile === true || data.llmFile === true) {
          correctedAiSeoScore += 25;
        }
        
        // AI Meta Tags (25%)
        // Check if ANY meta tags are present - if so, award ALL 25%
        const hasAnyMetaTags = data.aiMetaTags && (
          data.aiMetaTags.purpose === true || 
          data.aiMetaTags.target === true || 
          data.aiMetaTags.keywords === true || 
          data.aiMetaTags.contentType === true || 
          data.aiMetaTags.businessType === true || 
          data.aiMetaTags.serviceArea === true
        );
        
        if (hasAnyMetaTags) {
          correctedAiSeoScore += 25;
        }
        
        // Round the final score
        const aiSeoScore = Math.round(correctedAiSeoScore);
        const aiSeoScoreElement = document.getElementById('aiSeoScore');
        if (aiSeoScoreElement) aiSeoScoreElement.textContent = `${aiSeoScore}%`;
        setProgressBar('aiSeoScoreBar', aiSeoScore);
        
        setIndicator('schemaMarkup', data.schemaMarkup === true);
        
        // Display schema quality information
        const qualityScore = data.schemaQuality || 0;
        const qualityIndicator = document.querySelector('#schemaQuality div');
        const qualityText = document.querySelector('#schemaQuality span');
        
        if (qualityIndicator && qualityText) {
          if (data.schemaMarkup) {
            // Make score more visible with larger text
            qualityIndicator.innerHTML = `<span class="text-xl font-bold">${qualityScore}%</span>`;
            qualityIndicator.classList.remove('bg-gray-200');
            qualityIndicator.classList.add('flex', 'items-center', 'justify-center');
            
            if (qualityScore >= 75) {
              qualityIndicator.classList.add('bg-green-500', 'text-white');
              qualityText.innerHTML = '<strong>Schema Quality:</strong> Excellent';
            } else if (qualityScore >= 50) {
              qualityIndicator.classList.add('bg-blue-500', 'text-white');
              qualityText.innerHTML = '<strong>Schema Quality:</strong> Good';
            } else if (qualityScore >= 25) {
              qualityIndicator.classList.add('bg-yellow-500', 'text-white');
              qualityText.innerHTML = '<strong>Schema Quality:</strong> Basic';
            } else {
              qualityIndicator.classList.add('bg-red-500', 'text-white');
              qualityText.innerHTML = '<strong>Schema Quality:</strong> Poor';
            }
          } else {
            qualityIndicator.innerHTML = '<span class="text-xl font-bold">0%</span>';
            qualityIndicator.classList.add('bg-gray-200', 'flex', 'items-center', 'justify-center');
            qualityText.innerHTML = '<strong>Schema Quality</strong>';
          }
        }
        
        // Display schema types if available
        const schemaTypesContainer = document.querySelector('#schemaTypes');
        if (schemaTypesContainer && data.schemaTypes && data.schemaTypes.length > 0) {
          // Clear any existing content
          schemaTypesContainer.innerHTML = '';
          
          // Add heading
          const heading = document.createElement('h3');
          heading.className = 'text-lg font-semibold mb-2 mt-4';
          heading.textContent = 'Schema Types Found:';
          schemaTypesContainer.appendChild(heading);
          
          // Create list of schema types
          const typesList = document.createElement('ul');
          typesList.className = 'grid grid-cols-2 gap-2 mb-4';
          
          // Sort schema types - put important ones first
          const priorityTypes = ['Organization', 'LocalBusiness', 'WebSite', 'WebPage', 'Product', 'Service'];
          const sortedTypes = [...data.schemaTypes].sort((a, b) => {
            const aIndex = priorityTypes.indexOf(a);
            const bIndex = priorityTypes.indexOf(b);
            if (aIndex !== -1 && bIndex !== -1) return aIndex - bIndex;
            if (aIndex !== -1) return -1;
            if (bIndex !== -1) return 1;
            return a.localeCompare(b);
          });
          
          sortedTypes.forEach(type => {
            const item = document.createElement('li');
            item.className = 'flex items-center';
            
            const icon = document.createElement('span');
            icon.className = 'mr-2 text-green-500';
            icon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>';
            
            const text = document.createElement('span');
            text.textContent = type;
            
            item.appendChild(icon);
            item.appendChild(text);
            typesList.appendChild(item);
          });
          
          schemaTypesContainer.appendChild(typesList);
          
          // Add schema improvement recommendations
          if (qualityScore < 75) {
            const recommendationsHeading = document.createElement('h3');
            recommendationsHeading.className = 'text-lg font-semibold mb-2';
            recommendationsHeading.textContent = 'Recommendations to Improve Schema:';
            schemaTypesContainer.appendChild(recommendationsHeading);
            
            const recommendationsList = document.createElement('ul');
            recommendationsList.className = 'list-disc pl-5 mb-4 text-sm space-y-1';
            
            const recommendations = [];
            
            // Add recommendations based on what's missing
            if (!data.organizationSchema && !data.localBusinessSchema) {
              recommendations.push('Add Organization or LocalBusiness schema to identify your business');
            }
            
            if (!data.productSchema && !data.serviceSchema) {
              recommendations.push('Add Product or Service schema to highlight your offerings');
            }
            
            if (!data.articleSchema && !data.faqSchema) {
              recommendations.push('Add Article or FAQ schema to enhance content visibility');
            }
            
            // Add general recommendations for better schema quality
            recommendations.push('Include social profile links using sameAs property');
            recommendations.push('Add multiple images with proper markup');
            recommendations.push('Include contact information (email, phone, address)');
            recommendations.push('Add business details (opening hours, price range)');
            recommendations.push('Include reviews or testimonials with proper markup');
            recommendations.push('Add dates (published, modified) to content');
            
            // Create recommendations list items
            recommendations.forEach(rec => {
              const item = document.createElement('li');
              item.textContent = rec;
              recommendationsList.appendChild(item);
            });
            
            schemaTypesContainer.appendChild(recommendationsList);
            
            // Add compelling marketing message instead of technical details
            const infoBox = document.createElement('div');
            infoBox.className = 'bg-blue-50 p-4 rounded-md mt-4';
            
            // Create a more compelling and marketing-focused message
            let marketingMessage = `
              <h4 class="text-lg font-bold mb-2 text-blue-700">Why Schema Matters for Your Business Success</h4>
              <p class="mb-3">Your schema quality score directly impacts how AI systems and search engines understand and recommend your business. ${qualityScore < 50 ? 'Your current implementation is missing critical components that could significantly boost your visibility.' : 'While you have basic schema implementation, there are strategic improvements that could dramatically increase your visibility.'}</p>
              
              <p class="mb-3">Schema is now a <strong>top-ranking factor</strong> for both traditional and AI-powered search engines, determining whether your business appears in:</p>
              
              <ul class="list-disc pl-5 mb-3">
                <li>Google's rich results and knowledge panels</li>
                <li>AI search responses and recommendations</li>
                <li>Voice search answers from Alexa, Siri and Google Assistant</li>
                <li>Business recommendation systems</li>
              </ul>
              
              <div class="bg-white p-3 rounded-md border border-blue-200 mb-3">
                <p class="font-semibold text-center">"${qualityScore < 30 ? 'Over 78% of businesses are missing crucial schema elements that AI systems require to properly understand their services.' : qualityScore < 60 ? 'Businesses with comprehensive schema implementation receive 3.8X more visibility in AI-generated search results.' : 'Properly optimized schema can increase click-through rates by up to 30% and conversion rates by up to 20%.'}"
                </p>
              </div>
              
              <div class="mt-4 text-center">
                <a href="/contact" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition-colors duration-200">Get Expert Schema Optimization</a>
                <p class="text-sm mt-2">Our team can implement advanced schema markup tailored to your specific business type and needs.</p>
              </div>
            `;
            
            infoBox.innerHTML = marketingMessage;
            schemaTypesContainer.appendChild(infoBox);
          }
        }
        setIndicator('aiFiles', data.aiOptimizedFile === true || data.llmFile === true);
        setIndicator('ai-meta-tags', data.aiMetaTags.purpose === true || data.aiMetaTags.target === true || data.aiMetaTags.keywords === true || data.aiMetaTags.contentType === true || data.aiMetaTags.businessType === true || data.aiMetaTags.serviceArea === true);
        
        // Image Optimization
        const imageOptimizationScore = Math.round(data.imageOptimizationScore);
        document.getElementById('image-optimization-score').textContent = `${imageOptimizationScore}%`;
        setProgressBar('image-optimization-bar', imageOptimizationScore);
        
        setIndicator('modern-image-formats', data.modernImageFormats === true);
        setIndicator('descriptive-alt-text', data.descriptiveAltText === true);
        
        // Content Freshness
        const contentFreshnessScore = Math.round(data.contentFreshnessScore);
        document.getElementById('content-freshness-score').textContent = `${contentFreshnessScore}%`;
        setProgressBar('content-freshness-bar', contentFreshnessScore);
        
        // Update content freshness indicators
        setIndicator('published-date', data.publishedDate === true);
        setIndicator('modified-date', data.modifiedDate === true);
        
        // Update content age display
        const contentAgeElement = document.getElementById('content-age');
        if (contentAgeElement) {
          if (data.contentAge) {
            contentAgeElement.textContent = `Content Age: ${data.contentAge}`;
            contentAgeElement.classList.add('font-medium');
          } else {
            contentAgeElement.textContent = 'Content age detection requires date meta tags.';
          }
        }
        
        // Performance Optimization
        const performanceScore = Math.round(data.performanceScore || 0);
        // Update score in the second results card
        const performanceScoreElement = document.getElementById('performanceScore');
        if (performanceScoreElement) performanceScoreElement.textContent = `${performanceScore}%`;
        
        setProgressBar('performanceScoreBar', performanceScore);
        
        // Hide original Performance Optimization section
        const perfSections = document.querySelectorAll('.mb-8.col-span-1');
        perfSections.forEach(section => {
          const heading = section.querySelector('h3');
          if (heading && heading.textContent.includes('Performance Optimization')) {
            section.style.display = 'none';
          }
        });
        
        setIndicator('preload', data.preloadLinks === true);
        setIndicator('preconnect', data.preconnectLinks === true);
        setIndicator('defer', data.deferScripts === true);
        setIndicator('lazyLoad', data.lazyLoadElements === true);
        
        // Citations & References
        const citationsScore = Math.round(data.citationsScore || 0);
        // Update score in the second results card
        const citationsScoreElement = document.getElementById('citations-score');
        if (citationsScoreElement) citationsScoreElement.textContent = `${citationsScore}%`;
        
        setProgressBar('citations-bar', citationsScore);
        
        // Hide original Citations & References section
        const citationSections = document.querySelectorAll('.mb-8.col-span-1');
        citationSections.forEach(section => {
          const heading = section.querySelector('h3');
          if (heading && heading.textContent.includes('Citations & References')) {
            section.style.display = 'none';
          }
        });
        
        // Log the actual values received from worker
        console.log('Citation detection results:', {
          citationElements: data.citationElements,
          hasReferenceLinks: data.hasReferenceLinks,
          citationsScore: data.citationsScore
        });
        
        // Set indicators based on actual values
        setIndicator('citation-elements', data.citationElements === true);
        setIndicator('reference-links', data.hasReferenceLinks === true);
        
        // Show debug info - REMOVE THIS IN PRODUCTION
        const debugInfo = document.getElementById('citation-debug-info');
        if (debugInfo) {
          const debugInfoText = `
            <strong>Debug Info:</strong><br>
            Citation elements found: ${data.citationElements ? 'Yes' : 'No'}<br>
            External links found: ${data.hasReferenceLinks ? 'Yes' : 'No'}<br>
            Score: ${citationsScore}%<br>
            <em>This section checks for citation HTML tags (blockquote, cite, q) and CSS classes (.citation, .reference, .footnote, .endnote) as well as links to domains other than the current site. Social media and business profile links are excluded.</em>
          `;
          debugInfo.innerHTML = debugInfoText;
          // Uncomment to show debug info
          debugInfo.style.display = 'block';
        }
        
        // Authority & Trust Signals
        const authorityScore = Math.round(data.authorityScore || 0);
        // Update score in the second results card
        const authorityScoreElement = document.getElementById('authority-score');
        if (authorityScoreElement) authorityScoreElement.textContent = `${authorityScore}%`;
        
        setProgressBar('authority-bar', authorityScore);
        
        // Hide original Authority & Trust Signals section
        const authoritySections = document.querySelectorAll('.mb-8.col-span-1');
        authoritySections.forEach(section => {
          const heading = section.querySelector('h3');
          if (heading && heading.textContent.includes('Authority & Trust Signals')) {
            section.style.display = 'none';
          }
        });
        
        setIndicator('author-info', data.authorInfo === true);
        setIndicator('author-bio', data.hasAuthorBio === true);
        setIndicator('social-media-links', data.socialMediaLinks === true);
        setIndicator('business-profile-links', data.businessProfileLinks === true);
        
        // Show results section
        resultsSection.classList.remove('hidden');
        
        // Target the AI analyzer section which is the primary section
        document.querySelector('#ai-analyzer').scrollIntoView({ behavior: 'smooth' });
      }
      
      // Show error message
      function showError(message) {
        errorMessage.textContent = message;
        errorAlert.classList.remove('hidden');
      }
      
      // Hide error message
      function hideError() {
        errorAlert.classList.add('hidden');
      }
      
      // Set loading state
      function setLoading(isLoading) {
        if (isLoading) {
          buttonText.textContent = 'Analyzing...';
          buttonSpinner.classList.remove('hidden');
          analyzeButton.disabled = true;
        } else {
          buttonText.textContent = 'Analyze Website';
          buttonSpinner.classList.add('hidden');
          analyzeButton.disabled = false;
        }
      }
      
      // Event listeners
      analyzeForm.addEventListener('submit', analyzeWebsite);
    });
    
    // AI Visibility Analyzer Functionality
    document.addEventListener('DOMContentLoaded', function() {
      const analyzeForm = document.getElementById('analyzeForm');
      const websiteUrlInput = document.getElementById('urlInput'); // Fixed: using correct input ID
      const analyzeButton = document.getElementById('analyzeButton');
      const buttonText = document.getElementById('buttonText');
      const buttonSpinner = document.getElementById('buttonSpinner');
      const resultsSection = document.getElementById('resultsSection');
      const analyzedUrlElement = document.getElementById('analyzedUrl');
      const errorAlert = document.getElementById('errorAlert');
      const errorMessage = document.getElementById('errorMessage');
      
      if (!analyzeForm) return; // Exit if form doesn't exist
      
      // Function to validate URL
      function isValidUrl(url) {
        try {
          const parsedUrl = new URL(url);
          return parsedUrl.protocol === 'http:' || parsedUrl.protocol === 'https:';
        } catch (e) {
          return false;
        }
      }
      
      // Function to set progress bar width
      function setProgressBar(elementId, percentage) {
        const progressBar = document.getElementById(elementId);
        if (progressBar) {
          progressBar.style.width = `${percentage}%`;
        }
      }
      
      // Function to set indicator status (check/x)
      function setIndicator(elementId, isPresent) {
        const element = document.getElementById(elementId);
        if (element) {
          const icon = element.querySelector('svg');
          if (icon) {
            if (isPresent) {
              icon.classList.remove('text-red-500');
              icon.classList.add('text-green-500');
              icon.innerHTML = '<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />';
            } else {
              icon.classList.remove('text-green-500');
              icon.classList.add('text-red-500');
              icon.innerHTML = '<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />';
            }
          }
          
          // Update the text to show status if needed
          const textElement = element.querySelector('span');
          if (textElement && textElement.textContent.includes(':')) {
            const baseText = textElement.textContent.split(':')[0];
            textElement.textContent = isPresent ? 
              `${baseText}: Good` : 
              `${baseText}: Needs Improvement`;
          }
        }
      }
      
      // Handle form submission
      function analyzeWebsite(e) {
        e.preventDefault();
        
        // Get URL input
        const url = websiteUrlInput.value.trim();
        
        // Validate URL
        if (!url) {
          showError('Please enter a website URL.');
          return;
        }
        
        if (!isValidUrl(url)) {
          showError('Please enter a valid URL (e.g. https://example.com).');
          return;
        }
        
        // Clear any previous errors
        hideError();
        
        // Show loading state
        setLoading(true);
        
        // Set the analyzed URL in the results
        if (analyzedUrlElement) {
          analyzedUrlElement.textContent = url;
        }
        
        // Simulate an API call with a timeout (replace with actual API call in production)
        setTimeout(function() {
          // Process the response data (this would come from your actual API)
          processResults({
            url: url,
            overallScore: Math.floor(Math.random() * 20) + 60, // Random score between 60-80
            aiSeoScore: Math.floor(Math.random() * 20) + 70,
            imageOptScore: Math.floor(Math.random() * 30) + 70,
            schemaMarkup: Math.random() > 0.3,
            schemaQuality: Math.random() > 0.6,
            aiOptimizedTitle: Math.random() > 0.4,
            aiOptimizedMetaTags: Math.random() > 0.3,
            modernImageFormats: Math.random() > 0.2,
            descriptiveAltText: Math.random() > 0.5
          });
          
          // Hide loading state
          setLoading(false);
        }, 2000);
      }
      
      // NOTE: DISABLED TO FIX AI SEO SCORE CALCULATION ISSUE
      // This function was conflicting with the displayResults function
      // Keeping for reference until confirmed for deletion
      /*
      // Process and display results
      function processResults(data) {
        // Update the overall score
        const overallScore = Math.round(data.overallScore);
        const overallScoreElement = document.getElementById('overallScore');
        if (overallScoreElement) overallScoreElement.textContent = `${overallScore}%`;
        setProgressBar('overallScoreBar', overallScore);
        
        // Update AI SEO score
        const aiSeoScore = Math.round(data.aiSeoScore);
        const aiSeoScoreElement = document.getElementById('aiSeoScore');
        if (aiSeoScoreElement) aiSeoScoreElement.textContent = `${aiSeoScore}%`;
        setProgressBar('aiSeoScoreBar', aiSeoScore);
        
        // Update Image Optimization score
        const imageOptScore = Math.round(data.imageOptScore);
        document.getElementById('imageOptScore').textContent = `${imageOptScore}%`;
        setProgressBar('imageOptScoreBar', imageOptScore);
        
        // Set indicators based on analysis
        setIndicator('schema-markup', data.schemaMarkup);
        setIndicator('schema-quality', data.schemaQuality);
        setIndicator('ai-optimized-title', data.aiOptimizedTitle);
        setIndicator('ai-optimized-meta', data.aiOptimizedMetaTags);
        setIndicator('modern-image-format', data.modernImageFormats);
        setIndicator('descriptive-alt-text', data.descriptiveAltText);
        
        // Show results section
        resultsSection.classList.remove('hidden');
        
        // Target the AI analyzer section which is the primary section
        document.querySelector('#ai-analyzer').scrollIntoView({ behavior: 'smooth' });
      }
      */
      
      // Empty placeholder function to prevent errors if any code calls processResults
      function processResults(data) {
        console.log('processResults disabled - using displayResults instead');
      }
      
      // Show error message
      function showError(message) {
        errorMessage.textContent = message;
        errorAlert.classList.remove('hidden');
        
        // Hide error after 5 seconds
        setTimeout(function() {
          hideError();
        }, 5000);
      }
      
      // Hide error message
      function hideError() {
        errorAlert.classList.add('hidden');
      }
      
      // Set loading state
      function setLoading(isLoading) {
        if (isLoading) {
          buttonText.textContent = 'Analyzing...';
          buttonSpinner.classList.remove('hidden');
          analyzeButton.disabled = true;
        } else {
          buttonText.textContent = 'Analyze Website';
          buttonSpinner.classList.add('hidden');
          analyzeButton.disabled = false;
        }
      }
      
      // Event listeners
      analyzeForm.addEventListener('submit', analyzeWebsite);
    });
  </script>
</MainLayout>