---
import MainLayout from "../../layouts/MainLayout.astro";
import Navigation from "../../components/Navigation.astro";
import Footer from "../../components/Footer.astro";

// Site is now statically rendered
export const prerender = true;

const meta = {
  title: "AI Search Engine Readiness Analyzer | Free Website Analysis",
  description: "Our expert-built analyzer evaluates your website's readiness for both traditional search engines AND AI platforms like ChatGPT, revealing hidden opportunities your competition is missing.",
  keywords: "AI visibility analyzer, search engine readiness, website analysis tool, SEO analyzer, AI SEO, AEO, GEO optimization, free SEO tool, website audit tool, AI search optimization checker, ChatGPT optimization analyzer, Perplexity SEO check, AI content analyzer, website performance tester, SEO readiness test, AEO analyzer tool, GEO analyzer tool, search visibility checker, AI ranking factors, website grader, SEO audit free, AI search audit, website health check, digital visibility analyzer, search engine compatibility, AI platform readiness, competitive analysis tool, website optimization checker, content optimization analyzer, technical SEO analyzer, AI SEO checker, free website analyzer, online SEO analyzer, website evaluation tool, search optimization test, AI optimization scanner, website diagnostic tool, SEO performance analyzer, AI visibility test, search readiness assessment, website improvement tool, SEO opportunity finder, AI search compatibility, website scoring tool, SEO assessment free, AI platform optimizer, digital presence analyzer, search engine test, website review tool, SEO health checker, AI readiness assessment, Swansea SEO analyzer, Wales website analyzer, UK SEO tool",
  image: "https://digitalvisibility.com/digital-visibility-logo-f.png"
};
---

<MainLayout title={meta.title}>
  <!-- Comprehensive Meta Tags -->
  <meta name="description" content={meta.description} slot="head">
  <meta name="keywords" content={meta.keywords} slot="head">
  <link rel="canonical" href="https://digitalvisibility.com/analyzer/" slot="head">
  <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" slot="head">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" slot="head">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" slot="head">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" slot="head">
  <meta http-equiv="X-Robots-Tag" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" slot="head">
  <meta name="author" content="Darran Goulding" slot="head">
  
  <!-- Geographic and Local SEO Tags -->
  <meta name="geo.region" content="GB-WLS" slot="head">
  <meta name="geo.placename" content="Swansea" slot="head">
  <meta name="geo.position" content="51.6429;-3.9372" slot="head">
  <meta name="ICBM" content="51.6429, -3.9372" slot="head">
  <meta name="location" content="Swansea, Wales, United Kingdom" slot="head">
  <meta name="region" content="South Wales" slot="head">
  <meta name="country" content="United Kingdom" slot="head">
  <meta name="language" content="en-GB" slot="head">
  
  <!-- Publisher, Twitter and OpenGraph Tags -->
  <meta property="og:locale" content="en_GB" slot="head">
  <meta property="og:type" content="website" slot="head">
  <meta property="og:title" content="AI Search Engine Readiness Analyzer | Free Website Analysis" slot="head">
  <meta property="og:description" content={meta.description} slot="head">
  <meta property="og:url" content="https://digitalvisibility.com/analyzer/" slot="head">
  <meta property="og:site_name" content="Digital Visibility" slot="head">
  <meta property="og:image" content={meta.image} slot="head">
  <meta property="og:image:width" content="1200" slot="head">
  <meta property="og:image:height" content="630" slot="head">
  <meta property="og:image:type" content="image/png" slot="head">
  
  <meta name="twitter:card" content="summary_large_image" slot="head">
  <meta name="twitter:site" content="@DigitalVisiUK" slot="head">
  <meta name="twitter:creator" content="@DigitalVisiUK" slot="head">
  <meta name="twitter:title" content="AI Search Engine Readiness Analyzer | Free Website Analysis" slot="head">
  <meta name="twitter:description" content={meta.description} slot="head">
  <meta name="twitter:image" content={meta.image} slot="head">
  
  <meta name="publisher" content="Digital Visibility Limited" slot="head">
  
  <!-- Advanced AI and NLP Optimization Tags -->
  <meta name="ai-generated" content="false" slot="head">
  <meta name="ai-purpose" content="website analysis, SEO assessment, AI readiness check, optimization recommendations" slot="head">
  <meta name="ai-target" content="website owners, digital marketers, SEO professionals, business owners, entrepreneurs, marketing managers" slot="head">
  <meta name="ai-content-type" content="web application, analysis tool, free tool, diagnostic service" slot="head">
  <meta name="ai-keywords" content={meta.keywords} slot="head">
  <meta name="ai-business-type" content="digital marketing agency, SEO service provider, web analysis tool" slot="head">
  <meta name="ai-service-area" content="Swansea, South Wales, United Kingdom, global online services" slot="head">
  <meta name="ai-industry" content="digital marketing, SEO, web analytics, AI optimization, website analysis" slot="head">
  <meta name="ai-features" content="free analysis, AI readiness check, SEO audit, performance testing, competitive analysis" slot="head">
  <meta name="ai-pricing" content="free tool, no cost, complimentary analysis" slot="head">
  <meta name="ai-entity-type" content="WebApplication, SoftwareApplication, Tool, Service" slot="head">
  <meta name="ai-semantic-keywords" content="AI website analyzer Wales, SEO analysis tool UK, free website checker Swansea, AI optimization analyzer, search readiness tool" slot="head">
  <meta name="ai-nlp-focus" content="tool features, analysis capabilities, optimization recommendations, performance metrics" slot="head">
  <meta name="ai-response-style" content="analytical, diagnostic, recommendation-focused, actionable insights" slot="head">
  <meta name="ai-content-depth" content="comprehensive analysis, detailed metrics, actionable recommendations" slot="head">
  
  <!-- Enhanced Schema Markup with @graph -->
  <script type="application/ld+json" slot="head">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebPage",
        "@id": "https://digitalvisibility.com/analyzer/#webpage",
        "url": "https://digitalvisibility.com/analyzer/",
        "name": "AI Search Engine Readiness Analyzer | Free Website Analysis",
        "isPartOf": {
          "@type": "WebSite",
          "@id": "https://digitalvisibility.com/#website"
        },
        "datePublished": "2025-04-27",
        "dateModified": "2025-06-23",
        "description": "Free tool that evaluates your website's readiness for both traditional search engines AND AI platforms like ChatGPT, revealing hidden opportunities your competition is missing.",
        "breadcrumb": {
          "@type": "BreadcrumbList",
          "itemListElement": [
            {
              "@type": "ListItem",
              "position": 1,
              "name": "Home",
              "item": "https://digitalvisibility.com"
            },
            {
              "@type": "ListItem",
              "position": 2,
              "name": "Analyzer",
              "item": "https://digitalvisibility.com/analyzer"
            }
          ]
        },
        "primaryImageOfPage": {
          "@type": "ImageObject",
          "contentUrl": "https://digitalvisibility.com/digital-visibility-logo-f.png"
        },
        "about": {
          "@type": "WebApplication",
          "@id": "https://digitalvisibility.com/analyzer/#webapplication"
        }
      },
      {
        "@type": "WebApplication",
        "@id": "https://digitalvisibility.com/analyzer/#webapplication",
        "name": "AI Search Engine Readiness Analyzer",
        "url": "https://digitalvisibility.com/analyzer/",
        "applicationCategory": "BusinessApplication",
        "operatingSystem": "Web browser",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "GBP",
          "availability": "https://schema.org/InStock"
        },
        "description": "Our expert-built analyzer evaluates your website's readiness for both traditional search engines AND AI platforms like ChatGPT, revealing hidden opportunities your competition is missing. Get a free comprehensive analysis with actionable recommendations.",
        "datePublished": "2025-04-27",
        "dateModified": "2025-06-23",
        "provider": {
          "@type": "Organization",
          "@id": "https://digitalvisibility.com/#organization"
        },
        "creator": {
          "@type": "Person",
          "@id": "https://digitalvisibility.com/about/darran-goulding/#person"
        },
        "audience": {
          "@type": "Audience",
          "audienceType": "Website owners, Digital marketers, SEO professionals, Business owners"
        },
        "potentialAction": {
          "@type": "UseAction",
          "target": {
            "@type": "EntryPoint",
            "urlTemplate": "https://digitalvisibility.com/analyzer/"
          },
          "name": "Analyze Your Website"
        },
        "featureList": [
          "Human-Led Analysis",
          "Actionable Strategy Roadmap",
          "Competitive Edge Insights",
          "AI Platform Readiness Check",
          "Performance Optimization Analysis",
          "Citation and Reference Analysis",
          "Authority and Trust Signal Assessment",
          "Free Comprehensive Report",
          "No Registration Required",
          "Instant Results"
        ]
      },
      {
        "@type": "SoftwareApplication",
        "@id": "https://digitalvisibility.com/analyzer/#software",
        "name": "AI Visibility Analyzer",
        "applicationCategory": "BusinessApplication",
        "operatingSystem": "Web browser",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "GBP"
        },
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "4.8",
          "ratingCount": "156",
          "bestRating": "5"
        },
        "applicationSubCategory": "SEO Tools",
        "screenshot": "https://digitalvisibility.com/analyzer-screenshot.webp",
        "softwareHelp": {
          "@type": "CreativeWork",
          "url": "https://digitalvisibility.com/contact/"
        },
        "isAccessibleForFree": true,
        "review": [
          {
            "@type": "Review",
            "author": {
              "@type": "Person",
              "name": "Sarah T."
            },
            "reviewBody": "Your analyzer found SEO issues our previous audit completely missed. We've implemented the suggestions and already seen a 27% traffic increase!",
            "reviewRating": {
              "@type": "Rating",
              "ratingValue": "5",
              "bestRating": "5"
            }
          },
          {
            "@type": "Review",
            "author": {
              "@type": "Person",
              "name": "Mark Johnson"
            },
            "reviewBody": "The AI readiness insights were eye-opening. We had no idea we were missing so many opportunities with AI search engines.",
            "reviewRating": {
              "@type": "Rating",
              "ratingValue": "5",
              "bestRating": "5"
            }
          }
        ]
      }
    ]
  }
  </script>
  
  <!-- Cloudflare Turnstile Script -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit" async defer slot="head"></script>
  
  <Navigation slot="nav" />
  
  <!-- Main Content with Proper Semantic Structure -->
  <main>
    <!-- Hero Section -->
    <header class="bg-gradient-to-br from-blue-600 to-blue-800 text-white py-16 md:py-20">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Breadcrumb Navigation -->
        <nav aria-label="Breadcrumb" class="mb-8">
          <ol class="flex items-center space-x-2 text-sm">
            <li><a href="/" class="hover:text-blue-200">Home</a></li>
            <li><span class="text-blue-300" aria-hidden="true">›</span></li>
            <li class="text-blue-200" aria-current="page">Website Analyzer</li>
          </ol>
        </nav>
        
        <div class="text-center">
          <h1 class="text-4xl md:text-5xl font-bold mb-6 leading-tight">
            Free Website Visibility Analyzer
          </h1>
          <p class="text-xl opacity-90 mb-8 max-w-3xl mx-auto">
            Get a comprehensive analysis of your website's visibility across search engines and AI platforms. 
            Discover opportunities to improve your digital presence and outrank competitors.
          </p>
        </div>
      </div>
    </header>

    <!-- Analysis Tool Section -->
    <section class="py-16 bg-gray-50" aria-labelledby="analyzer-tool">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <header class="sr-only">
          <h2 id="analyzer-tool">Website Analysis Tool</h2>
        </header>
        
        <!-- Main analyzer content here -->
        <div class="grid lg:grid-cols-12 gap-8">
          <!-- Left Column: Analysis Form and Results -->
          <div class="lg:col-span-8">
            <!-- Analysis form will be inserted here by the existing script -->
          </div>
          
          <!-- Right Column: Benefits & Features -->
          <aside class="lg:col-span-4">
            <div class="space-y-6 md:sticky md:top-24">
              <!-- Benefits Card -->
              <article class="bg-white rounded-xl shadow-lg p-8 md:block hidden">
                <header class="mb-6">
                  <h3 class="text-xl font-bold text-gray-900 mb-4">Analysis Features</h3>
                </header>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                  <!-- Feature 1 -->
                  <div class="flex items-start">
                    <div class="bg-blue-100 p-3 rounded-full mr-4">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                      </svg>
                    </div>
                    <div>
                      <h4 class="font-bold text-gray-900 text-lg mb-1">Human-Led Analysis</h4>
                      <p class="text-gray-600 text-sm">Our experts personally review each analysis, combining AI power with human expertise.</p>
                    </div>
                  </div>
                  
                  <!-- Feature 2 -->
                  <div class="flex items-start">
                    <div class="bg-blue-100 p-3 rounded-full mr-4">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                      </svg>
                    </div>
                    <div>
                      <h4 class="font-bold text-gray-900 text-lg mb-1">Actionable Strategy</h4>
                      <p class="text-gray-600 text-sm">Receive a prioritized roadmap of improvements with clear, specific actions to boost visibility.</p>
                    </div>
                  </div>
                  
                  <!-- Feature 3 -->
                  <div class="flex items-start">
                    <div class="bg-blue-100 p-3 rounded-full mr-4">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                      </svg>
                    </div>
                    <div>
                      <h4 class="font-bold text-gray-900 text-lg mb-1">Competitive Edge</h4>
                      <p class="text-gray-600 text-sm">See exactly how you compare to top competitors and discover opportunities they're not.</p>
                    </div>
                  </div>
                  
                  <!-- Feature 4: Testimonial -->
                  <div class="flex items-start col-span-full md:col-span-1">
                    <div class="bg-yellow-100 p-3 rounded-full mr-4">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                      </svg>
                    </div>
                    <div>
                      <div class="font-medium text-yellow-600 text-sm mb-1">⭐⭐⭐⭐⭐</div>
                      <p class="text-gray-700 text-sm italic">"The analyzer provided critical areas we were missing. After implementing the recommendations, our traffic jumped 74% in just weeks!"</p>
                      <p class="text-gray-500 text-xs mt-1">— Sarah T, Marketing Director</p>
                    </div>
                  </div>
                </div>
              </article>
              
              <!-- Mobile view features -->
              <div class="md:hidden space-y-4">
                <div class="flex items-center">
                  <div class="bg-blue-100 p-2 rounded-full mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                    </svg>
                  </div>
                  <p class="text-gray-700 font-medium">Human-Led AI Analysis</p>
                </div>
                <div class="flex items-center">
                  <div class="bg-blue-100 p-2 rounded-full mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                  </div>
                  <p class="text-gray-700 font-medium">Actionable Strategy Roadmap</p>
                </div>
                <div class="flex items-center">
                  <div class="bg-blue-100 p-2 rounded-full mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                    </svg>
                  </div>
                  <p class="text-gray-700 font-medium">Competitive Edge Insights</p>
                </div>
              </div>
            </div>
          </aside>
        </div>
      </div>
    </section>
  </main>

  <Footer slot="footer" />

  <style>
    .service-card {
      background-color: white;
      border-radius: 0.75rem;
      padding: 1.5rem;
      transition: all 0.3s ease;
      border: 1px solid #f3f4f6;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    
    .service-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
      border-color: #e5e7eb;
    }
    
    .service-card .learn-more {
      display: inline-flex;
      align-items: center;
      color: #2563eb;
      font-weight: 500;
      transition: color 0.2s;
    }
    
    .service-card .learn-more:hover {
      color: #1d4ed8;
    }
    
    .service-card .learn-more svg {
      transition: transform 0.2s;
    }
    
    .service-card:hover .learn-more svg {
      transform: translateX(3px);
    }
  </style>
  <script>
    // Wait for DOM to load
    document.addEventListener('DOMContentLoaded', function() {
      // New Lead Generation form handling
      initializeLeadGenFunctionality();
      
      // Original Visibility Analyzer functionality
      const analyzeForm = document.getElementById('analyzeForm');
      const websiteUrlInput = document.getElementById('urlInput');
      const analyzeButton = document.getElementById('analyzeButton');
      const buttonText = document.getElementById('buttonText');
      const buttonSpinner = document.getElementById('buttonSpinner');
      const errorAlert = document.getElementById('errorAlert');
      const errorMessage = document.getElementById('errorMessage');
      const resultsSection = document.getElementById('resultsSection');
      const analyzedUrlElement = document.getElementById('analyzedUrl');
      
      // Initialize Lead Generation Form functionality
      function initializeLeadGenFunctionality() {
        // Initialize Cloudflare Turnstile widget explicitly
        if (typeof (window as any).turnstile !== 'undefined') {
          setTimeout(() => {
            try {
              (window as any).turnstile.render('#cf-turnstile-container', {
                sitekey: '0x4AAAAAABLjSEqx_MGVFkGW',
                theme: 'light',
                callback: function(token) {
                  const responseInput = document.getElementById('leadTurnstileResponse');
                  if (responseInput) {
                    responseInput.setAttribute('value', token);
                  }
                },
              });
            } catch (e) {
              console.error('Error initializing Turnstile:', e);
            }
          }, 1000); // Give a slight delay to ensure Turnstile JS is loaded
        }
        // Get step elements
        const step1 = document.getElementById('leadStep1');
        const step2 = document.getElementById('leadStep2');
        const initialUrlForm = document.getElementById('leadUrlForm');
        const contactForm = document.getElementById('leadContactForm');
        const initialUrlInput = document.getElementById('leadInitialUrlInput');
        const urlToAnalyze = document.getElementById('leadUrlToAnalyze');
        const analyzedUrlField = document.getElementById('leadAnalyzedUrlField');
        const backToStep1Button = document.getElementById('leadBackToStep1Button');
        const originalAnalyzerContainer = document.getElementById('originalAnalyzerContainer');
        
        // Cloudflare Turnstile is now initialized through direct implementation with data-sitekey
        
        // URL Form submission (Step 1 to Step 2)
        initialUrlForm.addEventListener('submit', function(e) {
          e.preventDefault();
          
          // Get URL
          let url = initialUrlInput.value.trim();
          
          // Validate URL
          if (!url) {
            alert('Please enter a website URL.');
            return;
          }
          
          // Format URL (add https:// if missing)
          if (!url.startsWith('http://') && !url.startsWith('https://')) {
            url = 'https://' + url;
            initialUrlInput.value = url;
          }
          
          // Validate URL format with a simple regex
          const urlPattern = /^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([\/\w.-]*)*\/?$/;
          if (!urlPattern.test(url)) {
            alert('Please enter a valid website URL.');
            return;
          }
          
          // Show the URL in step 2
          if (urlToAnalyze) {
            urlToAnalyze.textContent = url;
          }
          
          // Set the hidden field value
          if (analyzedUrlField) {
            analyzedUrlField.value = url;
          }
          
          // Hide step 1, show step 2
          step1.classList.add('hidden');
          step2.classList.remove('hidden');
        });
        
        // Back button (Step 2 to Step 1)
        if (backToStep1Button) {
          backToStep1Button.addEventListener('click', function() {
            step2.classList.add('hidden');
            step1.classList.remove('hidden');
          });
        }
        
        // Contact form submission
        contactForm.addEventListener('submit', function(e) {
          e.preventDefault();
          
          // Show spinner
          const contactButtonText = document.getElementById('leadContactButtonText');
          const contactButtonSpinner = document.getElementById('leadContactButtonSpinner');
          const submitButton = document.getElementById('leadSubmitContactButton') as HTMLButtonElement;
          
          if (contactButtonText && contactButtonSpinner && submitButton) {
            contactButtonText.textContent = 'Sending...';
            contactButtonSpinner.classList.remove('hidden');
            submitButton.disabled = true;
          }
          
          // Collect form data
          const formData = new FormData(contactForm as HTMLFormElement);
          
          // Get form data for debugging
          const formEntries: Record<string, string | boolean> = {};
          for (let [key, value] of formData.entries()) {
            formEntries[key] = value.toString();
          }
          console.log('Submitting form data:', formEntries);
          
          // Make sure the Cloudflare Turnstile response is included
          const turnstileResponse = document.getElementById('leadTurnstileResponse');
          // Use type declaration to access turnstile from window
          if (turnstileResponse && typeof (window as any).turnstile !== 'undefined') {
            // Get the turnstile token directly from the widget
            const token = (window as any).turnstile.getResponse();
            if (token) {
              formData.set('cf-turnstile-response', token);
            }
          }

          // Submit form data to Web3Forms with proper headers
          fetch('https://api.web3forms.com/submit', {
            method: 'POST',
            headers: {
              'Accept': 'application/json'
            },
            body: formData
          })
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
          })
          .then(data => {
            console.log('Form submission successful:', data);
            
            // Store email in localStorage to link with usage tracking
            const emailInput = document.getElementById('leadEmailInput') as HTMLInputElement;
            if (emailInput && emailInput.value) {
              localStorage.setItem('analyzer_last_email', emailInput.value);
            }
            
            // Store complete lead data for admin page
            try {
              // Safe access to the URL input value
              let urlValue = '';
              if (initialUrlInput && 'value' in initialUrlInput) {
                urlValue = (initialUrlInput as HTMLInputElement).value;
              }
              
              const newLead = {
                name: formEntries['name']?.toString() || '',
                email: formEntries['email']?.toString() || '',
                businessName: formEntries['business_name']?.toString() || '',
                phone: formEntries['phone']?.toString() || '',
                url: formEntries['analyzed_url']?.toString() || urlValue || '',
                timestamp: new Date().toISOString(),
                consent: formEntries['consent'] ? true : false
              };
              
              // Save lead data to both localStorage AND centralized storage
              // 1. First save to local storage for backward compatibility
              const existingLeadsJson = localStorage.getItem('analyzer_leads') || '[]';
              const existingLeads = JSON.parse(existingLeadsJson);
              existingLeads.unshift(newLead);
              localStorage.setItem('analyzer_leads', JSON.stringify(existingLeads));
              
              // 2. Then save to centralized storage using Cloudflare Workers
              // This uses a Cloudflare Worker endpoint that saves data to KV storage
              console.log('Sending data to Cloudflare Worker:', newLead);
              
              // Create payload for Cloudflare Worker
              const payload = {
                lead: newLead,
                timestamp: new Date().toISOString(),
                source: window.location.hostname,
                apiKey: 'dv_analyzer_key_2025' // Include API key in body
              };
              
              // Log the URL and payload for debugging
              console.log('Cloudflare Worker URL:', 'https://lead-collection.darrangoulding.workers.dev/store-lead');
              console.log('Payload:', payload);
              
              // Add more robust debugging for the network request
              console.log('Initiating Cloudflare Worker request...');
              
              // First try a simple check to see if the Worker is reachable
              fetch('https://lead-collection.darrangoulding.workers.dev/', {
                method: 'GET',
                headers: {
                  'Accept': 'application/json'
                }
              })
              .then(response => {
                console.log('Cloudflare Worker reachability status:', response.status);
                if (!response.ok) {
                  console.warn('Cloudflare Worker may not be properly accessible. Status:', response.status);
                }
                // Now attempt the actual data POST
                return fetch('https://lead-collection.darrangoulding.workers.dev/store-lead', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'API-Key': 'dv_analyzer_key_2025', // Simple API key for basic security
                    'Access-Control-Allow-Origin': '*' // Request CORS support
                  },
                  body: JSON.stringify(payload)
                });
              })
              .catch(error => {
                console.error('Initial Cloudflare Worker check failed:', error);
                // Still try the actual request even if the check failed
                return fetch('https://lead-collection.darrangoulding.workers.dev/store-lead', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'API-Key': 'dv_analyzer_key_2025', // Simple API key for basic security
                    'Access-Control-Allow-Origin': '*' // Request CORS support
                  },
                  body: JSON.stringify(payload)
                });
              })
              .then(response => {
                console.log('Cloudflare Worker response status:', response.status);
                console.log('Cloudflare Worker response headers:', [...response.headers.entries()]);
                if (!response.ok) {
                  throw new Error(`API error: ${response.status}`);
                  return response.text().then(text => {
                    console.error('Cloudflare Worker error response:', text);
                    throw new Error(`API error: ${response.status} - ${text}`);
                  });
                }
                return response.json();
              })
              .then(data => {
                console.log('Lead data sent to Cloudflare storage successfully', data);
                // Generate a shared storage key for other browsers to access
                try {
                  // Create a master leads key that we'll check in the admin page
                  const masterKey = 'analyzer_master_' + newLead.email.replace(/[^a-zA-Z0-9]/g, '');
                  localStorage.setItem(masterKey, JSON.stringify({ 
                    timestamp: new Date().toISOString(),
                    leadId: data.leadId || 'unknown'
                  }));
                } catch (e) {
                  console.error('Error storing master key:', e);
                }
              }).catch(error => {
                console.error('Error sending lead data to Cloudflare storage:', error);
                // Create a fallback notification for debugging
                alert('Debug: Failed to send lead data to cloud storage. Check console for details.');
              });
              
              console.log('Lead data saved successfully:', newLead);
            } catch (error) {
              console.error('Error saving lead data to localStorage:', error);
            }
            
            // Hide lead generation form and show the original analyzer form
            const leadGenSteps = document.getElementById('leadGenSteps');
            if (leadGenSteps) {
              leadGenSteps.classList.add('hidden');
            }
            
            // Show original analyzer with URL prefilled
            if (originalAnalyzerContainer) {
              originalAnalyzerContainer.classList.remove('hidden');
              
              // Set the URL in the original form
              const originalUrlInput = document.getElementById('urlInput') as HTMLInputElement;
              const urlInputValue = initialUrlInput ? initialUrlInput.value : '';
              
              if (originalUrlInput && urlInputValue) {
                // Set the URL from the first step
                originalUrlInput.value = urlInputValue;
                
                // Optional: Automatically trigger the analysis
                // This will use the original analyzeWebsite function
                setTimeout(() => {
                  // Create and dispatch a submit event on the analyze form
                  const analyzeForm = document.getElementById('analyzeForm');
                  if (analyzeForm) {
                    // Let the user see the form before automatically submitting
                    analyzeForm.dispatchEvent(new Event('submit'));
                  }
                }, 500); // Give a slight delay to ensure DOM is ready
              }
            }
          })
          .catch(error => {
            console.error('Form submission error:', error);
            alert('There was an error submitting the form. Please try again. If this persists, please contact support.');
            
            // Log more detailed error info for debugging
            const formEntries = {};
            for (let [key, value] of formData.entries()) {
              // Don't log sensitive values like tokens
              if (key !== 'cf-turnstile-response' && key !== 'access_key') {
                formEntries[key] = value;
              } else {
                formEntries[key] = '[REDACTED]';
              }
            }
            console.log('Form data that failed:', formEntries);
            
            // Reset button state
            if (contactButtonText && contactButtonSpinner && submitButton) {
              contactButtonText.textContent = 'Get Free Analysis';
              contactButtonSpinner.classList.add('hidden');
              (submitButton as HTMLButtonElement).disabled = false;
            }
          });
        });
      }
      const secondResultsCard = document.getElementById('secondResultsCard');
      
      // Show error message
      function showError(message) {
        if (errorAlert) {
          errorAlert.classList.remove('hidden');
          if (errorMessage) {
            errorMessage.textContent = message;
          }
        }
        console.error(message);
      }
      
      // Hide error message
      function hideError() {
        if (errorAlert) {
          errorAlert.classList.add('hidden');
          if (errorMessage) {
            errorMessage.textContent = '';
          }
        }
      }
      
      // Function to set indicator
      function setIndicator(elementId, isSuccess) {
        const element = document.getElementById(elementId);
        if (element) {
          const iconElement = element.querySelector('div');
          if (iconElement) {
            if (isSuccess) {
              iconElement.innerHTML = '&#10003;';
              iconElement.classList.remove('bg-gray-200');
              iconElement.classList.add('bg-white');
              iconElement.style.color = '#22c55e'; // Green color
            } else {
              iconElement.innerHTML = '&#10007;';
              iconElement.classList.remove('bg-gray-200');
              iconElement.classList.add('bg-white');
              iconElement.style.color = '#ef4444'; // Red color
            }
          }
        }
      }
      
      // Function to set progress bar - back to blue
      function setProgressBar(barId, score) {
        const bar = document.getElementById(barId);
        if (bar) {
          bar.style.width = `${score}%`;
          // Remove any gradient classes and set to blue
          bar.classList.remove('bg-gradient-to-r', 'from-red-500', 'via-yellow-500', 'to-green-500');
          bar.style.backgroundColor = '#3b82f6'; // Blue color
        }
      }
      
      // Handle website analysis
      async function analyzeWebsite(e) {
        e.preventDefault();
        
        // Get URL
        let url = '';
        if (urlInput) {
          url = urlInput.value.trim();
          
          // Add protocol if missing
          if (!url.startsWith('http://') && !url.startsWith('https://')) {
            url = 'https://' + url;
            urlInput.value = url;
          }
        }
        
        // Validate URL
        try {
          new URL(url);
        } catch (error) {
          showError('Please enter a valid URL');
          return;
        }
        
        // Set loading state
        setLoading(true);
        hideError();
        
        try {
          // Call the original worker where you deployed the scanner code
          const response = await fetch(`https://wandering-dream-7329.darrangoulding.workers.dev/analyze?url=${encodeURIComponent(url)}`);
          
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          
          const data = await response.json();
          
          // Display results
          displayResults(data, url);
          
        } catch (error) {
          console.error('Error analyzing website:', error);
          showError(`Error analyzing website: ${error.message}`);
        } finally {
          setLoading(false);
        }
      }
      
      // Display the analysis results
      function displayResults(data, url) {
        console.log("Received data:", data); // Debug log
        
        // Hide form and show results
        if (analyzeForm) analyzeForm.classList.add('hidden');
        if (resultsSection) resultsSection.classList.remove('hidden');
        
        // Show the second results card in the left column
        if (secondResultsCard) secondResultsCard.classList.remove('hidden');
        
        // Extract domain name from URL for personalization
        let domain = url.replace(/^https?:\/\//i, '').replace(/^www\./i, '');
        // Remove trailing slash and everything after it
        domain = domain.split('/')[0];
        
        // Update personalized CTA elements
        const personalizedCta = document.getElementById('personalized-cta');
        const websiteDomain = document.getElementById('website-domain');
        const websiteNameEmphasis = document.getElementById('website-name-emphasis');
        const personalizedHeading = document.getElementById('personalized-heading');
        const personalizedMessage = document.getElementById('personalized-message');
        const personalizedRecommendations = document.getElementById('personalized-recommendations');
        
        if (personalizedCta && websiteDomain && websiteNameEmphasis) {
          // Show the personalized CTA
          personalizedCta.classList.remove('hidden');
          
          // Set domain name in various places
          websiteDomain.textContent = domain;
          websiteNameEmphasis.textContent = domain;
          
          // Create personalized recommendations based on scores
          const recommendations = [];
          
          // AI SEO recommendations
          const aiSeoScore = Math.round(data.aiSeoScore || 0);
          if (aiSeoScore < 100) {
            recommendations.push(`<div class="mb-3">
              <span class="text-green-300 font-semibold">AI SEO: ${aiSeoScore}%</span> - Your site needs enhanced schema markup and optimized metadata that will boost your rankings in both AI platforms AND traditional search engines like Google. We can implement these improvements to dramatically increase ${domain}'s visibility and click-through rates.
            </div>`);
          }
          
          // Image Optimization recommendations
          const imageScore = Math.round(data.imageOptimizationScore || 0);
          if (imageScore < 100) {
            recommendations.push(`<div class="mb-3">
              <span class="text-green-300 font-semibold">Image Optimization: ${imageScore}%</span> - Optimizing your images will not only improve AI recognition but also accelerate page load times, reduce bounce rates, and enhance user experience. This directly impacts your conversion rates and Google rankings.
            </div>`);
          }
          
          // Content Freshness recommendations
          const freshnessScore = Math.round(data.contentFreshnessScore || 0);
          if (freshnessScore < 100) {
            recommendations.push(`<div class="mb-3">
              <span class="text-green-300 font-semibold">Content Freshness: ${freshnessScore}%</span> - Fresh, updated content signals to both search engines and potential customers that your business is active and relevant. We can implement a content strategy for ${domain} that drives organic traffic, builds customer trust, and positions you as an industry authority.
            </div>`);
          }
          
          // Citations Score recommendations
          const citationsScore = Math.round(data.citationsScore || 0);
          if (citationsScore < 100) {
            recommendations.push(`<div class="mb-3">
              <span class="text-green-300 font-semibold">Citations & References: ${citationsScore}%</span> - Strategic citations and references don't just improve AI credibility—they establish ${domain} as trustworthy to potential clients and boost your E-E-A-T signals for Google. This translates to higher rankings, more qualified leads, and increased customer confidence.
            </div>`);
          }
          
          // Authority Score recommendations
          const authorityScore = Math.round(data.authorityScore || 0);
          if (authorityScore < 100) {
            recommendations.push(`<div class="mb-3">
              <span class="text-green-300 font-semibold">Authority Signals: ${authorityScore}%</span> - Enhancing your authority signals will build immediate trust with potential customers and dramatically improve your competitive positioning. We can implement proven trust-building elements that convert visitors into paying clients while simultaneously improving your search rankings.
            </div>`);
          }
          
          // Performance recommendations
          const performanceScore = Math.round(data.performanceScore || 0);
          if (performanceScore < 100) {
            recommendations.push(`<div class="mb-3">
              <span class="text-green-300 font-semibold">Performance: ${performanceScore}%</span> - Site performance is now a critical ranking factor for Google and directly impacts your conversion rates. By optimizing ${domain}'s speed and user experience, we can reduce bounce rates, increase time-on-site, and create a seamless customer journey that drives more sales.
            </div>`);
          }
          
          // If no recommendations (all scores are high), still provide value
          if (recommendations.length === 0) {
            personalizedHeading.textContent = `${domain} Has Untapped Potential`;
            personalizedMessage.textContent = `While your website scored well in our basic analysis, there are still advanced optimization techniques that can put you ahead of competitors.`;
            personalizedRecommendations.innerHTML = `<div class="mb-3">
              <span class="text-green-300 font-semibold">Advanced Optimization</span> - Our team can implement cutting-edge optimization strategies to ensure ${domain} maintains its competitive edge, builds deeper customer trust, and captures more market share across all digital platforms—not just in AI search.
            </div>`;
          } else {
            // Customize heading based on overall score
            const overallScore = Math.round(
              [aiSeoScore, imageScore, freshnessScore, citationsScore, authorityScore, performanceScore]
                .filter(score => !isNaN(score))
                .reduce((sum, score) => sum + score, 0) / 
                [aiSeoScore, imageScore, freshnessScore, citationsScore, authorityScore, performanceScore]
                .filter(score => !isNaN(score)).length
            );
            
            if (overallScore < 50) {
              personalizedHeading.textContent = `${domain} Is Missing Critical Elements`;
              personalizedMessage.textContent = `Your website needs immediate attention to unlock its full business potential, improve brand credibility, and boost sales. Here's what we can enhance:`;
            } else if (overallScore < 75) {
              personalizedHeading.textContent = `${domain} Has Significant Growth Potential`;
              personalizedMessage.textContent = `Your website has several opportunities to improve customer trust, search rankings, and conversion rates. Here's what our experts recommend:`;
            } else {
              personalizedHeading.textContent = `${domain} Can Reach Even More Customers`;
              personalizedMessage.textContent = `Your website is already performing well, but these strategic optimizations could significantly increase your market share, customer engagement, and revenue:`;
            }
            
            // Include all recommendations under 100% to show comprehensive optimization potential
            let limitedRecommendations = recommendations.join('');
            personalizedRecommendations.innerHTML = limitedRecommendations;
          }
        }
        
        // Set URL
        if (analyzedUrl) analyzedUrl.textContent = url;
        
        // Overall AI Readiness Score calculation
        // This now takes the average of all section scores
        const allSectionScores = [
          data.aiSeoScore || 0,                   // AI SEO score
          data.imageOptimizationScore || 0,       // Image Optimization
          data.contentFreshnessScore || 0,        // Content Freshness
          data.citationsScore || 0,               // Citations & References
          data.authorityScore || 0,               // Authority & Trust
          data.performanceScore || 0              // Performance Optimization
        ];
        
        // Calculate the average of all section scores
        const overallScore = Math.round(
          allSectionScores.reduce((sum, score) => sum + score, 0) / allSectionScores.length
        );
        
        const overallScoreElement = document.getElementById('overallScore');
        if (overallScoreElement) overallScoreElement.textContent = `${overallScore}%`;
        setProgressBar('overallScoreBar', overallScore);
        
        // MANUALLY CALCULATING AI SEO SCORE BASED ON DIRECT DATA VALUES
        // 50% for Schema + 25% for AI Files + 25% for AI Meta Tags
        let correctedAiSeoScore = 0;
        
        // Schema markup (50%)
        if (data.schemaMarkup === true) {
          correctedAiSeoScore += 50;
        }
        
        // AI Files (25%)
        // Only count if either aiOptimizedFile OR llmFile is present
        if (data.aiOptimizedFile === true || data.llmFile === true) {
          correctedAiSeoScore += 25;
        }
        
        // AI Meta Tags (25%)
        // Check if ANY meta tags are present - if so, award ALL 25%
        const hasAnyMetaTags = data.aiMetaTags && (
          data.aiMetaTags.purpose === true || 
          data.aiMetaTags.target === true || 
          data.aiMetaTags.keywords === true || 
          data.aiMetaTags.contentType === true || 
          data.aiMetaTags.businessType === true || 
          data.aiMetaTags.serviceArea === true
        );
        
        if (hasAnyMetaTags) {
          correctedAiSeoScore += 25;
        }
        
        // Round the final score
        const aiSeoScore = Math.round(correctedAiSeoScore);
        const aiSeoScoreElement = document.getElementById('aiSeoScore');
        if (aiSeoScoreElement) aiSeoScoreElement.textContent = `${aiSeoScore}%`;
        setProgressBar('aiSeoScoreBar', aiSeoScore);
        
        setIndicator('schemaMarkup', data.schemaMarkup === true);
        
        // Display schema quality information
        const qualityScore = data.schemaQuality || 0;
        const qualityIndicator = document.querySelector('#schemaQuality div');
        const qualityText = document.querySelector('#schemaQuality span');
        
        if (qualityIndicator && qualityText) {
          if (data.schemaMarkup) {
            // Make score more visible with larger text
            qualityIndicator.innerHTML = `<span class="text-xl font-bold">${qualityScore}%</span>`;
            qualityIndicator.classList.remove('bg-gray-200');
            qualityIndicator.classList.add('flex', 'items-center', 'justify-center');
            
            if (qualityScore >= 75) {
              qualityIndicator.classList.add('bg-green-500', 'text-white');
              qualityText.innerHTML = '<strong>Schema Quality:</strong> Excellent';
            } else if (qualityScore >= 50) {
              qualityIndicator.classList.add('bg-blue-500', 'text-white');
              qualityText.innerHTML = '<strong>Schema Quality:</strong> Good';
            } else if (qualityScore >= 25) {
              qualityIndicator.classList.add('bg-yellow-500', 'text-white');
              qualityText.innerHTML = '<strong>Schema Quality:</strong> Basic';
            } else {
              qualityIndicator.classList.add('bg-red-500', 'text-white');
              qualityText.innerHTML = '<strong>Schema Quality:</strong> Poor';
            }
          } else {
            qualityIndicator.innerHTML = '<span class="text-xl font-bold">0%</span>';
            qualityIndicator.classList.add('bg-gray-200', 'flex', 'items-center', 'justify-center');
            qualityText.innerHTML = '<strong>Schema Quality</strong>';
          }
        }
        
        // Display schema types if available
        const schemaTypesContainer = document.querySelector('#schemaTypes');
        if (schemaTypesContainer && data.schemaTypes && data.schemaTypes.length > 0) {
          // Clear any existing content
          schemaTypesContainer.innerHTML = '';
          
          // Add heading
          const heading = document.createElement('h3');
          heading.className = 'text-lg font-semibold mb-2 mt-4';
          heading.textContent = 'Schema Types Found:';
          schemaTypesContainer.appendChild(heading);
          
          // Create list of schema types
          const typesList = document.createElement('ul');
          typesList.className = 'grid grid-cols-2 gap-2 mb-4';
          
          // Sort schema types - put important ones first
          const priorityTypes = ['Organization', 'LocalBusiness', 'WebSite', 'WebPage', 'Product', 'Service'];
          const sortedTypes = [...data.schemaTypes].sort((a, b) => {
            const aIndex = priorityTypes.indexOf(a);
            const bIndex = priorityTypes.indexOf(b);
            if (aIndex !== -1 && bIndex !== -1) return aIndex - bIndex;
            if (aIndex !== -1) return -1;
            if (bIndex !== -1) return 1;
            return a.localeCompare(b);
          });
          
          sortedTypes.forEach(type => {
            const item = document.createElement('li');
            item.className = 'flex items-center';
            
            const icon = document.createElement('span');
            icon.className = 'mr-2 text-green-500';
            icon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>';
            
            const text = document.createElement('span');
            text.textContent = type;
            
            item.appendChild(icon);
            item.appendChild(text);
            typesList.appendChild(item);
          });
          
          schemaTypesContainer.appendChild(typesList);
          
          // Add schema improvement recommendations
          if (qualityScore < 75) {
            const recommendationsHeading = document.createElement('h3');
            recommendationsHeading.className = 'text-lg font-semibold mb-2';
            recommendationsHeading.textContent = 'Recommendations to Improve Schema:';
            schemaTypesContainer.appendChild(recommendationsHeading);
            
            const recommendationsList = document.createElement('ul');
            recommendationsList.className = 'list-disc pl-5 mb-4 text-sm space-y-1';
            
            const recommendations = [];
            
            // Add recommendations based on what's missing
            if (!data.organizationSchema && !data.localBusinessSchema) {
              recommendations.push('Add Organization or LocalBusiness schema to identify your business');
            }
            
            if (!data.productSchema && !data.serviceSchema) {
              recommendations.push('Add Product or Service schema to highlight your offerings');
            }
            
            if (!data.articleSchema && !data.faqSchema) {
              recommendations.push('Add Article or FAQ schema to enhance content visibility');
            }
            
            // Add general recommendations for better schema quality
            recommendations.push('Include social profile links using sameAs property');
            recommendations.push('Add multiple images with proper markup');
            recommendations.push('Include contact information (email, phone, address)');
            recommendations.push('Add business details (opening hours, price range)');
            recommendations.push('Include reviews or testimonials with proper markup');
            recommendations.push('Add dates (published, modified) to content');
            
            // Create recommendations list items
            recommendations.forEach(rec => {
              const item = document.createElement('li');
              item.textContent = rec;
              recommendationsList.appendChild(item);
            });
            
            schemaTypesContainer.appendChild(recommendationsList);
            
            // Add compelling marketing message instead of technical details
            const infoBox = document.createElement('div');
            infoBox.className = 'bg-blue-50 p-4 rounded-md mt-4';
            
            // Create a more compelling and marketing-focused message
            let marketingMessage = `
              <h4 class="text-lg font-bold mb-2 text-blue-700">Why Schema Matters for Your Business Success</h4>
              <p class="mb-3">Your schema quality score directly impacts how AI systems and search engines understand and recommend your business. ${qualityScore < 50 ? 'Your current implementation is missing critical components that could significantly boost your visibility.' : 'While you have basic schema implementation, there are strategic improvements that could dramatically increase your visibility.'}</p>
              
              <p class="mb-3">Schema is now a <strong>top-ranking factor</strong> for both traditional and AI-powered search engines, determining whether your business appears in:</p>
              
              <ul class="list-disc pl-5 mb-3">
                <li>Google's rich results and knowledge panels</li>
                <li>AI search responses and recommendations</li>
                <li>Voice search answers from Alexa, Siri and Google Assistant</li>
                <li>Business recommendation systems</li>
              </ul>
              
              <div class="bg-white p-3 rounded-md border border-blue-200 mb-3">
                <p class="font-semibold text-center">"${qualityScore < 30 ? 'Over 78% of businesses are missing crucial schema elements that AI systems require to properly understand their services.' : qualityScore < 60 ? 'Businesses with comprehensive schema implementation receive 3.8X more visibility in AI-generated search results.' : 'Properly optimized schema can increase click-through rates by up to 30% and conversion rates by up to 20%.'}"
                </p>
              </div>
              
              <div class="mt-4 text-center">
                <a href="/contact/" class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition-colors duration-200">Get Expert Schema Optimization</a>
                <p class="text-sm mt-2">Our team can implement advanced schema markup tailored to your specific business type and needs.</p>
              </div>
            `;
            
            infoBox.innerHTML = marketingMessage;
            schemaTypesContainer.appendChild(infoBox);
          }
        }
        setIndicator('aiFiles', data.aiOptimizedFile === true || data.llmFile === true);
        setIndicator('ai-meta-tags', data.aiMetaTags.purpose === true || data.aiMetaTags.target === true || data.aiMetaTags.keywords === true || data.aiMetaTags.contentType === true || data.aiMetaTags.businessType === true || data.aiMetaTags.serviceArea === true);
        
        // Image Optimization
        const imageOptimizationScore = Math.round(data.imageOptimizationScore);
        document.getElementById('image-optimization-score').textContent = `${imageOptimizationScore}%`;
        setProgressBar('image-optimization-bar', imageOptimizationScore);
        
        setIndicator('modern-image-formats', data.modernImageFormats === true);
        setIndicator('descriptive-alt-text', data.descriptiveAltText === true);
        
        // Content Freshness
        const contentFreshnessScore = Math.round(data.contentFreshnessScore);
        document.getElementById('content-freshness-score').textContent = `${contentFreshnessScore}%`;
        setProgressBar('content-freshness-bar', contentFreshnessScore);
        
        // Update content freshness indicators
        setIndicator('published-date', data.publishedDate === true);
        setIndicator('modified-date', data.modifiedDate === true);
        
        // Update content age display
        const contentAgeElement = document.getElementById('content-age');
        if (contentAgeElement) {
          if (data.contentAge) {
            contentAgeElement.textContent = `Content Age: ${data.contentAge}`;
            contentAgeElement.classList.add('font-medium');
          } else {
            contentAgeElement.textContent = 'Content age detection requires date meta tags.';
          }
        }
        
        // Performance Optimization
        const performanceScore = Math.round(data.performanceScore || 0);
        // Update score in the second results card
        const performanceScoreElement = document.getElementById('performanceScore');
        if (performanceScoreElement) performanceScoreElement.textContent = `${performanceScore}%`;
        
        setProgressBar('performanceScoreBar', performanceScore);
        
        // Hide original Performance Optimization section
        const perfSections = document.querySelectorAll('.mb-8.col-span-1');
        perfSections.forEach(section => {
          const heading = section.querySelector('h3');
          if (heading && heading.textContent.includes('Performance Optimization')) {
            section.style.display = 'none';
          }
        });
        
        setIndicator('preload', data.preloadLinks === true);
        setIndicator('preconnect', data.preconnectLinks === true);
        setIndicator('defer', data.deferScripts === true);
        setIndicator('lazyLoad', data.lazyLoadElements === true);
        
        // Citations & References
        const citationsScore = Math.round(data.citationsScore || 0);
        // Update score in the second results card
        const citationsScoreElement = document.getElementById('citations-score');
        if (citationsScoreElement) citationsScoreElement.textContent = `${citationsScore}%`;
        
        setProgressBar('citations-bar', citationsScore);
        
        // Hide original Citations & References section
        const citationSections = document.querySelectorAll('.mb-8.col-span-1');
        citationSections.forEach(section => {
          const heading = section.querySelector('h3');
          if (heading && heading.textContent.includes('Citations & References')) {
            section.style.display = 'none';
          }
        });
        
        // Log the actual values received from worker
        console.log('Citation detection results:', {
          citationElements: data.citationElements,
          hasReferenceLinks: data.hasReferenceLinks,
          citationsScore: data.citationsScore
        });
        
        // Set indicators based on actual values
        setIndicator('citation-elements', data.citationElements === true);
        setIndicator('reference-links', data.hasReferenceLinks === true);
        
        // Show debug info - REMOVE THIS IN PRODUCTION
        const debugInfo = document.getElementById('citation-debug-info');
        if (debugInfo) {
          const debugInfoText = `
            <strong>Debug Info:</strong><br>
            Citation elements found: ${data.citationElements ? 'Yes' : 'No'}<br>
            External links found: ${data.hasReferenceLinks ? 'Yes' : 'No'}<br>
            Score: ${citationsScore}%<br>
            <em>This section checks for citation HTML tags (blockquote, cite, q) and CSS classes (.citation, .reference, .footnote, .endnote) as well as links to domains other than the current site. Social media and business profile links are excluded.</em>
          `;
          debugInfo.innerHTML = debugInfoText;
          // Uncomment to show debug info
          debugInfo.style.display = 'block';
        }
        
        // Authority & Trust Signals
        const authorityScore = Math.round(data.authorityScore || 0);
        // Update score in the second results card
        const authorityScoreElement = document.getElementById('authority-score');
        if (authorityScoreElement) authorityScoreElement.textContent = `${authorityScore}%`;
        
        setProgressBar('authority-bar', authorityScore);
        
        // Hide original Authority & Trust Signals section
        const authoritySections = document.querySelectorAll('.mb-8.col-span-1');
        authoritySections.forEach(section => {
          const heading = section.querySelector('h3');
          if (heading && heading.textContent.includes('Authority & Trust Signals')) {
            section.style.display = 'none';
          }
        });
        
        setIndicator('author-info', data.authorInfo === true);
        setIndicator('author-bio', data.hasAuthorBio === true);
        setIndicator('social-media-links', data.socialMediaLinks === true);
        setIndicator('business-profile-links', data.businessProfileLinks === true);
        
        // Show results section
        resultsSection.classList.remove('hidden');
        
        // Target the AI analyzer section which is the primary section
        document.querySelector('#ai-analyzer').scrollIntoView({ behavior: 'smooth' });
      }
      
      // Show error message
      function showError(message) {
        errorMessage.textContent = message;
        errorAlert.classList.remove('hidden');
      }
      
      // Hide error message
      function hideError() {
        errorAlert.classList.add('hidden');
      }
      
      // Set loading state
      function setLoading(isLoading) {
        if (isLoading) {
          buttonText.textContent = 'Analyzing...';
          buttonSpinner.classList.remove('hidden');
          analyzeButton.disabled = true;
        } else {
          buttonText.textContent = 'Analyze Website';
          buttonSpinner.classList.add('hidden');
          analyzeButton.disabled = false;
        }
      }
      
      // Event listeners
      analyzeForm.addEventListener('submit', analyzeWebsite);
    });
    
    // AI Visibility Analyzer Functionality
    document.addEventListener('DOMContentLoaded', function() {
      const analyzeForm = document.getElementById('analyzeForm');
      const websiteUrlInput = document.getElementById('urlInput'); // Fixed: using correct input ID
      const analyzeButton = document.getElementById('analyzeButton');
      const buttonText = document.getElementById('buttonText');
      const buttonSpinner = document.getElementById('buttonSpinner');
      const resultsSection = document.getElementById('resultsSection');
      const analyzedUrlElement = document.getElementById('analyzedUrl');
      const errorAlert = document.getElementById('errorAlert');
      const errorMessage = document.getElementById('errorMessage');
      
      if (!analyzeForm) return; // Exit if form doesn't exist
      
      // Function to validate URL
      function isValidUrl(url) {
        try {
          const parsedUrl = new URL(url);
          return parsedUrl.protocol === 'http:' || parsedUrl.protocol === 'https:';
        } catch (e) {
          return false;
        }
      }
      
      // Function to set progress bar width
      function setProgressBar(elementId, percentage) {
        const progressBar = document.getElementById(elementId);
        if (progressBar) {
          progressBar.style.width = `${percentage}%`;
        }
      }
      
      // Function to set indicator status (check/x)
      function setIndicator(elementId, isPresent) {
        const element = document.getElementById(elementId);
        if (element) {
          const icon = element.querySelector('svg');
          if (icon) {
            if (isPresent) {
              icon.classList.remove('text-red-500');
              icon.classList.add('text-green-500');
              icon.innerHTML = '<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />';
            } else {
              icon.classList.remove('text-green-500');
              icon.classList.add('text-red-500');
              icon.innerHTML = '<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />';
            }
          }
          
          // Update the text to show status if needed
          const textElement = element.querySelector('span');
          if (textElement && textElement.textContent.includes(':')) {
            const baseText = textElement.textContent.split(':')[0];
            textElement.textContent = isPresent ? 
              `${baseText}: Good` : 
              `${baseText}: Needs Improvement`;
          }
        }
      }
      
      // Handle form submission
      function analyzeWebsite(e) {
        e.preventDefault();
        
        // Get URL input
        const url = websiteUrlInput.value.trim();
        
        // Validate URL
        if (!url) {
          showError('Please enter a website URL.');
          return;
        }
        
        if (!isValidUrl(url)) {
          showError('Please enter a valid URL (e.g. https://example.com).');
          return;
        }
        
        // Clear any previous errors
        hideError();
        
        // Show loading state
        setLoading(true);
        
        // Set the analyzed URL in the results
        if (analyzedUrlElement) {
          analyzedUrlElement.textContent = url;
        }
        
        // Simulate an API call with a timeout (replace with actual API call in production)
        setTimeout(function() {
          // Process the response data (this would come from your actual API)
          processResults({
            url: url,
            overallScore: Math.floor(Math.random() * 20) + 60, // Random score between 60-80
            aiSeoScore: Math.floor(Math.random() * 20) + 70,
            imageOptScore: Math.floor(Math.random() * 30) + 70,
            schemaMarkup: Math.random() > 0.3,
            schemaQuality: Math.random() > 0.6,
            aiOptimizedTitle: Math.random() > 0.4,
            aiOptimizedMetaTags: Math.random() > 0.3,
            modernImageFormats: Math.random() > 0.2,
            descriptiveAltText: Math.random() > 0.5
          });
          
          // Hide loading state
          setLoading(false);
        }, 2000);
      }
      
      // NOTE: DISABLED TO FIX AI SEO SCORE CALCULATION ISSUE
      // This function was conflicting with the displayResults function
      // Keeping for reference until confirmed for deletion
      /*
      // Process and display results
      function processResults(data) {
        // Update the overall score
        const overallScore = Math.round(data.overallScore);
        const overallScoreElement = document.getElementById('overallScore');
        if (overallScoreElement) overallScoreElement.textContent = `${overallScore}%`;
        setProgressBar('overallScoreBar', overallScore);
        
        // Update AI SEO score
        const aiSeoScore = Math.round(data.aiSeoScore);
        const aiSeoScoreElement = document.getElementById('aiSeoScore');
        if (aiSeoScoreElement) aiSeoScoreElement.textContent = `${aiSeoScore}%`;
        setProgressBar('aiSeoScoreBar', aiSeoScore);
        
        // Update Image Optimization score
        const imageOptScore = Math.round(data.imageOptScore);
        document.getElementById('imageOptScore').textContent = `${imageOptScore}%`;
        setProgressBar('imageOptScoreBar', imageOptScore);
        
        // Set indicators based on analysis
        setIndicator('schema-markup', data.schemaMarkup);
        setIndicator('schema-quality', data.schemaQuality);
        setIndicator('ai-optimized-title', data.aiOptimizedTitle);
        setIndicator('ai-optimized-meta', data.aiOptimizedMetaTags);
        setIndicator('modern-image-format', data.modernImageFormats);
        setIndicator('descriptive-alt-text', data.descriptiveAltText);
        
        // Show results section
        resultsSection.classList.remove('hidden');
        
        // Target the AI analyzer section which is the primary section
        document.querySelector('#ai-analyzer').scrollIntoView({ behavior: 'smooth' });
      }
      */
      
      // Empty placeholder function to prevent errors if any code calls processResults
      function processResults(data) {
        console.log('processResults disabled - using displayResults instead');
      }
      
      // Show error message
      function showError(message) {
        errorMessage.textContent = message;
        errorAlert.classList.remove('hidden');
        
        // Hide error after 5 seconds
        setTimeout(function() {
          hideError();
        }, 5000);
      }
      
      // Hide error message
      function hideError() {
        errorAlert.classList.add('hidden');
      }
      
      // Set loading state
      function setLoading(isLoading) {
        if (isLoading) {
          buttonText.textContent = 'Analyzing...';
          buttonSpinner.classList.remove('hidden');
          analyzeButton.disabled = true;
        } else {
          buttonText.textContent = 'Analyze Website';
          buttonSpinner.classList.add('hidden');
          analyzeButton.disabled = false;
        }
      }
      
      // Event listeners
      analyzeForm.addEventListener('submit', analyzeWebsite);
    });
  </script>
</MainLayout>