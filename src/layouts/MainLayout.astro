---
// Main layout component that will be used across all pages
const { title = "Digital Visibility - AI Powered Business Optimization" } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<!-- Cloudflare Early Hints Support -->
<!-- Early hints preloads -->
<!-- Early hints preconnect -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Cloudflare optimization hints -->
    <meta http-equiv="Cache-Control" content="public, max-age=86400">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="cf-2fa-verify" content="true">

    <!-- Preload critical resources for better LCP -->
    <!-- Removed global.css preload reference -->
    <link rel="preload" href="/scripts/lucide-icons.min.js" as="script">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://imagedelivery.net" crossorigin>
    <title>{title}</title>
    <!-- Removed global.css stylesheet reference -->
    <meta name="description" content="Digital Visibility provides AI-powered business optimization services including digital marketing, app development, and product design.">
    <meta name="keywords" content="AI, digital marketing, app development, product design, business optimization">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    
    <!-- Sitemap and Robots References -->
    <link rel="sitemap" type="application/xml" href="/sitemap.xml">
    
    <!-- Schema.org WebSite markup with sitemap reference -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "url": "https://digitalvisibility.com",
      "name": "Digital Visibility - Human Powered, AI Accelerated Solutions",
      "description": "Human-powered digital solutions, accelerated with AI. Digital marketing with SEO+AEO+GEO, app development, and physical product design services in Swansea, Wales, and globally.",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://digitalvisibility.com/search?q={search_term_string}",
        "query-input": "required name=search_term_string"
      },
      "siteMapLink": "https://digitalvisibility.com/sitemap.xml",
      "publisher": {
        "@type": "Organization",
        "name": "Digital Visibility Limited",
        "logo": {
          "@type": "ImageObject",
          "url": "https://digitalvisibility.com/digital-visibility-logo-f.png",
          "width": "180",
          "height": "60"
        }
      },
      "inLanguage": "en-GB",
      "copyrightHolder": {
        "@type": "Organization",
        "name": "Digital Visibility Limited"
      },
      "copyrightYear": "2025",
      "datePublished": "2023-01-01",
      "dateModified": "2025-04-29"
    }
    </script>
    <slot name="head"/>
</head>
<body>
    <slot name="nav"/>
    
    <main>
        <slot />
    </main>

    <slot name="footer"/>

    <!-- Either add is:inline or remove if not yet created -->
    <!-- <script is:inline src="/scripts/app.js"></script> -->
    <script defer src="/scripts/lucide-icons.min.js"></script>
    <script is:inline>
        // Optimize icon initialization to reduce LCP time
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof window.lucide !== 'undefined') {
                // Create above-the-fold icons immediately
                window.lucide.createIcons();
                
                // Optimize by removing unused icons
                var unusedIcons = document.querySelectorAll('.icon:not(.essential-icon)'); 
                unusedIcons.forEach(function(icon) {
                    if (!isInViewport(icon)) {
                        icon.setAttribute('data-lazy-load', 'true');
                    }
                });
            }
        });
        
        // Helper function to check if element is in viewport
        function isInViewport(element) {
            var rect = element.getBoundingClientRect();
            return (
                rect.top >= 0 &&
                rect.left >= 0 &&
                rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
                rect.right <= (window.innerWidth || document.documentElement.clientWidth)
            );
        }
    </script>
    <slot name="scripts"/>
</body>
</html>
